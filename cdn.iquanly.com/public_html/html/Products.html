<style>
.product-select.k-dropdown .k-animation-container ul li{
    margin-left: 0px!important;
}
.product-select.k-dropdown .k-animation-container ul{
    background: #ebebeb;
}
.product-select.k-dropdown .k-animation-container ul li.k-state-hover{
    color: red;
}

.k-picker-wrap:before {
    content: none;
}
 
.k-window-content p{
    color: #333;
    margin-top: 20px;
    line-height: 18px;
    font-style: italic;
}
.k-window-content p.ly-ex{
    color: #999999;
    border-bottom: 1px solid #e0e0e0;
    font-style: normal;
}
 
.k-window-content .k-select{
    border-left: 0px!important;
}

input[type="text"]:not(.k-input),.form-control {
    border: 1px solid #ccc;
    background: #fff;
    color: #333;
    font-size: 13px;
    padding: 0 8px;
    vertical-align: middle;
    height: 30px;
    line-height: 30px;
    -moz-border-radius: 3px;
    -webkit-border-radius: 3px;
    -khtml-border-radius: 3px;
    border-radius: 3px;
    webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
    font-weight: normal;
}

/*********BARCODE************/
.w-barcode-left,.w-qr-left,.w-quick-left{
    /*max-width: 225px;float: left;*/
    padding-top: 25px;
    
    max-width: none!important;
}
.kv2Btn-barcode{background: #2e94da; margin-top: 17px; display:block}
.kv2Btn-barcode i{margin-right: 8px;}
.kv2Btn-barcode:hover{background: #2782c0;}
.k-window-content .k-dropdown-wrap{
    height: 30px;
    border: 1px solid #dcdcdc;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    font-weight: bold;
    width: 158px;
}
 
.k-window-poup .k-state-default>.k-select, .k-window-content .k-dropdown-wrap{
    background: none;
}
.k-window-content .k-dropdown-wrap .k-i-arrow-s:before{
    content: "\f0dc";
}
 
.kv2Btn{
    text-align: center;
}

#reportViewer{     
    width: 500px;
    position: relative;
} 

.barcode-container{
    width: 105px; 
    height: 90px;
    float: left;
    /*margin-right: 5px;*/
    text-align: center;
}
.ten,.gia{
    font-size: 10px;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

.mask.mask-quick-sale {
    width: 24px;
    height: 24px;
    background: url(/assets/images/quick-sale.svg);
    position: absolute;
}



.alert:empty {
    display: none;
}
.k-window-importProduct .k-upload-button input  {
    position: absolute;
    bottom: 0;
    right: 0;
    font: 170px monospace!important;
}
.warning-content {
    color: #7b5e2a;
    background-color: #f9f9e0;
    padding: 10px;
    border: 1px solid transparent;
    border-radius: 3px;
    font-style: italic;
}
#importproductform, #importTransfer {
    padding: 25px 25px 20px;
} 
@media(min-width:768px){
    aside.lbl-qlcb:not(.ng-hide)~aside.lbl-qlcb:not(.ng-hide){
        margin-left: 40px;
    }
}



.boxScr200, .boxScr300, .boxScr500 {
    overflow: auto;
}
.boxScr300, .category-treeview {
    max-height: 300px;
}
.product-RawMaterial table {
    border-top: 1px solid #e8e8e8;
}
.addProduct * {
    box-sizing: border-box;
}
.addProduct table th {
    font-weight: 700;
    padding-bottom: 10px;
}
.product-RawMaterial table th {
    background: #dcf5fc;
    border-bottom: 1px solid #e8e8e8;
    color: #2e2e2e;
    padding: 15px 10px;
    font-size: 12px;
}
.product-RawMaterial table th:first-child, .product-RawMaterial table tr td:first-child {
    border-left: 1px solid #e8e8e8;
}
.product-RawMaterial table th:last-child, .product-RawMaterial table tr td:last-child {
    border-right: 1px solid #e8e8e8;
}
.product-RawMaterial table td {
    padding: 10px;
    font-size: 12px;
    border-bottom: 1px solid #e8e8e8;
}


.k-window-poup .boxForm {
    clear: both;
}

/* 04/25/2020 */
.sortDateTimeOtherBox{
    width: 517px;
}

.sortDateTimeOtherBox .k-calendar{
    width: 232px;
}
</style>

<section class="mainLeft ng-scope">
    <kv-product-filter>
<article class="boxLeft uln sortTime sortView mb20 fr ">

    <h3 class="leftTitle ng-binding">Tìm kiếm</h3>
    <aside class="boxLeftC">
        <input type="text" ng-model="filter.keywordParam" placeholder="Theo mã, tên hàng" class="w100 mb10 ng-pristine ng-untouched ng-valid ng-empty" kv-select-text="" ng-blur="filterbyKeyword()" ng-keyup="$event.keyCode == 13 ? filterbyKeyword() : null">
        <input ng-show="appSetting.UseImei" ng-keyup="$event.keyCode == 13 ? refresh() : null" class="w100 mb10 ng-pristine ng-untouched ng-valid ng-empty ng-hide" type="text" ng-model="filterSerialKey" placeholder="Theo Serial/IMEI" kv-select-text="">
        <input ng-show="cfs.UseExpireTime" class="w100 mb10 ng-pristine ng-untouched ng-valid ng-empty ng-hide" type="text" ng-model="filter.Expire" placeholder="Số ngày hết hạn" kv-select-text="">
        <select ng-hide="!cfs.BHS" class="w100 mb10 ng-pristine ng-untouched ng-valid ng-empty" ng-model="filter.user"></select>          
    </aside>
</article>
<article class="boxLeft uln leftStatus" ng-show="pTypeFilter.length>1">
    <h3 class="leftTitle cursor ng-binding" ng-click="showTypeFilter = !showTypeFilter">Loại hàng <a class="showhideicon"><i class="fa fa-chevron-circle-up"></i></a></h3>
    <aside class="boxLeftC" ng-hide="showTypeFilter">
        <ul>
            <li ng-repeat="item in pTypeFilter" class="ng-scope has-pretty-child">
                <div class="clearfix prettycheckbox labelright  blue">
                <input checked="checked" type="checkbox" ng-model="filter.type" value="1" kv-change="filterbyProductType" kv-pretty-check="" kv-data-label="item.value" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" data-label="Combo - Đóng gói" style="display: none;">
                <a href="javascript:void(0)" class="checked "></a>
                <label for="undefined" class="">Combo - Đóng gói</label></div>
            </li>
            <li ng-repeat="item in pTypeFilter" class="ng-scope has-pretty-child">
                <div class="clearfix prettycheckbox labelright  blue">
                <input checked="checked" type="checkbox" ng-model="filter.type" value="2" kv-change="filterbyProductType" kv-pretty-check="" kv-data-label="item.value" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" data-label="Hàng hóa" style="display: none;">
                <a href="javascript:void(0)" class="checked "></a>
                <label for="undefined" class="">Hàng hóa</label></div>
            </li>
            <li ng-repeat="item in pTypeFilter" class="ng-scope has-pretty-child">
                <div class="clearfix prettycheckbox labelright  blue">
                <input checked="checked" type="checkbox" ng-model="filter.type" value="3" kv-change="filterbyProductType" kv-pretty-check="" kv-data-label="item.value" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" data-label="Dịch vụ" style="display: none;">
                <a href="javascript:void(0)" class="checked "></a>
                <label for="undefined" class="">Dịch vụ</label></div>
            </li>
        </ul>
    </aside>
</article>
<article class="boxLeft uln leftStatus ">

    <h3 class="leftTitle cursor ng-binding" ng-click="showOnHandFilter = !showOnHandFilter">Tồn kho <a class="showhideicon"><i class="fa fa-chevron-circle-up"></i></a></h3>
    <aside class="boxLeftC" ng-hide="showOnHandFilter">
  <ul class="pretty-radio-mobile">
    <li class="has-pretty-child">
      <div class="clearfix prettyradio labelright  blue">
        <input type="radio" kv-pretty-check="" name="OnHandRadio" value="0" kv-data-label="_l.product_SearchNotOnHand" ng-model="onhandFilter" kv-change="filterbyOnHand" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Tất cả"
        style="display: none;" checked="checked">
        <a href="javascript:void(0)" tabindex="1000007" class="checked"></a>
        <label for="undefined" class="checked">Tất cả</label>
      </div>
    </li>
    <li class="has-pretty-child">
      <div class="clearfix prettyradio labelright  blue">
        <input type="radio" kv-pretty-check="" name="OnHandRadio" value="1" kv-data-label="_l.product_SearchUnderOnHand" ng-model="onhandFilter" kv-change="filterbyOnHand" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Dưới định mức tồn"
        style="display: none;">
        <a href="javascript:void(0)" tabindex="1000007" class=""></a>
        <label for="undefined" class="">Dưới định mức tồn</label>
      </div>
    </li>
    <li class="has-pretty-child">
      <div class="clearfix prettyradio labelright  blue">
        <input type="radio" kv-pretty-check="" name="OnHandRadio" value="2" kv-data-label="_l.product_SearchOverOnHand" ng-model="onhandFilter" kv-change="filterbyOnHand" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Vượt định mức tồn"
        style="display: none;">
        <a href="javascript:void(0)" tabindex="1000007" class=""></a>
        <label for="undefined" class="">Vượt định mức tồn</label>
      </div>
    </li>
    <li class="has-pretty-child">
      <div class="clearfix prettyradio labelright  blue">
        <input type="radio" kv-pretty-check="" name="OnHandRadio" value="3" kv-data-label="_l.product_SearchInOnHand" ng-model="onhandFilter" kv-change="filterbyOnHand" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Còn hàng trong kho"
        style="display: none;">
        <a href="javascript:void(0)" tabindex="1000007" class=""></a>
        <label for="undefined" class="">Còn hàng trong kho</label>
      </div>
    </li>
    <li class="has-pretty-child">
      <div class="clearfix prettyradio labelright  blue">
        <input type="radio" kv-pretty-check="" name="OnHandRadio" value="4" kv-data-label="_l.product_SearchOutOfOnHand" ng-model="onhandFilter" kv-change="filterbyOnHand" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Hết hàng trong kho"
        style="display: none;">
        <a href="javascript:void(0)" tabindex="1000007" class=""></a>
        <label for="undefined" class="">Hết hàng trong kho</label>
      </div>
    </li>
  </ul>
</aside>

</article>
<article class="boxLeft uln sortTime sortView mb20 fr ng-hide" ng-show="attributeList.length>0&amp;&amp;appSetting.UseVariants">
    <h3 class="leftTitle cursor ng-binding" ng-click="showVariant = !showVariant">Thuộc tính <a class="showhideicon"><i class="fa fa-chevron-circle-up"></i></a></h3>
    <aside class="boxLeftC" ng-hide="showVariant">
        <div class="hideSelect mb10" ng-class="showSelect?'showALL':''">
            <!-- ngRepeat: item in attributeList -->
        </div>
        <a class="ng-binding" ng-hide="showVariant" href="javascript:void(0)" ng-click="showSelect = !showSelect">Mở rộng <i class="fa  fa-caret-down"></i></a>
    </aside>
</article>
<article class="boxLeft uln sortTime proGroup sortView mb20 posR">
    <h3 class="leftTitle cursor ng-binding" ng-click="showGroup = !showGroup">Nhóm hàng <a class="showhideicon"><i class="fa fa-chevron-circle-up"></i></a></h3>
    <a onclick="EditCategory(0)" href="javascript:void(0)" class="showhideicon" title="Thêm nhóm hàng" style="right:32px"><i class="fa fa-plus-circle"></i></a>
    <aside class="boxLeftC" ng-hide="showGroup">
        <div id="treeviewcat" kendo-tree-view="" k-options="treeviewcat" class="src proTree k-list k-widget k-treeview" data-role="treeview" tabindex="0">
        <ul class="k-group k-treeview-lines" role="tree">
        <li role="treeitem" class="k-item k-first" data-uid="93044d35-6149-485b-bebe-e8b1b9d9acc1" aria-selected="false " id="treeviewcat_tv_active">
        <div class="k-top k-top ng-scope">
        <span class="k-in">
        <span class="nametreeview">Tất cả</span>
        <a class="edittreeview" ng-click="EditCategory($event)" title="Sửa"><i class="fa fa-pencil-square-o"></i></a>
        </span>
        </div>
        </li>
         
        <li role="treeitem" class="k-item" data-uid="61c74c47-7d18-40aa-8971-34338857139c" aria-selected="false "><div class="k-mid ng-scope"><span class="k-in"><span class="nametreeview">...</span><a class="edittreeview" ng-click="EditCategory($event)" title="Sửa"><i class="fa fa-pencil-square-o"></i></a></span></div></li>
        <li role="treeitem" class="k-item k-last" data-uid="cc4ce698-9a99-490f-8db0-449f60a051e8" aria-selected="false "><div class="k-bot ng-scope"><span class="k-in"><span class="nametreeview">...</span><a class="edittreeview" ng-click="EditCategory($event)" title="Sửa"><i class="fa fa-pencil-square-o"></i></a></span></div></li>
        </ul></div>
    </aside>
</article>
    <article ng-hide="!cfs.BHS" class="boxLeft uln reportsortTime customeSelect">
      <h3 class="leftTitle ng-binding">Thời gian</h3>
      <kv-report-time-filter kv-model="dateFilter" kv-change="dateFilterUpdated" kv-alltime="true" class="ng-isolate-scope">
        <aside class="boxLeftC posR">
          <ul id="">
            <li class="reportsort reportsortDateTime has-pretty-child" ng-hide="kvChooseDate">
              <div class="clearfix prettyradio labelright  blue">
                <input type="radio" kv-pretty-check="" name="stime_" id="reportsortDateTimeIpt" value="range" ng-model="kvModel.typeDate" kv-change="filterTimeChangeType" class="ng-untouched ng-valid ng-isolate-scope ng-not-empty ng-dirty ng-valid-parse"
                style="display: none;">
                <a href="javascript:void(0)" tabindex="1000007" class="checked"></a>
                <label for="reportsortDateTimeIpt" class="checked"></label>
              </div>
              <aside class="sortTime">
                <label class="sortTimeLbl ng-binding" id="reportsortDateTimeLbl" ng-click="sortTimeType('.reportsortDateTime')">Toàn thời gian</label>
                <aside class="sortTimeHeight sortTimeList">
                  <div class="row">
                    <div class="col-md-4 col-sm-4">
                      <h3>Theo ngày và tuần</h3>
                      <ul>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('today')" class="ng-binding">Hôm nay</a></li>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('yesterday')" class="ng-binding">Hôm qua</a></li>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('thisweek')" class="ng-binding">Tuần này</a></li>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('lastweek')" class="ng-binding">Tuần trước</a></li>
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('7day')" class="ng-binding">7 ngày qua</a></li>
                        <!-- end ngIf: !kvBirthday -->
                      </ul>
                    </div>
                    <div class="col-md-4 col-sm-4">
                      <h3>Theo tháng và quý</h3>
                      <ul>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('month')" class="ng-binding">Tháng này</a></li>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('lastmonth')" class="ng-binding">Tháng trước</a></li>
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('monthlunar')" class="ng-binding">Tháng này (Âm lịch)</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('lastmonthlunar')" class="ng-binding">Tháng trước (Âm lịch)</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('30day')" class="ng-binding">30 ngày qua</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('quarter')" class="ng-binding">Quý này</a></li>
                        <li><a href="javascript:void(0);" ng-click="filterbyRange('lastquarter')" class="ng-binding">Quý trước</a></li>
                      </ul>
                    </div>
                    <div class="col-md-4 col-sm-4">
                      <h3>Theo năm</h3>
                      <ul>
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('year')" class="ng-binding">Năm này</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('lastyear')" class="ng-binding">Năm trước</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('yearlunar')" class="ng-binding">Năm này (Âm lịch)</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: !kvBirthday -->
                        <li ng-if="!kvBirthday" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('lastyearlunar')" class="ng-binding">Năm trước (Âm lịch)</a></li>
                        <!-- end ngIf: !kvBirthday -->
                        <!-- ngIf: kvModel.typeFilter && kvModel.typeFilter == 'common' && (kvAlltime || kvBirthday) -->
                        <li ng-if="kvModel.typeFilter &amp;&amp; kvModel.typeFilter == 'common' &amp;&amp; (kvAlltime || kvBirthday)" class="ng-scope"><a href="javascript:void(0);" ng-click="filterbyRange('alltime')" class="ng-binding">Toàn thời gian</a></li>
                        <!-- end ngIf: kvModel.typeFilter && kvModel.typeFilter == 'common' && (kvAlltime || kvBirthday) -->
                      </ul>
                    </div>
                  </div>
                </aside>
              </aside>
            </li>
            <li class="reportsort reportsortDateTime reportsortDate has-pretty-child ng-hide" ng-show="kvChooseDate">
              <div class="clearfix prettyradio labelright  blue">
                <input type="radio" kv-pretty-check="" name="stime_" id="chooseDate" value="choose" ng-model="kvModel.typeDate" kv-change="filterTimeChangeType" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" style="display: none;">
                <a href="javascript:void(0)" tabindex="1000007" class=""></a>
                <label for="chooseDate" class=""></label>
              </div>
              <label class="sortTimeLbl ng-binding" id="reportsortDateTimeLbl" ng-click="sortTimeType('.reportsortDateTime')">Chọn ngày</label>
              <aside class="sortTimeHeight sortDateTimeOtherBox fr">
                <div class="row mb5">
                  <div class="col-md-12">
                    <h6 class="ng-binding">Chọn ngày: <span class="ng-binding">12/07/2017</span></h6>
                     
                  </div>
                </div>
              </aside>
            </li>
            <li class="reportsort reportsortOther has-pretty-child">
              <div class="clearfix prettyradio labelright  blue">
                <input type="radio" kv-pretty-check="" name="stime_" value="other" id="sortTime" ng-model="kvModel.typeDate" kv-data-label="" kv-change="filterTimeChangeType" class="ng-untouched ng-valid ng-isolate-scope ng-not-empty ng-dirty" style="display: none;">
                <a href="javascript:void(0)" tabindex="1000007" class=""></a>
                <label for="sortTime" class=""></label>
              </div>
              <label class="sortTimeLbl ng-binding" id="reportsortOtherLbl" ng-click="sortTimeType('.reportsortOther')">Lựa chọn khác </label>
              <aside class="sortTimeHeight sortDateTimeOtherBox fr">
                <div class="row mb5">
                  <div class="col-md-6 col-sm-6">
                    <h6 class="ng-binding">Từ ngày: <!-- ngIf: !kvBirthday --><span ng-if="!kvBirthday" class="ng-binding ng-scope">12/07/2017</span><!-- end ngIf: !kvBirthday --><!-- ngIf: kvBirthday --></h6>
                    <div kendo-calendar="" id="fromDate" required="required" kv-max="EndDate" k-max="EndDate" k-rebind="EndDate" k-ng-model="StartDate" class="ng-scope k-widget k-calendar" data-role="calendar">
                    </div> 
                  </div>
                  <div class="col-md-6 col-sm-6">
                    <h6 class="ng-binding">Đến ngày: <!-- ngIf: !kvBirthday --><span ng-if="!kvBirthday" class="ng-binding ng-scope">12/07/2017</span><!-- end ngIf: !kvBirthday --><!-- ngIf: kvBirthday --></h6>
                    <div kendo-calendar="" id="toDate" required="required" kv-min="StartDate" k-min="StartDate" k-rebind="StartDate" k-ng-model="EndDate" class="ng-scope k-widget k-calendar" data-role="calendar">
                    </div>
                  </div>
                </div>
                <div class="boxBtn mb15 txtR"><a ng-click="filterByDateRange()" class="kv2Btn ng-binding"><i class="fa fa-filter"></i>Tìm kiếm</a></div>
              </aside>
            </li>
          </ul>
        </aside>
      </kv-report-time-filter>
    </article>
<article class="boxLeft reportHide uln sortTime sortView mb20">
    <h3 class="leftTitle cursor ng-binding">Lựa chọn hiển thị</h3>
    <aside class="boxLeftC mb10  ">
        <ul>
            <li class="has-pretty-child"><div class="clearfix prettyradio labelright  blue"><input type="radio" kv-pretty-check="" name="ActiveRadio" value="1" kv-data-label="_l.product_all" ng-model="ShowInActiveProduct" kv-change="FilterActiveProduct" class="ng-untouched ng-valid ng-isolate-scope ng-not-empty ng-dirty ng-valid-parse" data-label="Tất cả" style="display: none;"><a href="javascript:void(0)" class="checked"></a>
<label for="undefined" class="checked">Tất cả</label></div></li>
            <li class="has-pretty-child"><div class="clearfix prettyradio labelright  blue"><input type="radio" kv-pretty-check="" name="ActiveRadio" value="2" kv-data-label="_l.product_notsell" ng-model="ShowInActiveProduct" kv-change="FilterActiveProduct" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Hàng ngừng Kinh doanh" style="display: none;"><a href="javascript:void(0)" class=" "></a>
<label for="undefined" class="">Hàng ngừng Kinh doanh</label></div></li>
            <li class="has-pretty-child"><div class="clearfix prettyradio labelright  blue"><input type="radio" kv-pretty-check="" name="ActiveRadio" value="3" kv-data-label="_l.product_sell" ng-model="ShowInActiveProduct" kv-change="FilterActiveProduct" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Hàng đang Kinh doanh" style="display: none;"><a href="javascript:void(0)" class=""></a>
<label for="undefined" class="">Hàng đang Kinh doanh</label></div></li>
        </ul>
    </aside>
    <aside class="boxLeftC">
        <aside ng-show="viewtype == typeList" class="br0 pd0 ng-binding">
            Số bản ghi: <span title="" class="k-widget k-dropdown k-header mt0 ng-pristine ng-untouched ng-valid ng-not-empty" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="5955c347-42e8-4720-a41b-53656d975ee6" style=""><span unselectable="on" class="k-dropdown-wrap k-state-default"><span unselectable="on" class="k-input ng-scope">10</span><span unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-arrow-s">select</span></span></span><select class="mt0 ng-pristine ng-untouched ng-valid ng-not-empty" ng-model="pageSize" k-on-change="refresh()" k-data-source="pageSizes" kendo-drop-down-list="" data-role="dropdownlist" style="display: none;"><option value="? number:10 ?"></option><option value="10" selected="selected">10</option><option value="15">15</option><option value="20">20</option><option value="30">30</option></select></span>
        </aside>
    </aside>
</article>

</kv-product-filter>
<div class="wrap-button-footer"><button kv-mobile="" type="button" class="kv2Btn">Hoàn tất</button></div>
</section>

<section class="mainRight ng-scope">
    <section class="mainWrap fll w100" style="position: relative; top: auto; bottom: auto; width: auto;">
        <article class="headerContent uln fll w100">
            <h1><a href="javascript:void(0);" class="mobileIcon" kv-mobile=""></a><span class="ng-binding">Hàng hóa</span></h1>
            
            <aside class="flr">
                <div class=" selectedP hide">
                    <a ng-show="" href="javascript:void(0)" class="kv2Btn ng-binding " title="Lựa chọn"><i class="fa fa-share-square"></i> Lựa chọn <i class="fa fa-caret-down"></i></a>
                    <ul>                         
                        <li ng-hide="!cfs.BHS"><a href="javascript:void(0)" onclick="showDiary()" kv-btn-scroll="" title="Nhật ký điện tử" class="ng-binding"><i class="fa fa-book"></i> Nhật ký điện tử</a></li>
                        <li ng-hide="!cfs.BHS"><a href="javascript:void(0)" onclick="printQRcode()" kv-btn-scroll="" title="In QRCODE" class="ng-binding"><i class="fa fa-qrcode"></i> In QRCODE</a></li> 
                        <li><a href="javascript:void(0)" onclick="removeSelectedP()" kv-btn-scroll="" title="Bỏ chọn tất cả" class="ng-binding"><i class="fa fa-ban"></i> Bỏ chọn tất cả</a></li>
                        <li ng-hide="!cfs.BHS"><a href="javascript:void(0)" onclick="splitProduct()" kv-btn-scroll="" title="Phân tách sản phẩm" class="ng-binding"><i class="fa fa-cut"></i> Phân tách sản phẩm</a></li>
                        <li ng-show="3.4.2"><a href="javascript:void(0)" onclick="recycleProduct()" kv-btn-scroll="" title="Xuất hủy" class="ng-binding"><i class="fa fa-recycle"></i> Xuất hủy</a></li>
                    </ul>
                </div>
                <div class="dpib addProductBtn">
                    <a ng-show="_p.has('Product_Create')" href="javascript:void(0)" class="kv2Btn ng-binding" title="Thêm mới"><i class="fa fa-plus"></i> Thêm mới <i class="fa fa-caret-down"></i></a>
                    <ul>                         
                        <li><a href="javascript:void(0)" onclick="AddProduct(2)" kv-btn-scroll="" title="Thêm hàng hóa" class="ng-binding"><i class="fa fa-plus"></i> Thêm hàng hóa</a></li>
                        <li><a href="javascript:void(0)" onclick="AddProduct(3)" kv-btn-scroll="" title="Thêm dịch vụ" class="ng-binding"><i class="fa fa-plus"></i> Thêm dịch vụ</a></li>
                        <li><a href="javascript:void(0)" onclick="AddProduct(1)" kv-btn-scroll="" title="Thêm Combo - đóng gói" class="ng-binding"><i class="fa fa-plus"></i> Thêm Combo - đóng gói</a></li>
                        
                        <li><a href="javascript:void(0)" onclick="AddProduct()" kv-btn-scroll="" title="Thêm nhanh hàng hóa" class="ng-binding"><i class="fa fa-bolt"></i> Thêm nhanh hàng hóa</a></li>
                    </ul>
                </div>
                <a ng-show="_p.has('Product_Import')" href="javascript:void(0)" ng-click="importProduct()" class="kv2Btn kv2BtnImport ng-binding"><i class="fa fa-sign-in"></i> Import</a>
                <a ng-show="_p.has('Product_Export')" href="javascript:void(0)" ng-click="exportProduct()" class="kv2Btn kv2BtnExport ng-binding"><i class="fa fa-sign-out"></i> Xuất  file</a>
                <div id="columnSelection" kv-column-selection="" class="hth-hide columnView k-widget k-reset k-header k-menu k-menu-horizontal" binded-grid="bindedGrid" data-role="menu" tabindex="0" role="menubar"><li class="k-item k-state-default k-first k-last" role="menuitem" aria-haspopup="true"><span class="k-link"><span class="k-icon k-i-arrow-s"></span></span><ul class="k-group k-menu-group" style="display:none" role="menu" aria-hidden="true"><li class="k-item k-state-default k-first" role="menuitem"><span class="k-link"><label class="quickaction_chk dpb"><input type="checkbox" checked="checked" class="check_row" data-field="Name"><span></span>Tên chi nhánh</label></span></li><li class="k-item k-state-default" role="menuitem"><span class="k-link"><label class="quickaction_chk dpb"><input type="checkbox" checked="checked" class="check_row" data-field="Address"><span></span>Địa chỉ</label></span></li><li class="k-item k-state-default" role="menuitem"><span class="k-link"><label class="quickaction_chk dpb"><input type="checkbox" checked="checked" class="check_row" data-field="ContactNumber"><span></span>Điện thoại</label></span></li><li class="k-item k-state-default k-last" role="menuitem"><span class="k-link"><label class="quickaction_chk dpb"><input type="checkbox" checked="checked" class="check_row" data-field="TotalUser"><span></span>SL người dùng</label></span></li></ul></li></div>
            </aside>

        </article>
        <article class="fll w100 k-gridNone productList k-grid-Scroll">
            <div id="grdProducts" kendo-grid="" k-options="products" k-sortable="true" k-resizable="true" k-pageable="{ &quot;pageSize&quot;: 50, &quot;refresh&quot;: false, &quot;pageSizes&quot;: false , buttonCount: 5,messages:{display:_l.pagerInfo + _l.product_Paging, first:_l.paging_First, previous:_l.paging_Prev, next: _l.paging_Next, last: _l.paging_Last}}" kv-grid-expan-row="" data-title="product_Paging" data-headerformat="{0}" data-role="grid" class="k-grid k-widget">
            <div class="k-grid-header" style="padding-right: 17px;">
            <div class="k-grid-header-wrap k-auto-scrollable" data-role="resizable">
            <table role="grid">
            <colgroup><col class="k-hierarchy-col"><col><col><col><col><col></colgroup>
            <thead role="rowgroup">
            <tr role="row">
            <th class="k-hierarchy-cell k-header ng-scope" scope="col">
                <!--&nbsp;-->
                <label class="clearfix prettycheckbox labelright blue">
                    <input type="checkbox" ng-model="chooseAll" value="" kv-change="" kv-pretty-check="" kv-data-label="" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" style="display: none;">
                    <a href="javascript:void(0)"></a>
                </label>
            </th>
            <th scope="col" role="columnheader" data-field="Code" rowspan="1" data-title="Mã hàng hóa" data-index="0" id="3e3e7421-980b-4045-82a2-cd786ed89ca0" class="tdCode k-header ng-scope" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Mã hàng hóa</a></th>
            <th scope="col" role="columnheader" data-field="Name" rowspan="1" data-title="Tên hàng hóa" data-index="1" id="44389476-45d9-4ea3-89e0-c82c0c972917" class="tdMin k-header ng-scope" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Tên hàng hóa</a></th>
            <th scope="col" role="columnheader" data-field="CategoryName" rowspan="1" data-title="Nhóm hàng" data-index="2" id="75350a01-6e8f-465c-8231-e492754b058c" class="tdMin k-header ng-scope" style="display:none" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Nhóm hàng</a></th>
            <th scope="col" role="columnheader" data-field="ProType" rowspan="1" data-title="Loại hàng" data-index="3" id="136fa813-b0f6-41f5-81b7-3cabf42b6f42" class="tdMin k-header ng-scope" style="display:none">Loại hàng</th>
            <th scope="col" role="columnheader" data-field="BasePrice" rowspan="1" data-title="Giá bán" data-index="4" id="d4323ec8-c710-495c-9bf4-93e2522c3d08" class="tdTotal txtR k-header ng-scope" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Giá bán</a></th>
            <th scope="col" role="columnheader" data-field="Cost" rowspan="1" data-title="Giá vốn" data-index="5" id="9c3459ef-0840-40a6-9c10-f8e97e93989d" class="tdTotal txtR tdMobile k-header ng-scope" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Giá vốn</a></th>
            <th scope="col" role="columnheader" data-field="OnHand" rowspan="1" data-title="Tồn kho" data-index="6" id="739969c0-4ddc-4870-9143-02dc4b8d14c9" class="tdTotal txtR k-header ng-scope" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Tồn kho</a></th>
            <th scope="col" role="columnheader" data-field="MinQuantity" rowspan="1" data-title="Định mức tồn ít nhất" data-index="7" id="6835d9e8-15a5-4892-88c8-848fe1ca6d62" class="tdBranch txtR k-header ng-scope" style="display:none" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Định mức tồn ít nhất</a></th>
            <th scope="col" role="columnheader" data-field="MaxQuantity" rowspan="1" data-title="Định mức tồn nhiều nhất" data-index="8" id="966ad389-1cb0-40d0-9ff8-5f9c8b704679" class="tdBranch txtR k-header ng-scope" style="display:none" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Định mức tồn nhiều nhất</a></th>
            <th scope="col" role="columnheader" data-field="isActive" rowspan="1" data-title="Trạng thái" data-index="9" id="063a6427-21f9-493e-ad2b-354575292895" class="tdDebt k-header ng-scope" style="display:none" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Trạng thái</a></th>
            </tr>
            </thead>
            </table>
            </div>
            </div>
            <div class="k-grid-content k-auto-scrollable k-grid-content-ac">
            <table role="treegrid">
            <colgroup><col class="k-hierarchy-col"><col><col><col><col><col></colgroup>
            <tbody role="rowgroup">
            
    
    </tbody>
    </table>
    </div>
    
    <div class="paging-box">
    <div class="k-pager-wrap k-grid-pager k-widget k-floatwrap" data-role="pager">
    <a href="javascript:void(0);" title="Trang đầu" class="k-link k-pager-nav k-pager-first k-state-disabled" data-page="1" tabindex="-1">
    <span class="k-icon k-i-seek-w">Trang đầu</span></a>
    <a href="javascript:void(0);" title="Trang trước" class="k-link k-pager-nav  k-state-disabled" data-page="1" tabindex="-1">
    <span class="k-icon k-i-arrow-w">Trang trước</span></a>
    <ul class="k-pager-numbers k-reset">
    <li class="k-current-page"><span class="k-link k-pager-nav">1</span></li>
    <li><span class="k-state-selected">1</span></li>
     
    </ul>
    <a href="javascript:void(0);" title="Trang sau" class="k-link k-pager-nav" data-page="2" tabindex="-1">
    <span class="k-icon k-i-arrow-e">Trang sau</span></a>
    <a href="javascript:void(0);" title="Trang cuối" class="k-link k-pager-nav k-pager-last" data-page="3" tabindex="-1">
    <span class="k-icon k-i-seek-e">Trang cuối</span>
    </a>
    <span class="k-pager-info k-label">Đang tải hàng hóa...</span><!--Hiển thị 0 - 0 trên tổng số 0 hàng hóa-->
    </div>
    </div>
    </div>
    
        </article>
        
        
        <div style="display: none">
        
        <div kendo-window="categoryWindow" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="550" k-modal="true" style="padding-bottom: 20px; display: block;" data-role="window" class="k-window-content k-content" tabindex="0">
    <section class="addCategory uln ovh lbl-cl control-poup">
        <ul class="formBox ovh fr">

            <li>
                <label>
                    <span class="titleFr ng-binding">Tên nhóm</span>
                    <input type="text" class="iptName ng-pristine ng-valid-maxlength ng-touched ng-empty ng-invalid ng-invalid-required" ng-model="category.name" maxlength="255" required="" style="width: 270px" />
                    <input type="hidden" ng-model="category.id" />
                </label>
            </li>
            <li>
                <label>
                    <span class="titleFr ng-binding">Nhóm cha</span>
                    <span title="" class="k-widget k-dropdown k-header" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" style="width: 270px;" aria-activedescendant="985764ee-2929-4ee1-a1d1-5bad7d035d9a">
                    <span unselectable="on" class="k-dropdown-wrap k-state-default">
                    <span unselectable="on" class="k-input ng-scope">---Lựa chọn---</span>
                    <span unselectable="on" class="k-select">
                    <span unselectable="on" class="k-icon k-i-arrow-s">select</span>
                    </span>
                    </span>
                    <div class="k-animation-container" style="width: 270px; height: 202px; margin-left: 0px; padding-left: 0px; padding-right: 0px; padding-bottom: 0px; display: none; box-sizing: content-box; overflow: hidden; ">
                    <div class="k-list-container k-popup k-group k-reset" data-role="popup" style="position: absolute; font-size: 12px; font-family: Arial, Helvetica, sans-serif; font-stretch: normal; font-style: normal; font-weight: normal; line-height: normal; width: 268px; height: 200px; ">
                    <div class="k-group-header" style="display:none"></div>
                    <div class="k-list-scroller" unselectable="on" style="height: 200px;">
                    <ul unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
                    <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope k-state-selected k-state-focused" data-offset-index="0" id="985764ee-2929-4ee1-a1d1-5bad7d035d9a">---Lựa chọn---</li>
                     
                    </ul>
                    </div>
                    </div>
                    </div>
                    <select kendo-drop-down-list="" k-options="dropdownlistcat" ng-model="category.parent_id" k-value-primitive="true" style="width: 270px; display: none;" data-role="dropdownlist">
                    <option value="0" selected="selected">---Lựa chọn---</option>
                     
                    </select>
                    </span>
                </label>
            </li>
            <li class="boxBtn txtL" style="margin-top: 15px;">
                <span class="titleFr">&nbsp;</span>
                <a href="javascript:void(0);" class="kv2Btn ng-binding" onclick="saveCategory()"><i class="fa fa-floppy-o"></i>Lưu</a>
                <a href="javascript:void(0);" class="kv2Btn kv2BtnYellow ng-binding" onclick="cancelCategory()"><i class="fa fa-ban"></i>Bỏ qua</a>
                <a href="javascript:void(0);" class="kv2Btn kv2BtnDel ng-binding ng-hide" ng-show="category.Id>0" onclick="deleteCategory()"><i class="fa fa-trash"></i>Xóa</a>
            </li>
        </ul>
    </section>
</div>

<kv-product-form form-name="productForm" kv-width="880" class="ng-isolate-scope">
<form name="productForm" class="k-window-poup poup-sc ng-valid-maxlength ng-dirty ng-invalid ng-invalid-required ng-valid-parse">
    <section class="boxInfo addProduct2 control-poup lbl-cl" style="padding: 20px 30px 30px;">
        <article class="boxForm boxForm1 uln  fll w100 mb10">
            <h3 class="ng-binding">Thông tin</h3>
            <ul class="formBox fll   fr">
                <li>
                    <label>
                        <span class="titleFr ng-binding">Mã hàng hóa</span>
                        <input type="text" onblur="checkCode(this,1)" ng-model="product.code" tabindex="1" kv-select-text="" placeholder="Mã hàng tự động" kv-valid-special-chars="Mã hàng hóa" class="ng-pristine ng-valid ng-empty ng-touched">
                        
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Mã hàng hóa là thông tin duy nhất"><i class="fa fa-info-circle"></i></a>
                        <a class="quick-sale" title="Dùng camera quét" onclick="camera()"><i class="mask mask-quick-sale"></i></a>
                    </label>
                </li>

                <li>
                    <label>
                        <span class="titleFr ng-binding">Tên hàng hóa</span>
                        <input type="text" onblur="checkPrettyCheckbox(this)" placeholder="" tabindex="2" class="iptName ng-pristine ng-touched ng-empty ng-invalid ng-invalid-required" ng-model="product.name" required="" kv-select-text="" kv-valid-special-chars="Tên hàng hóa">
                        <input type="hidden" ng-model="product.id" /> 
                        <input type="hidden" ng-model="product.type" /> 
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Tên hàng hóa là tên của sản phẩm"><i class="fa fa-info-circle"></i></a>
                    </label>
                </li>
                <li>
                    <label>
                        <span class="titleFr ng-binding">Nhóm hàng</span>
                        <span title="" class="k-widget k-dropdown k-header product-select" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="3" aria-owns="" aria-disabled="false" aria-readonly="false" style="" aria-busy="false" aria-activedescendant="f09f387a-f7d1-4987-b4b4-d70c2e587ec9">
                        <span unselectable="on" class="k-dropdown-wrap k-state-default">
                        <span unselectable="on" class="k-input ng-scope">BIA &amp; THUỐC LÁ</span>
                        <span unselectable="on" class="k-select">
                        <span unselectable="on" class="k-icon k-i-arrow-s">select</span>
                        </span>
                        </span>
                        <div class="k-animation-container" style="position: absolute; top: 32px; z-index: 112; box-sizing: content-box; width: 230px; max-height: 300px; overflow-y: auto; overflow-x: hidden; display: none;"> 
                        <div class="k-list-container k-popup k-group k-reset"> 
                            <div class="k-list-scroller" unselectable="on" style="height: auto;">
                            <ul unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
                            <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope" data-offset-index="0">---Lựa chọn---</li>
                             
                            </ul>
                            </div>
                            </div>
                        </div>
                        <select kendo-drop-down-list="ddlCategory" k-options="dropdownlistcat" ng-model="product.category" class="product-select" data-role="dropdownlist" style="display: none;">
                        <option value="" selected="selected">---</option>
                        
                        </select>
                        </span>
                        <a onclick="EditCategory(0)" href="javascript:void(0)" class="icon add" title="Thêm nhóm hàng"><i class="fa fa-plus"></i></a>
                         
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Lựa chọn nhóm hàng cho sản phẩm"><i class="fa fa-info-circle"></i></a>
                    </label>
                </li>
                <li>
                    <label>
                        <span class="titleFr ng-binding">Giá bán</span>
                        <input type="text" class="iptSL iptR txtR product-text ng-pristine ng-valid ng-touched ng-not-empty" tabindex="4" ng-model="product.price" kv-auto-numeric="{mDec:0}" k-min="0">

                        <aside class="frRadioCheck frRadioCheckNormal product-aside hth-hide">
                            <a ng-click="addPricebook()" href="javascript:void(0)" class="tlbg ng-binding" kv-btn-scroll=""><i class="fa fa-share-square"></i>Thiết lập cho bảng giá</a>
                        </aside>
                    </label>
                </li>
                <li ng-hide="product.type==1" class="">
                    <label>
                        <span class="titleFr ng-binding">Giá vốn</span>
                        <input type="text" class="iptSL iptR txtR product-text ng-pristine ng-untouched ng-valid ng-not-empty" tabindex="6" ng-model="product.price2" kv-auto-numeric="{mDec:0}" k-min="0">
                         
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Giá vốn dùng để tính lợi nhuận cho sản phẩm (sẽ tự động thay đổi khi thay đổi phương pháp tính giá vốn)"><i class="fa fa-info-circle"></i></a>
                    </label>
                </li>
                <li class="li-last li-even" ng-show="product.type==2">
                    <label>
                        <span class="titleFr ng-binding">Tồn kho</span>
                        <input type="text" onblur="checknumber(this)" class="iptSL iptR txtR product-text ng-pristine ng-untouched ng-valid ng-not-empty" tabindex="6" ng-model="product.quantity" kv-auto-numeric="{mDec:3}" k-min="0" ng-disabled="!rights.editOnHand">
                         
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Số lượng tồn kho của sản phẩm (sẽ tự động tạo ra phiếu kiểm kho cho sản phẩm)"><i class="fa fa-info-circle"></i></a>
                     </label>
                </li>
                <li ng-show="product.type==2" ng-hide="!cfs.UseExpireTime">
                    <label>
                        <span class="titleFr ng-binding">Hạn sử dụng</span>
                        <span class="k-widget k-datepicker k-header">
                        <span class="k-picker-wrap k-state-default">
                        <input type="text" kendo-date-picker="" ng-model="product.expire" k-format="'yyyy-MM-dd'" placeholder="dd/mm/yyyy" k-options="datePickerOptions" data-role="datepicker" class="k-input" role="combobox" aria-expanded="false" aria-disabled="false" aria-readonly="false" style="width: 100%;" id="dp1503766892752"><span unselectable="on" class="k-select" role="button"><span unselectable="on" class="k-icon k-i-calendar">select</span></span></span></span>
                    </label>
                </li>
                <li class="li-last li-even ng-hide" ng-show="cfs.UseCod &amp;&amp; product.type!=3">
                    <label>
                        <span class="titleFr ng-binding">Trọng lượng</span>
                        <input type="text" class="iptSL iptR txtR product-text ng-pristine ng-untouched ng-valid ng-empty" tabindex="6" ng-model="product.weight" kv-auto-numeric="{mDec:3}" k-min="0" ng-disabled="!rights.editOnHand">
                         
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Sử dụng để tính trọng lượng khi giao hàng"><i class="fa fa-info-circle"></i></a>
                    </label>
                </li> 
                <li class="li-last li-even ng-hide" ng-show="cfs.RewardPoint &amp;&amp; cfs.PointSetting.Type==1 &amp;&amp; product.ispoint">
                    <label>
                        <span class="titleFr ng-binding">Điểm thưởng</span>
                        <input type="text" class="iptSL iptR txtR product-text ng-pristine ng-untouched ng-valid ng-empty" tabindex="6" ng-model="product.point" kv-auto-numeric="{mDec:3}" k-min="0" ng-disabled="!rights.editOnHand">                                                 
                    </label>
                </li> 
                <li>
                    <span class="titleFr label-checkbox">Lựa chọn khác</span>
                    <aside class="frRadioCheck frRadioCheckNormal lbl-qlcb product-choose has-pretty-child ng-hide" ng-show="product.ProductType==pTypeValue.Purchased &amp;&amp; appSetting.UseImei &amp;&amp; !isCafe">
                        <div class="clearfix prettycheckbox labelright  blue"><input type="checkbox" ng-checked="product.IsLotSerialControl" kv-pretty-check="" kv-data-label="'Quản lý theo Serial/Imei'" ng-model="product.IsLotSerialControl" tabindex="6" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" data-label="Quản lý theo Serial/Imei" style="display: none;"><a href="javascript:void(0)" class=" "></a>
<label for="undefined" class="">Quản lý theo Serial/Imei</label></div>
                    </aside>
                    <aside class="frRadioCheck frRadioCheckNormal lbl-qlcb has-pretty-child">                        
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Sản phẩm sẽ xuất hiện trên màn hình bán hàng"><i class="fa fa-info-circle"></i></a>
                        <div class="clearfix prettycheckbox labelright  blue">
                        <input name="sell" value="1" type="checkbox" ng-checked="product.AllowsSale" kv-pretty-check="" kv-data-label="_l.productAllowsSale" ng-model="product.sell" tabindex="5" class="ng-untouched ng-valid ng-isolate-scope ng-dirty ng-not-empty" data-label="Được bán trực tiếp" style="display: none;" /><a href="javascript:void(0)"></a>
<label for="undefined" class="checked">Được bán trực tiếp</label></div>
                    </aside>
                    
                    <aside class="frRadioCheck frRadioCheckNormal lbl-qlcb has-pretty-child" ng-show="product.type==3">                        
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Dành cho các hàng hóa tính thời gian sử dụng như giờ thuê phòng, giờ hát karaoke,..(khi được đưa vào đơn hàng, thời gian sử dụng sẽ được tính tự động). Mặc định giá bán sẽ tính trên mỗi giờ sử dụng."><i class="fa fa-info-circle"></i></a>
                        <div class="clearfix prettycheckbox labelright  blue">
                        <input name="time" value="1" type="checkbox" ng-checked="product.time" kv-pretty-check="" kv-data-label="_l.productTimeType" ng-model="product.time" tabindex="5" class="ng-untouched ng-valid ng-isolate-scope ng-dirty ng-not-empty" data-label="Số lượng tính theo thời gian sử dụng (Giờ)" style="display: none;" /><a href="javascript:void(0)"></a>
<label for="undefined" class="">Số lượng tính theo thời gian sử dụng (Giờ)</label></div>
                    </aside>
                    
                    <aside class="frRadioCheck frRadioCheckNormal lbl-qlcb has-pretty-child" ng-show="product.type==2">                        
                        <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Là hàng hóa có thể bán kèm cùng với hàng hóa khác. Ví dụ hàng topping như thịt heo thêm, rau thêm, trân châu, thạch,.."><i class="fa fa-info-circle"></i></a>
                        <div class="clearfix prettycheckbox labelright  blue">
                        <input name="extra" value="1" type="checkbox" ng-checked="product.extra" kv-pretty-check="" kv-data-label="_l.productTimeType" ng-model="product.extra" tabindex="5" class="ng-untouched ng-valid ng-isolate-scope ng-dirty ng-not-empty" data-label="Là món thêm (Extra topping)" style="display: none;" /><a href="javascript:void(0)"></a>
<label for="undefined" class="">Là món thêm (Extra topping)</label></div>
                    </aside> 
                    <aside class="frRadioCheck frRadioCheckNormal lbl-qlcb has-pretty-child" ng-show="cfs.RewardPoint">                        
                         
                        <div class="clearfix prettycheckbox labelright  blue">
                        <input name="ispoint" value="1" type="checkbox" ng-checked="product.ispoint" kv-pretty-check="" kv-data-label="_l.productTimeType" ng-model="product.ispoint" tabindex="5" class="ng-untouched ng-valid ng-isolate-scope ng-dirty ng-not-empty" data-label="Tích điểm" style="display: none;" /><a href="javascript:void(0)"></a>
<label for="undefined" class="">Tích điểm</label></div>
                    </aside> 
                    
                </li>
            </ul>
            <article class="boxForm formPrice uln ar-bf box-UseManufacturing clb ng-hide" ng-show="product.type==1">
                <h3 class="mb0 title_toggle ng-binding">
                    Thành phần
                    
                    <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Hàng hóa này được cấu thành từ nhiều Nguyên liệu khác"><i class="fa fa-info-circle"></i></a>
                </h3>
                <div class="tp bd-bt-box itemBox">
                    <aside class="fll w100 formHH">
                        <ul class="formBox fll fr" style="padding-bottom: 0px;">
                            <li class="li-first li-even auto" style="width: 312px">
                                <label>
                                    <span class="titleFr ng-binding">Hàng hóa thành phần</span>
                                    <div ng-controller="ProductFormulaAutoCompleteCtrl" class="autoCompleteBox fll w100 mb10 ng-scope">
                                        <autocomplete ng-model="productSearchTerm" attr-placeholder="Thêm hàng hóa" template-id="productSearchItemTempl" attr-inputid="productSearchInput" data="products" on-type="searchTermChanged" on-select="addFormulaSelectedProduct" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty">
                                        <div class="autocomplete " id=""><input autocomplete="off"  type="text" ng-model="searchParam" placeholder="Thêm hàng hóa" class="ng-empty ng-touched" id="productSearchInput" ng-disabled="kvDisable" kv-select-text="">
                                        <div ng-show="completing" class="ng-hide">
                                        <ul>
        <li suggestion="" index="0" val="MILANO" ng-class="{active:($index == selectedIndex)}" ng-click="itemClicked(suggestion)" class="ng-binding ng-scope">
            <p class="ng-binding">MILANO</p>
            SP000001
        </li>
    </ul><div class="autoNotFound ng-hide" ng-show="searchParam &amp;&amp; suggestions.length == 0">Không tìm thấy kết quả nào phù hợp</div></div></div></autocomplete>
                                    </div>
                                    <strong ng-show="formulaSelectedProduct" class="ng-hide">
                                        <a href="javascript:void(0)" class="icon del" onclick="removeFormulaSelectedProduct(this)" title="Xóa"></a>
                                        <a href="javascript:void(0)" class="veaM ng-binding"></a>
                                    </strong>
                                </label>
                            </li>
                            <li class="li-odd"><span class="titleFr">&nbsp;</span><span class="split txtC"></span></li>
                            <li class="li-even">
                                <label>
                                    <span class="titleFr ng-binding">Số lượng</span>
                                    <input id="qFormula" type="text" class="txtR iptR ng-pristine ng-untouched ng-valid ng-not-empty" style="width: 100px;" k-min="0" kv-auto-numeric="{mDec:3}" ng-model="formulaQuantity" kv-select-text="">
                                </label>
                            </li>
                            <li class="li-odd"><span class="titleFr">&nbsp;</span><span class="split txtC"></span></li>
                            <li class="li-last li-even">
                                <span class="titleFr">&nbsp;</span>
                                <a onclick="addFormula(this)" class="kv2Btn txtN txtT btn-addnew ng-binding"><i class="fa fa-plus ic-plus"></i>Thêm</a>
                            </li>
                        </ul>
                    </aside>
                    <aside class="ovh formInfo">
                        <table cellpadding="0" cellspacing="0" width="100%" class="tblProAdd">
                            <colgroup>
                                <col style="width:50px">
                                <col style="width:120px">
                                <col>
                                <col style="width:60px">
                                <col style="width:100px">
                                <col style="width:150px">
                            </colgroup>
                            <tbody>
                                <tr class="tr-even tr-first bg-tr">
                                    <th> </th>
                                    <th class="ng-binding">Mã hàng hóa</th>
                                    <th class="ng-binding">Tên hàng hóa thành phần</th>
                                    <th class="txtR ng-binding" ng-show="rights.viewCost">Giá vốn</th>
                                    <th class="txtC ng-binding">Số lượng</th>
                                    <th class="txtR ng-binding" ng-show="rights.viewCost">Thành tiền</th>
                                </tr>
                                <!-- ngRepeat: item in product.ProductFormulas -->
                                <tr ng-show="rights.viewCost">
                                    <td colspan="5" class="txtB txtR ng-binding">Tổng giá vốn thành phần: </td>
                                    <td class="txtR ng-binding">0</td>
                                </tr>
                                <tr class="tr-even" ng-show="product.ProductFormulas==null||product.ProductFormulas.length ==0">
                                    <td colspan="6" class="ng-binding">Hàng hóa này chưa có định lượng nguyên liệu.</td>
                                </tr>
                            </tbody>
                        </table>
                    </aside>
                </div>
            </article>
            

        </article>

        <article class="ovh clb addMore">
            <a href="javascript:void(0)" ng-click="showDetails = ! showDetails" kv-scroll="" class="addMoreMain ng-binding">
                <i class="fa fa-plus-square"></i>Thông tin mở rộng
            </a>
        </article>        
        <section class="ovh2 addMoreBox bd-bf" >
            
            <article class="boxForm formPrice uln ar-bf" ng-show="product.type==2">
                <a class="fll icon toggle active" ng-class="{'upBlue': showFomular}" kv-scroll="" ng-click="showFomular = !showFomular"><i class="fa fa-plus-square" ng-class="{'fa-plus-square':!showFomular,'fa-minus-square':showFomular}"></i></a>
                <h3 class="mb0 title_toggle ng-binding" ng-click="showFomular = !showFomular" kv-scroll="">
                    Thành phần
                    <!--<a href="javascript:void(0)" tabindex="0" class="help icon" kv-placement="right" kv-popup-anchor="addProductHelp" kv-window-pop="true" kv-window-width="722" kv-popup-text="{{_l.product_HelpFormula}}"><i class="fa fa-info-circle" style="margin-left: 5px;"></i></a>-->
                    <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Hàng hóa này được cấu thành từ nhiều Nguyên liệu khác"><i class="fa fa-info-circle"></i></a>
                </h3>
                <div ng-show="showFomular" class="tp bd-bt-box itemBox product-showFomular ng-hide">
                    <aside class="fll w100 formHH">
                        <ul class="formBox fll fr">
                            <li class="li-first li-even auto product-showFomular-li">
                                <label>
                                    <span class="titleFr ng-binding">Hàng hóa thành phần</span>
                                    <div ng-controller="ProductFormulaAutoCompleteCtrl" class="autoCompleteBox fll w100 ng-scope">
                                        <autocomplete ng-model="productSearchTerm" attr-placeholder="Thêm hàng hóa" template-id="productSearchItemTempl" attr-inputid="productSearchInput" data="products" on-type="searchTermChanged" on-select="addFormulaSelectedProduct" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty">
                                        <div class="autocomplete " id=""><input  autocomplete="off" type="text" ng-model="searchParam" placeholder="Thêm hàng hóa" class="ng-empty" id="productSearchInput" ng-disabled="kvDisable" kv-select-text=""><div ng-show="completing" class="ng-hide"><ul>
         
    </ul><div class="autoNotFound ng-hide" ng-show="searchParam &amp;&amp; suggestions.length == 0">Không tìm thấy kết quả nào phù hợp</div></div></div></autocomplete>
                                    </div>
                                    <strong ng-show="formulaSelectedProduct" class="ng-hide">
                                        <a href="javascript:void(0)" class="icon del" onclick="removeFormulaSelectedProduct(this)" title="Xóa"></a>
                                        <a href="javascript:void(0)" class="veaM ng-binding"></a>
                                    </strong>
                                </label>
                            </li>
                            <li class="li-odd"><span class="titleFr">&nbsp;</span><span class="split txtC"></span></li>
                            <li class="li-even">
                                <label>
                                    <span class="titleFr ng-binding">Số lượng</span>
                                    <input id="qFormula" type="text" class="txtR iptR product-showFomular-even ng-pristine ng-untouched ng-valid ng-not-empty" k-min="0" kv-auto-numeric="{mDec:3}" ng-model="formulaQuantity" kv-select-text="">
                                </label>
                            </li>
                            <li class="li-odd"><span class="titleFr">&nbsp;</span><span class="split txtC"></span></li>
                            <li class="li-last li-even">
                                <span class="titleFr">&nbsp;</span>
                                <a onclick="addFormula(this)" class="kv2Btn txtN txtT btn-addnew ng-binding"><i class="fa fa-plus ic-plus"></i>Thêm</a>
                            </li>
                        </ul>
                    </aside>
                    <aside class="formInfo">
                        <table cellpadding="0" cellspacing="0" width="100%" class="tblProAdd">
                            <colgroup>
                                <col class="col-1">
                                <col class="col-2">
                                <col>
                                <col class="col-2">
                                <col class="col-3">
                                <col class="col-2">
                            </colgroup>
                            <tbody>
                                <tr class="tr-even tr-first bg-tr">
                                    <th> </th>
                                    <th class="ng-binding">Mã hàng hóa</th>
                                    <th class="ng-binding">Tên hàng hóa thành phần</th>
                                    <th class="txtR ng-binding" ng-show="rights.viewCost">Giá vốn</th>
                                    <th class="txtC ng-binding">Số lượng</th>
                                    <th class="txtR ng-binding" ng-show="rights.viewCost">Thành tiền</th>
                                </tr>
                                <!-- ngRepeat: item in product.ProductFormulas -->
                                <tr ng-show="rights.viewCost">
                                    <td colspan="5" class="txtB txtR ng-binding">Tổng giá vốn thành phần: </td>
                                    <td class="txtR ng-binding">0</td>
                                </tr>
                                <tr class="tr-even" ng-show="product.ProductFormulas==null||product.ProductFormulas.length ==0">
                                    <td colspan="6" class="ng-binding">Hàng hóa này chưa có định lượng nguyên liệu.</td>
                                </tr>
                            </tbody>
                        </table>
                    </aside>
                </div>
            </article>
            
            <article class="boxForm uln ar-bf" ng-show="product.type==2">
                <a class="fll icon toggle" ng-class="{'upBlue': showFomular}" kv-scroll="" ng-click="showUnit = !showUnit"><i class="fa fa-plus-square" ng-class="{'fa-plus-square':!showUnit,'fa-minus-square':showUnit}"></i></a>
                <h3 class="mb0 title_toggle ng-binding" kv-scroll="" >Định mức tồn </h3>
                <article class="bd-bt-box itemBox formBox ng-hide">
                    <ul class="ovh mb10">
                        <li>
                            <label>
                                <span class="titleFr ng-binding">Ít nhất</span>
                                <input type="text" ng-model="product.minqty" kv-select-text="" kv-valid-special-chars="Ít nhất" class="ng-pristine ng-untouched ng-valid ng-empty">                                 
                                <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Tồn ít nhất là tồn tối thiểu của 1 sản phẩm (Hệ thống sẽ dựa vào thông tin này để cảnh báo tồn kho tối thiểu)"><i class="fa fa-info-circle"></i></a>
                            </label>
                        </li>
                        <li>
                            <label>
                                <span class="titleFr ng-binding">Lớn nhất</span>
                                <input type="text" ng-model="product.maxqty" kv-select-text="" kv-valid-special-chars="Lớn nhất" class="ng-pristine ng-untouched ng-valid ng-empty">                                 
                                <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Tồn nhiều nhất là tồn tối đa của 1 sản phẩm (Hệ thống sẽ dựa vào thông tin này để cảnh báo khi hàng hóa vượt mức tồn cho phép). 0 là không giới hạn"><i class="fa fa-info-circle"></i></a>
                            </label>
                        </li>
                    </ul>
                     
                </article>
            </article>
             
            <article class="boxForm fr uln ar-bf product-UseMultiUnit"> <!-- ng-show="product.type==2"-->
                <a class="fll icon toggle" ng-class="{'upBlue': showFomular}" kv-scroll="" ng-click="showUnit = !showUnit"><i class="fa fa-plus-square" ng-class="{'fa-plus-square':!showUnit,'fa-minus-square':showUnit}"></i></a>
                <h3 class="mb0 title_toggle ng-binding" kv-scroll="" ng-click="showUnit = !showUnit">Đơn vị tính </h3>
                <article ng-show="showUnit" class="bd-bt-box itemBox showUnit ng-hide">
                    <ul class="ovh mb10">
                        <li>
                            <label>
                                <span class="titleFr ng-binding">Đơn vị cơ bản</span>
                                <input type="text" ng-model="product.uname" kv-select-text="" kv-valid-special-chars="Đơn vị cơ bản" class="ng-pristine ng-untouched ng-valid ng-empty">
                                <!--<a href="javascript:void(0)" tabindex="0" class="help icon" kv-placement="right" kv-popup-anchor="addProductHelp" kv-window-pop="true" kv-window-width="722" kv-popup-text="{{_l.product_HelpUnit}}"><i class="fa fa-info-circle"></i></a>-->
                                <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Đơn vị của hàng hóa như: hộp, lốc, thùng…"><i class="fa fa-info-circle"></i></a>
                            </label>
                        </li>
                    </ul>
                    <table class="tblProduct mb10 fr">
                        <tbody><tr ng-show="product.ProductUnits.length >0" class="ng-hide">
                            
                            <td><span class="titleFr ng-binding">Tên đơn vị</span></td>
                            <td width="20"></td>
                            <td><span class="titleFr ng-binding">Giá trị quy đổi</span></td>
                            <td width="20"></td>
                            <td><span class="titleFr ng-binding">Giá bán</span></td>
                            <td width="20"></td>
                            <td><span class="titleFr ng-binding">Mã hàng hóa</span></td>
                            <td width="20" ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"></td>
                            <td ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint">
                                <span class="titleFr ng-binding">Điểm thưởng</span>
                            </td>
                            
                            <td width="10"></td>
                            <td></td>
                        </tr>
                         
                    </tbody></table>
                    <aside class="ovh mb20 txt-t3">
                        <a onclick="addMoreUnit()" class="txtU ng-binding">Thêm đơn vị</a><i class="fa fa-angle-double-down"></i>
                    </aside>
                </article>

            </article>
            
            <article class="boxForm uln ar-bf product-Extra addProduct" ng-hide="product.type==1"> <!-- ng-show="product.type==2"-->
                <a class="fll icon toggle" ng-class="{'upBlue': showFomular}" kv-scroll="" ng-click="showExtra = !showExtra"><i class="fa fa-plus-square" ng-class="{'fa-plus-square':!showUnit,'fa-minus-square':showUnit}"></i></a>
                <h3 class="mb0 title_toggle ng-binding" kv-scroll="" ng-click="showExtra = !showExtra">Món thêm </h3>
                <article ng-show="showExtra" class="bd-bt-box itemBox showExtra ng-hide">
                    <ul class="ovh2 mb10">
                        <li>
                            <label>
                                <span class="titleFr ng-binding">Hàng hóa món thêm</span>
                                <div class="autocomplete">
                                    <input type="text" kv-select-text="" kv-valid-special-chars="Hàng hóa món thêm" class="ng-pristine ng-untouched ng-valid ng-empty" />
                                    <div ng-show="completing" class="">
                                        <ul></ul>
                                        <div class="autoNotFound ng-hide" ng-show="searchParam &amp;&amp; suggestions.length == 0">Không tìm thấy kết quả nào phù hợp</div>
                                    </div>
                                </div>
                                <input type="hidden" ng-model="product.topping" />
                                <a href="javascript:void(0)" tabindex="0" class="help icon" kv-tooltip="" data-toggle="tooltip" data-placement="right" data-original-title="Là những mặt hàng có thể sử dụng hàng hóa này là món thêm. Ví dụ hàng sử dụng món thêm như Trà sữa, Pizza, Bún, Phở,.."><i class="fa fa-info-circle"></i></a>
                            </label>
                        </li>
                    </ul>
                    <div class="form-group product-RawMaterial product-Topping ng-hide">
                      <div class="boxScr300">
                        <table cellpadding="0" cellspacing="0" width="100%">
                          <tbody>
                            <tr>
                              <th width="30"></th>
                              <th class="tdSLC">Mã hàng hóa</th>
                              <th>Tên hàng</th>
                              <th class="txtR tdTotal" ng-show="rights.viewCost">Giá bán</th>
                            </tr>                             
                          </tbody>
                        </table>
                      </div>
                    </div>

                     
                </article>

            </article>
             
            <article class="boxForm uln ar-bf product-upload mb18">
                <a class="fll icon toggle" ng-class="{'upBlue': showOther}" kv-scroll="" ng-click="showOther = !showOther"><i class="fa fa-plus-square" ng-class="{'fa-plus-square':!showOther,'fa-minus-square':showOther}"></i></a>
                <h3 class="mb0 title_toggle ng-binding" kv-scroll="" ng-click="showOther = !showOther">Thông tin mở rộng</h3>
                <ul class="formBox ovh fr bd-bt-box at-hd itemBox pd12 ng-hide" ng-show="showOther">
 
                    <li class="li-odd ProductImageUpload ng-scope" ng-controller="ProductImageUploadCtrl">
                        <div class="img-pr">
                            <label class="img-pr-left">
                                <span class="titleFr fll ng-binding">Hình ảnh</span>
                                 
                                <div class="k-widget k-upload k-header k-upload-empty">
                                <div class="k-dropzone">
                                <div class="k-button k-upload-button">
                                <input accept="image/*;capture=camera" kendo-upload="" name="files" id="files2" type="file" k-options="uploadImages" data-role="upload" autocomplete="off">
                                <input name="image" ng-model="product.image" type="hidden" />
                                <span>Select files...</span>
                                </div>
                                <em>drop files here to upload</em>
                                </div>
                                </div>
                            </label>
                            <div style="color: red; max-height: 170px; overflow: auto;" ng-bind-html="UploadError" class="ng-binding"></div>
                            <!--<div id="progressBar" kendo-progress-bar k-options="uploadProcess"></div>-->
                        </div>
                        <div>
                            <article class="proListImg uln posR">
                                <kv-swiper kv-page-load="loadPage" kv-count-page="updateTotalPage" template-id="productListTmpl" kv-height="88" item-per-page="pageSize" swiper-name="productSwiper" kv-item-selected="deleteImage" class="ng-isolate-scope"><div class="swiper-container swiperList"><div class="swiper-wrapper" style="height: 0px; width: 0px;"><!-- ngRepeat: slide in slides track by slide.Id --><div class="swiper-slide ng-scope" ng-repeat="slide in slides track by slide.Id" kv-swiper-slide="" style="width: 0px; height: 0px;">
        <ul>
            <li ng-repeat="p in slide.items track by p.Id" ng-click="itemClicked(p)" class="ng-scope">
                <div style="width: 88px; height: 88px; overflow: hidden; background: #f9f9f9; display: table-cell; vertical-align: middle; text-align:center">
                    <img ng-src="img/default-product.png" src="img/default-product.png">
                </div>
            </li>
        </ul>
    </div><!-- end ngRepeat: slide in slides track by slide.Id --></div></div></kv-swiper>
                            </article>
                        </div>
                    </li>
                     
                    <li class="li-last li-even">
                        <label class="dpb">
                            <span class="titleFr mb10 nowrap ng-binding">Mô tả</span>
                            <textarea ng-model="product.description" class="dpb ng-pristine ng-untouched ng-valid ng-empty ng-valid-maxlength" maxlength="254"></textarea>
                        </label>
                    </li>
                </ul>
            </article>
            
            
        </section>
        <article class="boxBtn txtL txtB">
            <a ng-enter="SaveProduct()" onclick="SaveProduct()" class="kv2Btn txtN ng-binding" kv-taga-disabled="saving" tabindex="8"><i class="fa fa-floppy-o"></i>Lưu</a>
            <a ng-enter="SaveAndContinue()" ng-click="SaveAndContinue()" class="kv2Btn txtN kv2Btnbrightblue ng-binding    ng-hide" kv-taga-disabled="saving" ng-show="product.Id==0&amp;&amp;(product.MasterProductId==null||product.MasterProductId==0)" tabindex="9"><i class="fa fa-floppy-o"></i>Lưu &amp; Thêm mới</a>
            <a ng-enter="SaveAndContinueWithVariant()" ng-click="SaveAndContinueWithVariant()" kv-taga-disabled="saving" class="kv2Btn txtN ng-binding ng-hide" ng-show="product.HasVariants" tabindex="10"><i class="fa fa-plus"></i>Lưu &amp; Thêm hàng hóa cùng loại</a>
            <a onclick="cancel()" class="kv2Btn txtN kv2BtnYellow ng-binding" tabindex="11"><i class="fa fa-ban"></i>Bỏ qua</a>
        </article>
    </section>
</form>
<kv-popup id="addProductHelp" class="popupWrapper"><div class="kv2Pop pop popArrow" ng-transclude="">
    <div data-notify="showtext" class="ng-scope"></div>
</div></kv-popup>
<div style="display: none">
    <kv-product-pricebook-form form-name="productPricebookPopup" class="ng-isolate-scope"></kv-product-pricebook-form>
    <kv-category-form form-name="categoryForm" class="ng-isolate-scope"></kv-category-form>
    <kv-attribute-form form-name="attributeForm" class="ng-isolate-scope"></kv-attribute-form>
    <script type="text/x-angular-template" id="productSearchItemTempl">
        <li suggestion ng-repeat="suggestion in suggestions track by $index"
            index="{{$index}}" val="{{suggestion.Name}}" ng-class="{active:($index == selectedIndex)}" ng-click="itemClicked(suggestion)">
            <p>{{suggestion.Name}}</p>
            {{suggestion.Code}}
        </li>
    </script>
    <script type="text/x-angular-template" id="productListTmpl">
        <ul class="productListTmpl">
            <li ng-repeat="p in slide.items track by p.Id">
                <img ng-src="{{p.Image}}" width="88">
                <a href="javascript:void(0)" class="imgDel icon" ng-show="p.Id!=-9999" ng-click="itemClicked(p)"></a>
            </li>
        </ul>
    </script>
</div>
</kv-product-form>     
<div class="k-overlay" style="display: none; z-index: 10004; opacity: 0.5;"></div>
<div class=" k-window-alert  " data-role="draggable" style=" display: block;opacity: 1;  ">
 
 
<p class="confirm-message txt-cbk txt-ltd">Bạn có chắc chắn muốn kinh doanh trở lại hàng hóa này</p>
<article class="clb boxBtn txtC ovh">
<button class="btn-confirm kv2Btn"><i class="fa fa-check"></i>Đồng ý</button>
<button class="btn-cancel kv2Btn kv2BtnYellow"><i class="fa fa-ban"></i>Bỏ qua</button>
</article>
 
</div>


<div class="  k-window-alert  " data-role="draggable" style=" display: block; opacity: 1; ">
 
 
<p class="confirm-message txt-cbk txt-ltd">Bạn có chắc chắn KHÔNG muốn kinh doanh hàng hóa này?<br>Thông tin tồn kho và giao dịch sẽ vẫn được giữ.<br> Bạn có thể kinh doanh trở lại hàng hóa này trong tương lai nếu muốn.</p>
<article class="clb boxBtn txtC ovh">
<button class="btn-confirm kv2Btn"><i class="fa fa-check"></i>Đồng ý</button>
<button class="btn-cancel kv2Btn kv2BtnYellow"><i class="fa fa-ban"></i>Bỏ qua</button>
</article>
 
</div>   
        
        <script type="text/x-kendo-template" id="templProductCategory2">
        <div class="k-top ng-scope" onclick="selectCategory({{id}})">
        <span class="k-in" style="{{style}}">
        <span class="nametreeview">{{name}}</span>
        <a class="edittreeview" onclick="EditCategory({{id}})" title="Sửa"><i class="fa fa-pencil-square-o"></i></a>
        </span>
        </div>
        </script>
        <script type="text/x-kendo-template" id="templUsersInBranch">
        <tr class="{{dataItem.class}}" data-uid="{{dataItem.class}}" role="row">
                                <td class="" role="gridcell"><a href="/#/Users?Code={{dataItem.username}}" target="_blank">{{dataItem.name}}</a></td>
                                <td class="tdBranch" role="gridcell">{{dataItem.username}}</td>
                                <td class="tdBranch" role="gridcell">{{dataItem.role}}</td>
                                </tr>
         
        </script>
        <script type="text/x-kendo-template" id="templBranchFirst">
        <tr class="k-master-row ng-scope cssSummaryRow" data-uid="d41dc3d5-cf5d-422c-b959-7fca3718549c" role="row" style="font-weight: bold; background: rgb(254, 252, 237);">
            <td class="k-hierarchy-cell">
                <!--a class="k-icon k-plus" href="javascript:void(0);" tabindex="-1" style="display: none;"></a-->
            </td>
            <td class="tdCode" role="gridcell"><span ng-bind="dataItem.Code" class="ng-binding"></span></td>
            <td class="tdMin" role="gridcell"><span ng-bind="dataItem.Name" class="ng-binding"></span></td>
            <td class="tdMin" style="display:none" role="gridcell"><span ng-bind="dataItem.CategoryName" class="ng-binding"></span></td>
            <td class="tdMin" style="display:none" role="gridcell"><span ng-bind="dataItem.ProType" class="ng-binding"></span></td>
            <td class="tdTotal txtR ng-binding" role="gridcell"></td><td class="tdTotal txtR tdMobile ng-binding" role="gridcell"></td>
            <td class="tdTotal txtR" role="gridcell"><span ng-bind="dataItem.OnHand" class="ng-binding">0</span></td>
            <td class="tdBranch txtR ng-binding" style="display:none" role="gridcell"></td>
            <td class="tdBranch txtR ng-binding" style="display:none" role="gridcell"></td>
            <td class="tdDebt" style="display:none" role="gridcell"><span ng-bind="dataItem.isActive" class="ng-binding"></span></td></tr>
        </script>
        <script type="text/x-kendo-template" id="templBranch">
        <tr class="{{dataItem.class}} k-master-row ng-scope" data-uid="{{dataItem.id}}" role="row">
            <td class="k-hierarchy-cell">
                <!--a class="k-icon k-plus" href="javascript:void(0);" tabindex="-1"></a-->
                <label class="clearfix prettycheckbox labelright blue">
                    <input type="checkbox" ng-model="choose" value="{{dataItem.id}}" kv-change="" kv-pretty-check="" kv-data-label="" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-empty" style="display: none;">
                    <a href="javascript:void(0)"></a>
                </label>
            </td>
            <td class="tdCode" role="gridcell"><span ng-bind="dataItem.Code" class="ng-binding">{{dataItem.code}}</span></td>
            <td class="tdMin" role="gridcell"><span ng-bind="dataItem.Name" class="ng-binding">{{dataItem.name}}</span></td>
            <td class="tdMin" style="display:none" role="gridcell"><span ng-bind="dataItem.CategoryName" class="ng-binding">BIA &amp; THUỐC LÁ</span></td>
            <td class="tdMin" style="display:none" role="gridcell"><span ng-bind="dataItem.ProType" class="ng-binding">Hàng hóa</span></td>
            <td class="tdTotal txtR ng-binding" role="gridcell">{{dataItem.price}}</td>
            <td class="tdTotal txtR tdMobile ng-binding" role="gridcell">{{dataItem.price2}}</td>
            <td class="tdTotal txtR" role="gridcell"><span ng-bind="dataItem.OnHand" class="ng-binding main{{dataItem.main}}">{{dataItem.quantity}}</span></td>
            <td class="tdBranch txtR ng-binding" style="display:none" role="gridcell">---</td>
            <td class="tdBranch txtR ng-binding" style="display:none" role="gridcell">---</td>
            <td class="tdDebt" style="display:none" role="gridcell"><span ng-bind="dataItem.isActive" class="ng-binding">Cho phép kinh doanh</span></td>
            </tr>
        </script>
        <script type="text/x-kendo-template" id="templTheKho">
        <tr class="k-alt" data-uid="138b837c-0864-427a-a5cc-7139be161f69" role="row">
            <td class="tdCode" role="gridcell"><a href="javascript:void(0)" class="documentCode" kv-btn-scroll="" data-id="4765390" data-code="PN000025" data-type="2">PN000025</a></td>
            <td class="tdMin" role="gridcell">Nhập hàng</td>
            <td class="tdDateTime" role="gridcell">03/05/2016 00:00</td>
            <td class="txtR tdTotal" role="gridcell">20,500</td>
            <td class="tdSLB txtR" role="gridcell">19</td>
            <td class="tdTotal txtR" role="gridcell">33</td>
        </tr>
        </script>
        <script type="text/x-kendo-template" id="templBranchDetail">
            <tr class="k-detail-row k-alt ng-scope" >
            <td class="k-hierarchy-cell"></td>
            <td class="k-detail-cell" colspan="5">
        <div class="k-tabstrip-wrapper" style=""><div class="tabstrip k-widget k-header k-tabstrip k-floatwrap k-tabstrip-top" data-role="tabstrip" tabindex="0" role="tablist" aria-activedescendant="tabInventory">
            <ul class="k-tabstrip-items k-reset">
            <li class="ng-binding k-item k-state-default k-first k-tab-on-top k-state-active" role="tab" aria-controls="{{dataItem.id}}-1" aria-selected="true"> <span class="k-loading k-complete"></span><span class="k-link">Thông tin</span></li>
            <li id="tabInventory" class="ng-binding k-item k-state-default" role="tab" aria-controls="{{dataItem.id}}-2" ><span class="k-loading k-complete"></span><span class="k-link">Thẻ kho</span></li>
            <li id="tabOnHand" ng-show="dataItem.ProductType==pTypeValue.Purchased" class="ng-binding k-item k-state-default hth-hide" role="tab" aria-controls="{{dataItem.id}}-3"><span class="k-loading k-complete"></span><span class="k-link">Tồn kho</span></li>
            <li ng-show="false" id="tabVariants" class="ng-binding ng-hide k-item k-state-default" role="tab" aria-controls="{{dataItem.id}}-4"><span class="k-loading k-complete"></span><span class="k-link">Hàng hóa cùng loại</span></li>
            <li ng-show="false" id="tabFormula" class="ng-binding ng-hide k-item k-state-default" role="tab" aria-controls="{{dataItem.id}}-5"><span class="k-loading k-complete"></span><span class="k-link">Thành phần</span></li>
            <li id="tabSerialList" ng-show="dataItem.IsLotSerialControl" class="ng-binding ng-hide k-item k-state-default k-last" role="tab" aria-controls="{{dataItem.id}}-6"><span class="k-loading k-complete"></span><span class="k-link">Serial/Imei</span></li>
            <li id="tabConvert" class="ng-binding k-item k-state-default k-last" role="tab" aria-controls="{{dataItem.id}}-7"><span class="k-loading k-complete"></span><span class="k-link">Chuyển đổi</span></li>
            </ul>
            <div id="{{dataItem.id}}-1" class="k-content k-state-active" role="tabpanel" aria-expanded="true" style="display:block;" >
                <article class="title ng-binding">{{dataItem.name}}</article>
                <p>
                    <i class="fa fs16 fa-check {{dataItem.sellclass}}"></i> <span class="txtB ng-binding">{{dataItem.sell}}</span>
                    <i class="fa fs16 fa-check {{dataItem.timeclass}}"></i> <span class="txtB ng-binding txtGreen {{dataItem.timeclass}}">Là hàng dịch vụ tính theo thời gian sử dụng</span>
                    <i class="fa fs16 fa-check {{dataItem.extraclass}}"></i> <span class="txtB ng-binding txtGreen {{dataItem.extraclass}}">Là món thêm</span>
                </p>
                <div class="ovh clb">
                    <div class="col-left">
                        <article class="clb mb15 ovh tblBox productInfo">
                            <table class="w100">
                                <tbody><tr>
                                    <td width="220" class="veaT">
                                        <img style="width: 180px; margin-top:5px;" ng-src="{{dataItem.image}}" src="{{dataItem.image}}">
                                    </td>
                                    <td class="veaT">
                                        <div class="table-responsive">
                                            <table class="table">
                                                <tbody><tr>
                                                    <td width="100" class="br0 ng-binding">Mã hàng hóa:</td>
                                                    <td class="br0"><strong class="ng-binding">{{dataItem.code}}</strong></td>
                                                </tr>
                                                <tr>
                                                    <td class="ng-binding">Nhóm hàng:</td>
                                                    <td class="ng-binding">{{dataItem.group}}</td>
                                                </tr>
                                                <tr>
                                                    <td class="ng-binding">Loại hàng:</td>
                                                    <td class="ng-binding">{{dataItem.type}}</td>
                                                </tr>
                                                <tr ng-show="dataItem.type!=3 &amp;&amp; dataItem.parent==0" class="ng-hide">
                                                    <td class="ng-binding">Định mức tồn:</td>
                                                    <td>{{dataItem.minqty}} <span class="icon icon5" style="margin:0 5px; display:inline-block!important"><i class="fa fa-angle-right"></i></span> {{dataItem.maxqty}}</td>
                                                </tr>
                                                <tr>
                                                    <td class="ng-binding">Giá bán:</td>
                                                    <td class="ng-binding">{{dataItem.price}}</td>
                                                </tr>
                                                <tr ng-show="dataItem.MasterUnitId==null &amp;&amp; rights.viewCost" class="ng-hide">
                                                    <td class="ng-binding">Giá vốn:</td>
                                                    <td class="ng-binding">{{dataItem.price2}}</td>
                                                </tr>
                                                <tr ng-show="cfs.UseExpireTime &amp;&amp; dataItem.expire" >
                                                    <td class="ng-binding">Hạn sử dụng:</td>
                                                    <td class="ng-binding">{{dataItem.expire}}</td>
                                                </tr>
                                            </tbody></table>
                                        </div>
                                    </td>
                                    <td class="tdLine"><span>&nbsp;</span></td>
                                    <td class="veaT" style="width:200px">
                                        <section class="posR ovh w100">
                                            <article class="proListImg uln ng-scope" ng-controller="ProductImageListCtrl" data="dataItem">
                                                <kv-swiper kv-page-load="loadPage" kv-count-page="updateTotalPage" template-id="productListTmpl" kv-height="200" item-per-page="pageSize" swiper-name="productSwiper" kv-item-selected="changeImage" class="ng-isolate-scope"><div class="swiper-container swiperList"><div class="swiper-wrapper" style="height: 200px; width: 200px;"><!-- ngRepeat: slide in slides track by slide.Id --><div class="swiper-slide ng-scope" ng-repeat="slide in slides track by slide.Id" kv-swiper-slide="" style="width: 200px; height: 200px;">
        <ul>
            <li ng-repeat="p in slide.items track by p.Id" ng-click="itemClicked(p)" class="ng-scope">
                <div style="width: 88px; height: 88px; overflow: hidden; background: #f9f9f9; display: table-cell; vertical-align: middle; text-align:center">
                    <img ng-src="{{dataItem.image}}" src="{{dataItem.image}}">
                </div>
            </li>
        </ul>
    </div> </div></div></kv-swiper>
                                                 
                                            </article>
                                        </section>
                                    </td>
                                </tr>
                            </tbody></table>
                        </article>
                    </div>
                    <div class="col-btn">
                        <article class="txtL boxBtn">
                            <a onclick="UpdateProduct({{dataItem.id}})" class="kv2Btn ng-binding" ng-show="_p.has('Product_Update')" kv-btn-scroll=""><i class="fa fa-check-square"></i> Cập nhật</a>
                            <a onclick="ActiveProduct({{dataItem.id}})" class="kv2Btn ng-binding" ng-show="!dataItem.status"><i class="fa fa-check"></i> Cho phép kinh doanh</a>
                            <a onclick="PrintProduct({{dataItem.id}})" class="kv2Btn kv2BtnYellow ng-binding"><i class="fa fa-barcode"></i> In mã vạch</a>
                            <a onclick="DeleteProduct({{dataItem.id}})" class="kv2Btn kv2BtnDel ng-binding" ng-show="_p.has('Product_Delete')"><i class="fa fa-trash"></i> Xóa</a>
                            <a onclick="ActiveProduct({{dataItem.id}})" class="kv2Btn kv2BtnDel ng-binding" ng-show="dataItem.status"><i class="fa fa-lock"></i> Ngừng kinh doanh</a>
                        </article>
                    </div>
                </div>
            </div>


            <div class="k-content " id="{{dataItem.id}}-2" role="tabpanel" aria-expanded="false"  style="display: none; ">
                <article class="clb ovh">
                    <span class="dpb mb10 ng-binding hth-hide" ng-show="dataItem.MasterUnitId!=null">Lưu ý: Thẻ kho được tính trên đơn vị cơ bản, tồn cuối tương ứng với đơn vị (<strong class="ng-binding">dieu</strong>) là : <em class="ng-binding">160</em></span>
                    <div id="tblInvenroty" class="mb15 k-grid k-widget" data-role="grid">
                    <div class="k-grid-header" style="padding-right: 17px;">
                    <div class="k-grid-header-wrap k-auto-scrollable">
                    <table role="grid">
                    <colgroup><col><col><col><col><col><col></colgroup>
                    <thead role="rowgroup">
                    <tr role="row">
                    <th scope="col" role="columnheader" data-field="DocumentCode" rowspan="1" data-title="Chứng từ" data-index="0" id="9846117c-39dc-405b-a1c5-3369a93ee25c" class="tdCode k-header">Chứng từ</th>
                    <th scope="col" role="columnheader" data-field="DocumentType" rowspan="1" data-title="Phương thức" data-index="1" id="e6cdbe3a-a6b9-43fe-8d98-6567b9358563" class="tdMin k-header">Phương thức</th>
                    <th scope="col" role="columnheader" data-field="TransDate" rowspan="1" data-title="Thời gian" data-index="2" id="9ef13c89-d44b-4512-9539-98e3773aaa7a" class="tdDateTime k-header">Thời gian</th>
                    <th scope="col" role="columnheader" data-field="Cost" rowspan="1" data-title="Giá vốn" data-index="3" id="26b64f9e-9438-49df-b193-90c1a433d01c" class="txtR tdTotal k-header">Giá vốn</th>
                    <th scope="col" role="columnheader" data-field="Quantity" rowspan="1" data-title="Số lượng" data-index="4" id="1cd019c2-9c96-46d2-9b72-c0e6e7d3ba79" class="tdSLB txtR k-header">Số lượng</th>
                    <th scope="col" role="columnheader" data-field="EndingStocks" rowspan="1" data-title="Tồn cuối" data-index="5" id="62388900-68c2-4a73-b236-ab268dbd9d6a" class="tdTotal txtR k-header">Tồn cuối</th>
                    </tr></thead></table>
                    </div>
                    </div>
                    <div class="k-grid-content k-auto-scrollable k-grid-content-ac">
                    <table role="grid">
                    <colgroup><col><col><col><col><col><col></colgroup>
                    <tbody role="rowgroup">
                     
                    </tbody>
                    </table>
                    </div>
                    <div class="paging-box">
                    <div class="k-pager-wrap k-grid-pager k-widget k-floatwrap" data-role="pager">
                        <a href="javascript:void(0);" title="Go to the first page" class="k-link k-pager-nav k-pager-first k-state-disabled" data-page="1" tabindex="-1">
                        <span class="k-icon k-i-seek-w">Go to the first page</span>
                        </a>
                        <a href="javascript:void(0);" title="Go to the previous page" class="k-link k-pager-nav k-pager-prev k-state-disabled" data-page="1" tabindex="-1">
                        <span class="k-icon k-i-arrow-w">Go to the previous page</span>
                        </a>
                        <ul class="k-pager-numbers k-reset">
                        <li class="k-current-page"><span class="k-link k-pager-nav">1</span></li>
                        <li><span class="k-state-selected">1</span></li>
                        <!--li><a tabindex="-1" href="javascript:void(0);" class="k-link" data-page="2">2</a></li-->
                        </ul>
                        <a href="javascript:void(0);" title="Go to the next page" class="k-link k-pager-nav k-pager-next" data-page="2" tabindex="-1">
                        <span class="k-icon k-i-arrow-e">Go to the next page</span>
                        </a>
                        <a href="javascript:void(0);" title="Go to the last page" class="k-link k-pager-nav k-pager-last" data-page="2" tabindex="-1">
                        <span class="k-icon k-i-seek-e">Go to the last page</span>
                        </a>
                        <span class="k-pager-info k-label">Hiển thị 0 - 0 trên tổng số 0 giao dịch</span>
                    </div>
                    </div>
                    </div>
                    <article class="clb txtR boxBtn ovh">
                        <a ng-click="exportInventory()" class="kv2Btn kv2BtnYellow kv2BtnExport ng-binding"><i class="fa fa-sign-out"></i> Xuất  file</a>
                    </article>
                </article>
            </div>
            <div class="tblOnHand k-content" id="{{dataItem.id}}-3" role="tabpanel" aria-hidden="true" aria-expanded="false">
                <div id="tblOnHand" class="clb k-grid k-widget" data-role="grid"><div class="k-grid-header" style="padding-right: 17px;"><div class="k-grid-header-wrap k-auto-scrollable"><table role="grid"><colgroup><col><col><col></colgroup><thead role="rowgroup"><tr role="row"><th scope="col" role="columnheader" data-field="Name" rowspan="1" data-title="Chi nhánh" data-index="0" id="0bda0d70-4cc1-4877-b2e9-641e2ca84239" class="k-header" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Chi nhánh</a></th><th scope="col" role="columnheader" data-field="OnHand" rowspan="1" data-title="Tồn kho" data-index="1" id="5165d2e2-4941-415a-905f-f9e0ed68bc9f" class="tdSLB txtR k-header" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Tồn kho</a></th><th scope="col" role="columnheader" data-field="Reserved" rowspan="1" data-title="Đặt hàng" data-index="2" id="7ce26bf0-1691-43aa-a8ec-1a3845ce2cc2" class="tdSLB txtR k-header" data-role="columnsorter"><a class="k-link" href="javascript:void(0);">Đặt hàng</a></th></tr></thead></table></div></div><div class="headRow">14<span class="dpib reservedTotal">0</span></div><div class="k-grid-content k-auto-scrollable"><table role="grid"><colgroup><col><col><col></colgroup><tbody role="rowgroup"><tr data-uid="78067ae0-9e79-42e4-999d-03056ae3eeb4" role="row"><td class="" role="gridcell">1</td><td class="tdSLB txtR" role="gridcell">0</td><td class="tdSLB txtR" role="gridcell">0</td></tr><tr class="k-alt" data-uid="58aaad02-e3bf-43ed-97a9-c908a37e8c98" role="row"><td class="" role="gridcell">Chi nhánh trung tâm</td><td class="tdSLB txtR" role="gridcell">14</td><td class="tdSLB txtR" role="gridcell">0</td></tr></tbody></table></div><div class="paging-box" style="display: none;"><div class="k-pager-wrap k-grid-pager k-widget k-floatwrap" data-role="pager"><a href="javascript:void(0);" title="Go to the first page" class="k-link k-pager-nav k-pager-first k-state-disabled" data-page="1" tabindex="-1"><span class="k-icon k-i-seek-w">Go to the first page</span></a><a href="javascript:void(0);" title="Go to the previous page" class="k-link k-pager-nav  k-state-disabled" data-page="1" tabindex="-1"><span class="k-icon k-i-arrow-w">Go to the previous page</span></a><ul class="k-pager-numbers k-reset"><li class="k-current-page"><span class="k-link k-pager-nav">1</span></li><li><span class="k-state-selected">1</span></li></ul><a href="javascript:void(0);" title="Go to the next page" class="k-link k-pager-nav  k-state-disabled" data-page="1" tabindex="-1"><span class="k-icon k-i-arrow-e">Go to the next page</span></a><a href="javascript:void(0);" title="Go to the last page" class="k-link k-pager-nav k-pager-last k-state-disabled" data-page="1" tabindex="-1"><span class="k-icon k-i-seek-e">Go to the last page</span></a><span class="k-pager-info k-label">Hiển thị 1 - 2 trên tổng số 2 chi nhánh</span></div></div></div>
            </div>
             
            <div class="k-content" id="{{dataItem.id}}-4" role="tabpanel" aria-hidden="true" aria-expanded="false">
                <article class="clb posR ovh">
                    <a href="javascript:void(0)" class="help icon posA helpSamePro" kv-placement="bottomright" kv-popup-anchor="posProductHelp"><i class="fa fa-info-circle"></i></a>
                    <!--<a href="javascript:void(0)" tabindex="0" class="help icon posA helpSamePro" kv-tooltip data-toggle="tooltip" data-placement="right" data-original-title="{{_l.product_TotalQty}}"><i class="fa fa-info-circle"></i></a>-->
                    <div id="tblAttribute" kendo-grid="tblAttribute" k-options="tblAttributeOptions" class="ovh mb15 k-grid k-widget" data-role="grid">

                    <div class="k-grid-header" style="padding-right: 17px;"><div class="k-grid-header-wrap k-auto-scrollable"><table role="grid"><colgroup><col><col><col><col><col><col></colgroup><thead role="rowgroup"><tr role="row"><th scope="col" role="columnheader" data-field="Code" rowspan="1" data-title="Mã hàng hóa" data-index="0" id="d2b36934-7c8d-4262-b4f7-d88e01687a13" class="tdCode txtL k-header ng-scope">Mã hàng hóa</th><th scope="col" role="columnheader" data-field="Name" rowspan="1" data-title="Tên hàng hóa" data-index="1" id="64f197ce-7239-440d-b3e8-be0a74ac8818" class="txtL k-header ng-scope">Tên hàng hóa</th><th scope="col" role="columnheader" data-field="BasePrice" rowspan="1" data-title="Giá bán" data-index="2" id="47a94996-660d-499f-8862-6b92f895aa2a" class="tdTime txtR k-header ng-scope">Giá bán</th><th scope="col" role="columnheader" data-field="Cost" rowspan="1" data-title="Giá vốn" data-index="3" id="61932338-8a38-4894-b9b8-d53cb0d659f2" class="tdTime tdMobile txtR k-header ng-scope">Giá vốn</th><th scope="col" role="columnheader" data-field="OnHand" rowspan="1" data-title="Tồn kho" data-index="4" id="2d05e2be-e2bd-495c-b8ad-ffaf5051bec6" class="tdSLB txtR k-header ng-scope">Tồn kho</th><th scope="col" role="columnheader" data-field="Reserved" rowspan="1" data-title="Đặt hàng" data-index="5" id="6a2e18fe-ba34-4884-b5ab-d0193b2abfc1" class="tdTime tdMobile txtR k-header ng-scope">Đặt hàng</th></tr></thead></table></div></div><div class="k-grid-content k-auto-scrollable k-grid-content-ac"><table role="grid"><colgroup><col><col><col><col><col><col></colgroup><tbody role="rowgroup"></tbody></table></div></div>
                    <article class="clb txtR boxBtn ovh">
                        <a ng-click="AddRelateProduct((dataItem.MasterProductId!=null&amp;&amp;dataItem.MasterProductId!=0)?dataItem.MasterProductId: dataItem.Id)" class="kv2Btn ng-binding"><i class="fa fa-plus"></i> Thêm hàng hóa cùng loại</a>
                    </article>

                </article>
            </div>
            <div class="k-content" id="{{dataItem.id}}-5" role="tabpanel" aria-hidden="true" aria-expanded="false">
                <article class="clb ovh">
                    <div id="tblFormula" class="ovh mb15"></div>
                    <article class="clb txtR boxBtn ovh">
                        <a ng-show="_p.has('Product_Update')" ng-click="UpdateProduct(dataItem)" class="kv2Btn ng-binding" kv-btn-scroll=""><i class="fa fa-check-square"></i> Cập nhật</a>
                    </article>
                </article>
            </div>
            <div class="k-content" id="{{dataItem.id}}-6" role="tabpanel" aria-hidden="true" aria-expanded="false">
                <div id="tblSerial" class="clb mb15"></div>
                <article class="clb txtR boxBtn ovh">
                    <a ng-click="exportSerial()" class="kv2Btn kv2BtnYellow kv2BtnExport ng-binding"><i class="fa fa-sign-out"></i> Xuất  file</a>
                </article>
             </div>
             <div class="k-content" id="{{dataItem.id}}-7" role="tabpanel" aria-hidden="true" aria-expanded="false">
                <article class="clb  ">
                    <article class="boxForm boxForm1 uln  fll w100 mb10">
             
            <ul class="formBox fll mt10  fr">
                <li>
                    <label>
                        <span class="titleFr ng-binding">Số lượng</span>
                        <input type="text" onblur="convert1(this)" ng-model="convert.quantity" tabindex="1" kv-select-text="" class="ng-pristine ng-valid ng-empty ng-touched">
                        
                         
                    </label>
                </li>

                
                <li>
                    <label>
                        <span class="titleFr ng-binding">Đổi thành</span>
                        <span title="" class="k-widget k-dropdown k-header product-select" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="3" aria-owns="" aria-disabled="false" aria-readonly="false" style="" aria-busy="false" aria-activedescendant="f09f387a-f7d1-4987-b4b4-d70c2e587ec9">
                        <span unselectable="on" class="k-dropdown-wrap k-state-default">
                        <span unselectable="on" class="k-input ng-scope">Bia thuoc la</span>
                        <span unselectable="on" class="k-select">
                        <span unselectable="on" class="k-icon k-i-arrow-s">select</span>
                        </span>
                        </span>
                        <div class="k-animation-container" style="position: absolute; top: 29px; z-index: 112; box-sizing: content-box; width: 230px; max-height: 300px; overflow-y: auto; overflow-x: hidden; display: none;"> 
                        <div class="k-list-container k-popup k-group k-reset"> 
                            <div class="k-list-scroller" unselectable="on" style="height: auto;">
                            <ul unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
                                <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope" data-offset-index="0">---Lựa chọn---</li>
                                <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope" data-offset-index="1">Nguyen vat lieu</li>
                                
                                </ul>
                            </div>
                            </div>
                        </div>
                        <select kendo-drop-down-list="ddlCategory" k-options="dropdownlistcat" ng-model="convert.product" class="product-select" data-role="dropdownlist" style="display: none;"><option value="0">---Lựa chọn---</option><option value="1">Nguyen vat lieu</option><option value="2" selected="selected">Bia thuoc la</option><option value="3">--Bia</option><option value="4">--Thuoc La</option><option value="5">Mon khai vi</option><option value="6">--Sup</option><option value="7">--Sup 2</option><option value="8">Vật liệu XD</option><option value="9">Thời trang</option><option value="10">Nội thất</option></select>
                        </span>
                        
                         
                        
                    </label>
                </li><li>
                    <label>
                        <span class="titleFr ng-binding">Sau chuyển đổi</span>
                        <input type="text" ng-model="convert.after" disabled="" tabindex="1" kv-select-text="" class="ng-pristine ng-valid ng-empty ng-touched">
                        
                         
                    </label>
                </li>
                    
                    </ul>
            

        </article>
                    <article class="clb    ovh">
                        <a onclick="doConvert()" class="kv2Btn ng-binding" kv-btn-scroll=""><i class="fa fa-recycle"></i> Chuyển đổi</a>
                    </article>
                </article>
            </div>
        </div></div>

    </td>
    </tr>
            </script>
            <script type="text/x-kendo-template" id="templProductFormula">
            <tr class="tr-even bd-tr ng-scope">
                <td class="txtC">
                    <a href="javascript:void(0)" onclick="removeFormulaItem({{i}},this)" class="icon del" title="Xóa"></a>
                    <input value="{{i}}" ng-model="item.child" type="hidden" />
                </td>
                <td class="ng-binding">{{code}}</td>
                <td class="ng-binding">{{name}}</td>
                <td class="txtR ng-binding" ng-show="rights.viewCost">{{price2}}</td>
                <td class="txtC fr"><input value="{{quantity}}" ng-model="item.quantity" type="text" class="txtR iptR ng-pristine ng-valid ng-not-empty ng-touched" style="width: 50px;" k-min="0" kv-auto-numeric="{mDec:3}"></td>
                <td class="txtR ng-binding" ng-show="rights.viewCost">{{total}}</td>
            </tr>
            </script>
            <script type="text/x-kendo-template" id="templProductUnit">
            <tr ng-repeat="item in product.ProductUnits" class="ng-scope">
                            
                            <td><input type="text" class="tdName ng-pristine ng-empty ng-invalid ng-invalid-required ng-touched" ng-model="item.name" required="" kv-select-text="" kv-valid-special-chars="Tên đơn vị" onblur="checkunit(this)"></td>
                            <td width="20"></td>
                            <td><input type="text" class="tdTime iptR txtR ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-required" ng-model="item.value" kv-auto-numeric="{mDec:3}" k-min="0" required="" ng-disabled="item.Id>0" onblur="CalcChildUnitPrice(this)"> </td>
                            <td width="20"></td>
                            <td><input type="text" onblur="checkPrice(this)" class="tdName iptR txtR ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-required" ng-model="item.price" kv-auto-numeric="{mDec:0}" k-min="0" required=""> </td>
                            <td width="20"></td>
                            <td><input type="text" onblur="checkCode(this)" class="tdName ng-pristine ng-untouched ng-valid ng-empty" ng-model="item.product_code" placeholder="Mã hàng tự động" kv-select-text=""></td>
                            
                            <td width="20" ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"></td>
                            <td ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"><input type="text" class="tdTime iptR txtR ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-required" ng-model="item.point" kv-auto-numeric="{mDec:3}" k-min="0" required="" ng-disabled="item.Id>0" /> </td>
                             
                            <td width="10"></td>
                            <td><a title="Xóa đơn vị" onclick="removeUnitItem({{i}},this)" class="icon del"><i class="fa fa-times"></i></a></td>
                        </tr>
            </script>

        </div>
    </section>
</section>

<style>
.product-upload .li-last.li-even textarea {
    height: 0;
     
}
</style>

    <script> 
    if(cb==null) cb=1
    function _checkP(){
        var q = localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
            localStorage['revision_products_'+cfs.id+'_'+cb+'']+'_total'];
        if(q)    
        return products && (products.length<q || products.filter(function(a){return a==null}).length>0);
        
        return products && products.filter(function(a){return a==null}).length>0;
    }
    
    //07/15/2020
    function fromQR(link){
        //link = "http://qrvn.cc/0030BMO";         
        link = link.match(/.cc\/([^\/]+)/)
        if(!link) return false;
        link = link[1]        
        link = link.slice(3)        
        maximumByte = bigInt(link, 62, "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz", true);   //bigInt(link, 62); 08/24/2020        
        return maximumByte.toString()-0
    }    
   
//cfs.UseCod
var url = "/Template/MauFileSanPham.xlsx";
if(cfs.UseCod)
    url = "/Template/MauFileSanPhamCOD.xlsx";
 
var $cats //= _convertProductCategories()
var $example={};
var $types = product_types /*{
    '2': 'Hàng hóa',
    '3': 'Dịch vụ',
    '1': 'Combo - đóng gói'
};*/
var sheet_add_json = []

function exportProductsExcelJS(co){ console.log(co);     
    $cats = _convertProductCategories();
    
    /* set up async GET request */
    var req = new XMLHttpRequest();
    req.open("GET", url, true);
    req.responseType = "arraybuffer";
    
    var first_sheet_name_new;
    
    req.onload = function(e) {
        var data = new Uint8Array(req.response); 
        var workbook = XLSX.read(data, {type:"array"}); console.log(workbook)
        var first_sheet_name = workbook.SheetNames[0];
        var first_sheet_name_old = first_sheet_name+''
        first_sheet_name_new = 'Xuat Hang Hoa ngay '+moment().format('DD-MM-YYYY');
        workbook.SheetNames[0] = first_sheet_name_new;
        workbook.Sheets[first_sheet_name_new] = Object.assign({}, workbook.Sheets[first_sheet_name_old]);
        delete workbook.Sheets[first_sheet_name_old]        
        var worksheet = workbook.Sheets[first_sheet_name_new];
        sheet_add_json = [];
        for(var $r in $example){ 
            var $e = $example[$r]; console.log($e)
            var $f = {'A': $types[$e.type],
            	'B': '',                	
            	'C': $e.category>0?_catPath($e.category,$cats).join('>>'):'',
                'D': $e.code,
                'E': $e.name,                     
            	'F': $e.price,
                'G': $e.price2,
                'H': $e.quantity,
                'I': $e.minqty,
                'J': $e.maxqty,  
                'K': $e.uname?$e.uname:'',
                'L': '', 
                'M': $e.uvalue?$e.uvalue:1,
                'N': '',
                'O': '',
                
                'P': $e.image,                                
            } ; console.log($f) 
            
            if(cfs.UseCod){ 
                $f = Object.assign($f, {
                    'Q': $e.weight?$e.weight:'0',
                    'R': $e.extra==1?1:0,
                    'S': $e.status==1?1:0,
                    'T': $e.sell?1:0,
                    'U': $e.description,
                    'V': '',
                    'W': $e.time==1?1:0,
                    'X': ($e.expire==''||$e.expire=='0000-00-00')?'':moment($e.expire).format('DD/MM/YYYY')
                }); console.log('$f1') 
            }else{
                $f = Object.assign($f, {
                    'Q': $e.extra==1?1:0,
                    'R': $e.status==1?1:0,
                    'S': $e.sell?1:0,
                    'T': $e.description,
                    'U': '',
                    'V': $e.time==1?1:0,
                    'W': ($e.expire==''||$e.expire=='0000-00-00')?'':moment($e.expire).format('DD/MM/YYYY')
                }); console.log('$f2') 
            }
            
            var $parent=[];
            if($e.parent>0){
                $f.L = $example[$e.parent]['code'];
                $parent = [$f.L];
            }
            if($e.topping){
                var $t = $e.topping.split(",");
                for(var kk in $t){
                    $parent.push($example[$t[kk]]['code']);
                }
            }
            if($parent.length){
                $f.O = $parent.join(',')
            }
                        
        	sheet_add_json.push($f)
        }
        delete_rows(worksheet,1,12); console.log(sheet_add_json)
        XLSX.utils.sheet_add_json(worksheet, sheet_add_json, {skipHeader: true, origin: "A2"});
 
        var buffer = XLSX.write(workbook, {bookType:"xlsx", bookSST:true, type: "array"	}) 
         
        var blob = new Blob([buffer], {type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});
        saveAs(blob,first_sheet_name_new+".xlsx");
        console.log(first_sheet_name_new)
        var d= {
            code: co,
            status: 1,
            content: 'Đã xuất file xong! Vui lòng Ctr+J để xem file download',
            file: first_sheet_name_new+".xlsx"
        }
        changeimpexp(d)         
    }
    
    req.send();
}

//04/24/2020
function fixLocalStorage(){
    if (localStorage["revision_products_"+cfs.id+"_"+cb]>0){
      for(var i in localStorage){
        if (i.indexOf("revision_products_" + cfs.id + "_" + cb+"_") === 0 && 
          i.indexOf("revision_products_" + cfs.id + "_" + cb + "_" + localStorage["revision_products_" + cfs.id + "_" + cb]) !== 0){
          delete localStorage[i]
        }
      }
    }
}
fixLocalStorage()
   
    var filter = {
        type: [1,2,3],
        ShowInActiveProduct: 1,
        keywordParam:'',
        onhandFilter: 0,
        Expire:0,
        range:'',
        user: 0,
    }
        var lipc = '<li role="treeitem" class="k-item {{class}}" data-uid="{{id}}" aria-selected="false ">';
        var ulpc = '<ul class="k-group k-treeview-lines" role="tree">';
        var lisuggest = '<li suggestion="" index="{{index}}" val="{{name}}" ng-class="{active:($index == selectedIndex)}" onclick="itemClicked(this)" class="ng-binding ng-scope">'+
            '<p class="ng-binding">{{name}}</p>'+
            '{{code}}'+
        '</li>';
        
        var trTopping = '<tr ng-repeat="item in product.ToppingsOfProduct | filter:{ isActive: true }" class="ng-scope">'+
            '<td class="txtC"><a onclick="removeTopping({{index}},this)" class="icon del" title="Xóa"></a></td>'+
            '<td class="ng-binding">{{code}}</td>'+
            '<td class="ng-binding">{{name}}</td>'+
            '<td class="txtR ng-binding">{{price}}</td>'+
            '</tr>';
        
        var templProductFormula = $('#templProductFormula').html();
        var templProductUnit = $('#templProductUnit').html();
        
        function br(){ 
            console.log('br'); 
            loadTableLeft();
        }
        
        function br2(){ //fixed 04/24/2020
            console.log('br2',products);
            var x= function(){
                //if(!products) loadJsonProducts(br);
                if(products===null){
                    setTimeout(function(){
                        br2()
                    },1000)
                }
                else br();    
            }
            if(products===undefined){
                loadProductsFromCache(x)
            }else x()
                         
        }
         
        console.log('hoi 1');
        
        //if(!product_categories) loadJsonProductCategories(br2);
        //else br2();
        loadJsonProductCategories(br2);
        if(product_categories) br2();
        
        console.log('hoi 2');
          
        function selectCategory(cid){
            if(ctg != cid){
                $('#treeviewcat li').removeClass('k-state-selected')                       
                $('#treeviewcat li[data-uid="'+cid+'"]').addClass('k-state-selected')     
                
                ctg = cid;
                cpage = 0;
                loadTables();                        
            }            
        }
        
        function oBlur(e){
            var oo = filter.keywordParam+''
            var oo2 = $(e).val().trim()
            if(oo==oo2) return false
            
            //07/15/2020
            var oooo2 = function(){
                cpage=0
                loadTables()
            }
            var ooo = fromQR(oo2)
            if(ooo){
                var ooo2 = loadProduct(ooo) || $example[ooo]
                var oooo = function(){
                    filter.keywordParam = ooo
                    $(e).val(ooo)       
                }
                if(ooo2){
                    ooo = ooo2.code
                    
                    oooo()
                    
                    oooo2()
                }else{
                    //alert('1')
                    console.log('Get by ID')
                    $.ajax({
                        url: "/ajax.php?action=product&branch="+cb+"&id="+ooo,
                        success: function(data){ console.log(data);console.log('Get by ID done');//alert('2')
                            $example[data.id]=data
                            
                            oooo()
                            
                            oooo2()
                        }
                    })
                    
                    
                }
                
            }              
            else{
                filter.keywordParam = oo2
            
                oooo2()
            }
             
        }
        
        function oBlur2(e){
            var oo = filter.Expire-0
            var vv = $(e).val().trim()
            var oo2 = parseInt(vv)
            if(oo==oo2) return false
            if(vv==''){
                $('.mainLeft [ng-model="filter.Expire"]').val('')
                filter.Expire = 0;
                return false;
            }
            if(isNaN(oo2)){
                $('.mainLeft [ng-model="filter.Expire"]').val(oo)
                return false;
            }
            filter.Expire = oo2
            cpage=0
            loadTables()
        }
        
        function loadPC(){
            console.log('loadPC')
             
            if(product_categories==undefined || product_categories==null){
                setTimeout(function(){
                    loadTableLeft()
                },500)
                return
            }
              
            $('#treeviewcat >ul').html('');
            
            var lipc2 = lipc;
            tplpc2 = tplpc;
            
            lipc2 = lipc2.replace('{{class}}','k-first');
            lipc2 = lipc2.replace(/\{\{id\}\}/g,'0');
            
            tplpc2 = tplpc2.replace('{{name}}','Tất cả');
            tplpc2 = tplpc2.replace(/\{\{id\}\}/g,'0');
            tplpc2 = tplpc2.replace('{{style}}','');
            
            lipc2 = $(lipc2);
            lipc2.append(tplpc2);
            $('#treeviewcat >ul').append(lipc2);
            
            for(var i in product_categories){
                var lipc2 = lipc;
                tplpc2 = tplpc;
                
                lipc2 = lipc2.replace('{{class}}',i==product_categories.length-1?'k-last':'');
                lipc2 = lipc2.replace(/\{\{id\}\}/g,product_categories[i].id);
                
                tplpc2 = tplpc2.replace('{{name}}',product_categories[i].name);
                tplpc2 = tplpc2.replace(/\{\{id\}\}/g,product_categories[i].id);
                tplpc2 = tplpc2.replace('{{style}}','padding-left: '+(parseInt(product_categories[i].level)*16+5)+'px;');
                
                lipc2 = $(lipc2);
 
                lipc2.append(tplpc2);
                $('#treeviewcat >ul').append(lipc2);
            }
        }
        
        function filterByDateRange(){ //alert(_range)
            
            filter.range = _range.join('-')
            $('#reportsortOtherLbl').html(filter.range)
            cpage = 0
            loadTables()
            
            hide2()
        }
        
        var _range = []
         
        function loadTableLeft(){
            
            console.log('loadTableLeft');
            
            if(cfs.UseExpireTime)
                $('[ng-show="cfs.UseExpireTime"]').removeClass('ng-hide')
            
            $('.mainLeft [ng-model="filter.keywordParam"]').unbind('blur')
            $('.mainLeft [ng-model="filter.keywordParam"]').blur(function(e){
                oBlur(this)
            })
            $('.mainLeft [ng-model="filter.keywordParam"]').unbind('keyup')
            $('.mainLeft [ng-model="filter.keywordParam"]').keyup(function(e){
                if(e.which==13){
                    oBlur(this)    
                }
            })
            
            if(cfs.UseExpireTime){
                $('.mainLeft [ng-model="filter.Expire"]').unbind('blur')
                $('.mainLeft [ng-model="filter.Expire"]').blur(function(e){
                    oBlur2(this)
                })
                $('.mainLeft [ng-model="filter.Expire"]').unbind('keyup')
                $('.mainLeft [ng-model="filter.Expire"]').keyup(function(e){
                    if(e.which==13){
                        oBlur2(this)    
                    }
                })
            }
            tplpc = $('#templProductCategory2').html();
            //nhom hang
            loadPC()
            
            $('.mainLeft h3').unbind('click')
            $('.mainLeft h3').click(function(){
                i = $(this).find('i');
                
                //console.log($(this).next());
                
                
                if(i.hasClass('fa-chevron-circle-up')){
                    $(this).parent().find('aside').addClass('ng-hide');
                    i.removeClass('fa-chevron-circle-up');
                    i.addClass('fa-chevron-circle-down');
                }else{
                    $(this).parent().find('aside').removeClass('ng-hide');
                    i.addClass('fa-chevron-circle-up');
                    i.removeClass('fa-chevron-circle-down');
                }
            });
            
            pretty('.mainLeft',function(d){
                //console.log($(d))
                if($(d).attr('ng-model')=='filter.type'){
                    //console.log($(d).attr('value'),$(d).is('[checked]'))
                    filter.type = []
                    $('.mainLeft [ng-model="filter.type"]').each(function(i,v){
                        if($(this).is('[checked]'))
                            filter.type.push(parseInt($(this).attr('value')))    
                    })
                    //alert(filter.type )
                    cpage=0
                    loadTables(); 
                }else
                if($(d).attr('ng-model')=='ShowInActiveProduct'){
                    var oo = filter.ShowInActiveProduct+0
                    var oo2 = parseInt($('.mainLeft [ng-model="ShowInActiveProduct"][checked]').attr('value'))
                    if(oo==oo2) return false
                    filter.ShowInActiveProduct = oo2
                    cpage=0
                    loadTables(); 
                }else
                if($(d).attr('ng-model')=='onhandFilter'){
                    var oo = filter.onhandFilter+0
                    var oo2 = parseInt($('.mainLeft [ng-model="onhandFilter"][checked]').attr('value'))
                    if(oo==oo2) return false
                    filter.onhandFilter = oo2
                    cpage=0
                    loadTables(); 
                }else if($(d).attr('ng-model')=='kvModel.typeDate'){
                    //alert(1)
                    var rf;
                    $('.mainLeft [ng-model="kvModel.typeDate"]').each(function(i,v){
                        if($(this).is('[checked]')){
                            rf = ($(this).attr('value'))
                        }                             
                    }) 
                    if(rf=='range'){
                        $('#reportsortDateTimeLbl').click()
                        var crange = findRangeByLabel($('#reportsortDateTimeLbl').html())                         
                        filterbyRange(crange)
                    } else {
                        $('#reportsortOtherLbl').click()
                    }
                    
                    cpage=0
                    loadTables()
                }
            });
            
            $('#reportsortDateTimeLbl').unbind('click')
            $('#reportsortDateTimeLbl').click(function(e){
                if(e.pageX!=undefined) return;
                /*$(this).next().css({
                    visibility: 'visible',
                    opacity: 1 
                })*/
                if($('aside.sortTimeList').css('visibility')=="hidden")
                    show1()
                else
                    hide1()
                    
                if($('aside.sortDateTimeOtherBox').css('visibility')!="hidden")                 
                    hide2()    
            })
            
            $('aside.sortTimeList li>a[ng-click]').unbind('click')
            $('aside.sortTimeList li>a[ng-click]').click(function(e){
                var x = $(this).attr('ng-click');
                //alert(x)
                eval(x);
                hide1();
            })
            $('[ng-click="filterByDateRange()"]').unbind('click')
            $('[ng-click="filterByDateRange()"]').click(function(e){
                filterByDateRange()
            })
            $('#reportsortOtherLbl').unbind('click')
            $('#reportsortOtherLbl').click(function(e){
                console.log('hth1')
                if(e.pageX!=undefined) return;
                console.log('hth2')
                if(filter.range==''){
                    filter.range = moment().format('DD/MM/YYYY')
                    filter.range +='-'+filter.range
                    
                    _range = filter.range.split('-')
                }
                
                var xr = filter.range.split('-');
                $('span[ng-if="!kvBirthday"]:nth(0)').html(xr[0])
                $('span[ng-if="!kvBirthday"]:nth(1)').html(xr[1])
                $( "#fromDate" ).datepicker(
                    'option', 'defaultDate', xr[0]
                );
                $( "#toDate" ).datepicker(
                    'option', 'defaultDate', xr[1]
                );
                
                $( "#toDate" ).datepicker(
                    'option', 'minDate', $( "#fromDate" ).datepicker('getDate')
                );
                
                console.log('hth3',$('aside.sortDateTimeOtherBox').css('visibility'))
                
                if($('aside.sortDateTimeOtherBox').css('visibility')=="hidden")
                    show2()
                else
                    hide2()
                    
                if($('aside.sortTimeList').css('visibility')!="hidden")                    
                    hide1()    
            })
            if(!$( "#fromDate" ).is('.hasDatepicker'))
            $( "#fromDate" ).datepicker({
                maxDate: new Date(),
                onSelect: function(val,$target){                       
                    $( "#toDate" ).datepicker(
                        'option', 'minDate', $(this).datepicker('getDate')
                    );
                    
                    $('span[ng-if="!kvBirthday"]:nth(0)').html(val)
                    
                    _range = filter.range.split('-')
                    _range[0] = val 
                     
                }
            });
            if(!$( "#toDate" ).is('.hasDatepicker'))
            $( "#toDate" ).datepicker({
                maxDate: new Date(),
                onSelect: function(val,$target){                                            
                    $('span[ng-if="!kvBirthday"]:nth(1)').html(val)
                     
                    _range[1] = val 
                }
            });
            
            if($('[ng-model="filter.user"]').is(':visible')){
                $('[ng-model="filter.user"]').select3({
                    sources: users,
                    empty: '-Chọn nhân viên-',
                    width: '186px!important',
                    emptyValue: '0',
                    key: 'id',
                    val: 'name',
                    selected: '',
                    count: 5,
                })
                $('[ng-model="filter.user"]').change(function(){
                    filter.user = $(this).val()    
                    loadTables()
                })
            }
            
            loadTables(); 
        }
        
        function show1(){
            $('aside.sortTimeList').css({
                visibility: 'visible',
                opacity: 1 
            })
        }
        
        function show2(){
            $('aside.sortDateTimeOtherBox').css({
                visibility: 'visible',
                opacity: 1 
            })
        }
        
        function hide1(){
            $('aside.sortTimeList').css({
                visibility: 'hidden',
                opacity: 0 
            })
        }
        
        function hide2(){
            $('aside.sortDateTimeOtherBox').css({
                visibility: 'hidden',
                opacity: 0 
            })
        }
        
        function filterbyRange(range){
            //alert(range)
            
            var yu = function(x){
                filter.range = x;
                cpage=0;
                loadTables();
            }
            
            if(range=='alltime' || range==''){
                yu('')
            }else{
             
                $.ajax({
                    url: '/ajax.php?action=rangeNameToRange&range='+range,
                    success: yu
                })
            
            }
            
            $('#reportsortDateTimeLbl').html(rngs[range])
        }
        
        var doo;
        function EditCategory(pid){
            if(pid==0){
                doo = 'add';
                
                $('[kendo-window="categoryWindow"] [onclick="deleteCategory()"]').addClass('ng-hide');
                
                $('[kendo-window="categoryWindow"] [ng-model]').val('');
            
                loadCategoriesPopup();
                
                $('[kendo-window="categoryWindow"] .k-dropdown select option').removeAttr('selected');
                $('[kendo-window="categoryWindow"] .k-dropdown .k-dropdown-wrap .k-input').html($('[kendo-window="categoryWindow"] .k-dropdown select option:nth(0)').html());
                
                $('[kendo-window="categoryWindow"]').dialog({
                    modal: true,
                    width: 550,
                    title: 'Thêm nhóm hàng',
                    close: function( event, ui ) {
                        //$('.ui-dialog.ui-widget.ui-widget-content').remove();
                        //$('.ui-dialog.ui-widget.ui-widget-content').last().remove();
                    },
                    beforeClose: function( event, ui ) {
                        //return false
                         
                    },
                    open: function( event, ui ){
                        $('[kendo-window="categoryWindow"]').siblings().find('.ui-dialog-titlebar-close').unbind('click')
                        $('[kendo-window="categoryWindow"]').siblings().find('.ui-dialog-titlebar-close').click(function(){
                            //$('[kendo-window="categoryWindow"]').dialog('close')
                            cancelCategory()
                            return false
                        })
                    }
                });
            }else{
                doo = 'edit';
                
                $('[kendo-window="categoryWindow"] [onclick="deleteCategory()"]').removeClass('ng-hide');
                
                loadCategoriesPopup();
                
                branch = loadProductCategory(pid);
                
                $('[kendo-window="categoryWindow"] [ng-model]').each(function(k,v){
                     $(this).val(branch[getname($(this).attr('ng-model'))]);
                });
                
                if(branch.parent_id){
                    $('[kendo-window="categoryWindow"] .k-dropdown select option[value="'+branch.parent_id+'"]').attr('selected','selected');
                    $('[kendo-window="categoryWindow"] .k-dropdown .k-dropdown-wrap .k-input').html($('[kendo-window="categoryWindow"] .k-dropdown select option[value="'+branch.parent_id+'"]').html());
                }
                
                $('[kendo-window="categoryWindow"]').dialog({
                    modal: true,
                    width: 550,
                    title: 'Sửa nhóm hàng',
                    close: function( event, ui ) {
                        $('.ui-dialog.ui-widget.ui-widget-content').remove();
                    }
                });
            }
        }
        
        function loadCategoriesPopup(){
            console.log('loadCategoriesPopup');
            
            sl = $('[kendo-window="categoryWindow"] .k-dropdown select');
            
            //console.log(sl);
            sl.html('');
            
            op2 = op;
            op2 = op2.replace(/\{\{id\}\}/,'0');
            op2 = op2.replace(/\{\{name\}\}/,'---Lựa chọn---');
            sl.append(op2);
            
            for(var i in product_categories){
                op2 = op;
                op2 = op2.replace(/\{\{id\}\}/,product_categories[i].id);
                op2 = op2.replace(/\{\{name\}\}/,('--'.repeat(parseInt(product_categories[i].level)))+product_categories[i].name);
                sl.append(op2);
            }
            
            sl = $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container ul');
             
            sl.html('');
            
            opp2 = opp;
            opp2 = opp2.replace(/\{\{i\}\}/,0);
            opp2 = opp2.replace(/\{\{name\}\}/,'---Lựa chọn---');
            sl.append(opp2);
            
            for(var j in product_categories){
                opp2 = opp;
                opp2 = opp2.replace(/\{\{i\}\}/,parseInt(j)+1);
                opp2 = opp2.replace(/\{\{name\}\}/,('--'.repeat(parseInt(product_categories[j].level)))+product_categories[j].name);
                sl.append(opp2);
            }
            $('[kendo-window="categoryWindow"] .k-dropdown .k-dropdown-wrap').unbind('click')
            $('[kendo-window="categoryWindow"] .k-dropdown .k-dropdown-wrap').click(function(){
                $(this).next().show();
            });
            
            //set hover
            $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container').hover(
                function(){
                    //$('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container').show();
                },
                function(){
                    $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container').hide();
                }
            );
            
            $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container ul li').hover(
                function(){
                    $(this).toggleClass('k-state-hover');
                },function(){
                    $(this).toggleClass('k-state-hover');
                }
            );
            
            $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container ul li').unbind('click')
            //set click
            $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container ul li').click(
                function(){
                    
                    //console.log($(this).data('offset-index'));
                    
                    offset = parseInt($(this).data('offset-index'))+1;
                    
                    $('[kendo-window="categoryWindow"] .k-dropdown select option').removeAttr('selected');                    
                    $('[kendo-window="categoryWindow"] .k-dropdown select option:nth-child('+offset+')').attr('selected','selected');
                    
                    $('[kendo-window="categoryWindow"] .k-dropdown .k-dropdown-wrap .k-input').html($(this).html());
                     
                    $('[kendo-window="categoryWindow"] .k-dropdown .k-animation-container').hide();
                     
                     
                }
            );
        }
        
        function _loadGroupPopup(x){
            console.log('_loadGroupPopup',x);
            
            sl = $('kv-product-form .k-dropdown select');
            
            //console.log(sl);
             
            sl.html('');
            
            op2 = op;
            op2 = op2.replace(/\{\{id\}\}/,'0');
            op2 = op2.replace(/\{\{name\}\}/,'---Lựa chọn---');
            sl.append(op2);
            
            console.log('_loadGroupPopup 1');
            
            for(var i in product_categories){
                op2 = op;
                op2 = op2.replace(/\{\{id\}\}/,product_categories[i].id);
                
                
                
                op2 = op2.replace(/\{\{name\}\}/,('--'.repeat(parseInt(product_categories[i].level)))+product_categories[i].name);
                sl.append(op2);
            }
            $('kv-product-form .k-dropdown .k-dropdown-wrap').unbind('click')
            $('kv-product-form .k-dropdown .k-dropdown-wrap').click(function(){
                $(this).next().show();
            });
            
            console.log('_loadGroupPopup 2');
            
            sl = $('kv-product-form .k-dropdown .k-animation-container ul');
             
            sl.html('');
            
            opp2 = opp;
            opp2 = opp2.replace(/\{\{i\}\}/,0);
            opp2 = opp2.replace(/\{\{name\}\}/,'---Lựa chọn---');
            sl.append(opp2);
            
            console.log('_loadGroupPopup 3');
            
            for(var j in product_categories){
                opp2 = opp;
                opp2 = opp2.replace(/\{\{i\}\}/,parseInt(j)+1);
                opp2 = opp2.replace(/\{\{name\}\}/,('--'.repeat(parseInt(product_categories[j].level)))+product_categories[j].name);
                sl.append(opp2);
            }
            
            //set hover
            $('kv-product-form .k-dropdown .k-animation-container').hover(
                function(){
                    //$('kv-table-form .k-dropdown .k-animation-container').show();
                },
                function(){
                    $('kv-product-form .k-dropdown .k-animation-container').hide();
                }
            );
            
            console.log('_loadGroupPopup 4');
            
            $('kv-product-form .k-dropdown .k-animation-container ul li').hover(
                function(){
                    $(this).toggleClass('k-state-hover');
                },function(){
                    $(this).toggleClass('k-state-hover');
                }
            );
            $('kv-product-form .k-dropdown .k-animation-container ul li').unbind('click')
            //set click
            $('kv-product-form .k-dropdown .k-animation-container ul li').click(
                function(){
                    
                    //console.log($(this).data('offset-index'));
                    
                    offset = parseInt($(this).data('offset-index'))+1;
                    
                    $('kv-product-form .k-dropdown select option').removeAttr('selected');                    
                    $('kv-product-form .k-dropdown select option:nth-child('+offset+')').attr('selected','selected');
                    
                    $('kv-product-form .k-dropdown .k-dropdown-wrap .k-input').html($(this).html());
                     
                    $('kv-product-form .k-dropdown .k-animation-container').hide();
                     
                     
                }
            );
            
            if(x!=undefined){
                //change k-input va select
                $('kv-product-form .k-dropdown select option[selected]').removeAttr('selected');
                 
                $('kv-product-form .k-dropdown select option[value="'+x+'"]').attr('selected','selected');
                 
                $('kv-product-form .k-dropdown .k-dropdown-wrap .k-input').html(
                    $('kv-product-form .k-dropdown select option[value="'+x+'"]').html()
                );                
            }
            
            console.log('_loadGroupPopup 5');
        }
        
        function loadGroupPopup(){
            
            console.log('loadGroupPopup');
             
            _loadGroupPopup()
            
            //pretty('kv-product-form');
            
            console.log('loadGroupPopup 1');
            
            //autocomplete
            $('.autocomplete>input').each(function(){
                //$('.autocomplete>input[id=productSearchInput]')
                //var that = $(this)
                //if($(this).is('[id=productSearchInput]'))
                $(this).unbind('keyup')
                $(this).keyup(function(ev){
                    if(ev.which==13){
                        $(this).parent().find('>div ul li:first-child').click()
                        return
                    }
                    $(this).parent().find('>div').removeClass('ng-hide');
                    $(this).parent().find('>div ul').html('');
                    for(var i in products){
                        //if(products[i].main=='0') continue; //2017
                        //console.log($(this).val());
                        //console.log(products[i].name);
                        //console.log(products[i].code);
                        
                        if(                             
                            (products[i].name.match(new RegExp( $(this).val() ,'gi'))||
                            products[i].code.match(new RegExp( $(this).val() ,'gi'))) &&
                            ($(this).is('[id=productSearchInput]') || products[i].extra==1)
                        ){
                                //console.log('a')
                            lisuggest2 = lisuggest;   
                            lisuggest2 = lisuggest2.replace(/\{\{name\}\}/gi,products[i].name);
                            lisuggest2 = lisuggest2.replace(/\{\{code\}\}/gi,products[i].code); 
                            lisuggest2 = lisuggest2.replace(/\{\{index\}\}/gi,products[i].id); 
                            $(this).parent().find('>div ul').append($(lisuggest2));        
                        }
                    }
                    //set hover
                    $(this).parent().find('>div ul li').unbind('hover')
                    $(this).parent().find('>div ul li').hover(
                        function(){
                            $(this).addClass('k-state-hover');
                        },function(){
                            $(this).removeClass('k-state-hover');
                        }
                    );
                }) 
                
                //set hover
                $(this).parent().find('>div').unbind('hover')
                $(this).parent().find('>div').hover(
                    function(){
                        
                    },
                    function(){
                        $(this).addClass('ng-hide');
                    }
                );
                 
            })
            
            console.log('loadGroupPopup 2');
                                    
        }
        
        function loadConvert(ll,b){
            
            console.log('loadConvert',b);
             
            sl = ll.find('.k-dropdown select');
             
            sl.html('');
             
            var c= findchild(b.main==1?b.id:b.parent),op2,opp2,pid=b.id
            
            for(var i in c){
                if(c[i].id==pid) continue;
                op2 = op;
                op2 = op2.replace(/\{\{id\}\}/,c[i].id);
                 
                op2 = op2.replace(/\{\{name\}\}/,c[i].name+' ('+c[i].uname+")");
                sl.append(op2);
            }
            ll.find('.k-dropdown .k-dropdown-wrap').unbind('click')
            ll.find('.k-dropdown .k-dropdown-wrap').click(function(){
                $(this).next().show();
            });
            
            sl = ll.find('.k-dropdown .k-animation-container ul');
             
            sl.html('');
             
            for(var j in c){
                if(c[j].id==pid) continue;
                opp2 = opp;
                opp2 = opp2.replace(/\{\{i\}\}/,j);
                opp2 = opp2.replace(/\{\{name\}\}/,c[j].name+' ('+c[j].uname+")");
                //opp2 = $(opp2)
                
                sl.append(opp2);
                 
            }
             
            //set hover
            ll.find('.k-dropdown .k-animation-container').hover(
                function(){
                    //$('kv-table-form .k-dropdown .k-animation-container').show();
                },
                function(){
                    ll.find('.k-dropdown .k-animation-container').hide();
                }
            );
            
            ll.find('.k-dropdown .k-animation-container ul li').hover(
                function(){
                    $(this).toggleClass('k-state-hover');
                },function(){
                    $(this).toggleClass('k-state-hover');
                }
            );
            ll.find('.k-dropdown .k-animation-container ul li').unbind('click')
            //set click
            ll.find('.k-dropdown .k-animation-container ul li').click(
                function(){
                    
                    //console.log($(this).data('offset-index'));
                    
                    offset = parseInt($(this).data('offset-index')) ;
                    
                    ll.find('.k-dropdown select option').removeAttr('selected');                    
                    //ll.find('.k-dropdown select option:nth-child('+offset+')').attr('selected','selected');
                    ll.find('.k-dropdown select option[value="'+c[offset].id+'"]').attr('selected','selected');
                    ll.find('.k-dropdown select').val(c[offset].id);
                    
                    ll.find('.k-dropdown .k-dropdown-wrap .k-input').html($(this).html());
                     
                    ll.find('.k-dropdown .k-animation-container').hide();
                    console.log('fuck',$('.k-detail-row:visible [id$="-7"] [ng-model="convert.quantity"]')) 
                    convert1(
                        $('.k-detail-row:visible [id$="-7"] [ng-model="convert.quantity"]')
                    ) 
                }
            );
            
            ll.find('.k-dropdown .k-dropdown-wrap .k-input').html(ll.find('.k-dropdown .k-animation-container ul li:first-child').html());
            
            
        }
        
        function catRecur(cid){
            cid = parseInt(cid)
            var x = loadProductCategory(cid)
            if(x.haschild){
                var start = false
                var ret = []
                for(var i in product_categories){
                    if(!start){
                        if(product_categories[i].id==cid)  {
                            ret.push(cid)
                            start = true
                        }                          
                    }else{
                        if(product_categories[i].level>x.level)
                            ret.push(parseInt(product_categories[i].id))
                        else
                            break;
                    }
                }
                return ret
            }else{
                return [cid]
            }
        }
        
        //02/28/2020
        var selectedP = localStorage.selectedP;
        if(selectedP) selectedP = selectedP.split(',')
        else selectedP = []
        function saveP(){
            if(selectedP && selectedP.length){
                localStorage.selectedP = selectedP.join(',')    
                $('.selectedP').removeClass('hide').addClass('dpib')
            }else{
                $('.selectedP').removeClass('dpib').addClass('hide')
                if(localStorage.selectedP){
                    localStorage.selectedP=[]//delete localStorage.selectedP
                    selectedP = []
                }
            }            
        }
        var selectedPc /*= localStorage.selectedPc
        function savePc(){
            if(selectedPc)
                localStorage.selectedPc = selectedPc          
            else 
                delete localStorage.selectedPc 
        }*/
        var selectedPcD 
        
        //11/18/2020
        var templBranchDetail2 
        
        function loadTables(){
            
            console.log('loadTables',products,vkl);
            
            if(!products || !vkl){ //products===null
                setTimeout(function(){loadTables()},500)
                return false;
            }
             
            if(!_productsComplete())
            toastr.info('Dữ liệu hiện đã tải được '+products.filter(function(a){return a!==null}).length+'/'+
            (localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
            localStorage['revision_products_'+cfs.id+'_'+cb+'']+'_total'])+' sản phẩm');
            
            if(vkl['2.1.1']==undefined){
                $('#grdProducts').addClass('ng-hide')
            }
            if(vkl['2.1.2']==undefined)             
                $('[ng-show="_p.has(\'Product_Create\')"],[onclick="EditCategory(0)"],.mainLeft .edittreeview').addClass('ng-hide')
            
            //03/14/2020
            if(vkl['3.4.2']==undefined)
                $('[ng-show="3.4.2"]').remove()
            
            templBranch = $('#templBranch').html();
            templBranchFirst = $('#templBranchFirst').html();
            
            $('#grdProducts>.k-grid-content>table>tbody').html(templBranchFirst);
            
            
            var counttables = 0, countTableForGroup=0, totalquantity=0;
            
            //var gh
            if(cfs.UseExpireTime && filter.Expire>0){
                gh = new Date()
                gh.setTime(gh.getTime()+filter.Expire*86400000)
                gh = gh.getFullYear()+"-"+spr(gh.getMonth()+1)+"-"+spr(gh.getDate())
            }
            
            $example = {}
            
            //07/07/2020
            var tl = function(p,i){
                if(p[i].category) 
                    p[i].group_object = loadProductCategory(p[i].category);
                else
                    p[i].group_object = {name:''};
                 
                templBranch2 = templBranch;
                if(i%2==0) p[i].class = 'k-alt';
                else p[i].class = '';
                
                name2 = p[i].name;
                if(p[i].uname!=null) name2 += ' ('+p[i].uname+')';
                
                for(var j in p[i]){
                     
                     
                    if(j=='group') continue;
                    if(j=='group_object'){
                        if(p[i][j].name!=undefined) templBranch2 = templBranch2.replace(new RegExp("{{dataItem.group}}","gi"),p[i][j].name);
                        else templBranch2 = templBranch2.replace(new RegExp("{{dataItem.group}}","gi"),'');
                    }
                        
                    else 
                    if(j=='quantity'){
                        templBranch2 = templBranch2.replace(new RegExp("{{dataItem."+j+"}}","gi"),p[i][j]!=null?p[i][j]:'0');
                        totalquantity += (p[i].main==1 && p[i][j]!=null)?(p[i][j]-0):0;
                    }  
                        
                    else if(j=='price'||j=='price2'){  
                        templBranch2 = templBranch2.replace(new RegExp("{{dataItem."+j+"}}","gi"),p[i][j]!=null?p[i][j]:'---');
                    }
                    else if(j=='name')  
                        templBranch2 = templBranch2.replace(new RegExp("{{dataItem."+j+"}}","gi"),name2);
                    else    
                        templBranch2 = templBranch2.replace(new RegExp("{{dataItem."+j+"}}","gi"),p[i][j]);
                }
                 
                
                $('#grdProducts>.k-grid-content>table>tbody').append(templBranch2);
            }
            var zzz = function(){
                console.log('abc3')
                //$('[ng-bind="dataItem.OnHand"]:nth(0)')
                $('tr:first-child td.tdTotal:nth(2)')
                .html(totalquantity);
                console.log(totalquantity)
                console.log('abc4')
                
                templBranchDetail = $('#templBranchDetail').html();
                templUsersInBranch = $('#templUsersInBranch').html();
                templTheKho = $('#templTheKho').html()
                
                console.log('abc5')
                var bb = function(){
                    fixedfixed()
                    console.log('abc');
                    
                    templBranchDetail2 = templBranchDetail;
                    ////n2= $(this).parents().parent();
                    n2= $(this).parents('[data-uid]');
                    n = n2.next();
                    //console.log(n);
                     
                    ////if($(this).hasClass('k-plus')){
                    if(!n.is('.k-detail-row')||!n.is(':visible')){    
                        //an het detail
                        n2.siblings('.k-detail-row').hide();
                        //thay doi icon
                        ////n2.parent().find('>tr>.k-hierarchy-cell>.k-icon').removeClass('k-minus');
                        ////n2.parent().find('>tr>.k-hierarchy-cell>.k-icon').addClass('k-plus');
                        
                        if(n.hasClass('k-detail-row')){
                            n.show();
                        }else{
                             
                            //prepare content
                            //find uid
                            uid = n2.attr('data-uid'); //console.log('qqkk')
                            b = loadProduct(uid) || $example[uid]; //edit 07/07/2020 
                            //console.log('qqkk2',b)
                             
                            console.log(b) 
                            
                            name2 = b.name;
                            if(b.uname!=null) name2 += ' ('+b.uname+')';
                            
                            if(b.category>0)
                                b.group_object = loadProductCategory(b.category);
                            for(var j in b){
                                console.log('j:',j) 
                                if(j=='category') continue;
                                else if(j=='sell'){
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem."+j+"}}","gi"),b[j]=='1'?'Được bán trực tiếp':'Không được bán');
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem.sellclass}}","gi"),b[j]=='1'?'txtGreen':'txtRed');    
                                } 
                                else if(j=='time'){                                
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem.timeclass}}","gi"),b[j]=='1'?'':'ng-hide');    
                                } 
                                else if(j=='extra'){                                
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem.extraclass}}","gi"),b[j]=='1'?'':'ng-hide');    
                                } 
                                else if(j=='group_object'){  
                                    if(b[j].name!=undefined)
                                        templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem.group}}","gi"),b[j].name); 
                                    else
                                       templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem.group}}","gi"),'');
                                } 
                                else if(j=='price'||j=='price2'){  
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem."+j+"}}","gi"),b[j]!=null?formatCurrency(b[j]):'---');
                                }
                                else if(j=='name')  
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem."+j+"}}","gi"),name2);
                                else if(j=='type')  
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem."+j+"}}","gi"),product_types[b[j]]);    
                                else 
                                    templBranchDetail2 = templBranchDetail2.replace(new RegExp("{{dataItem."+j+"}}","gi"),b[j]);
                                    
                                    
                            } console.log('qqkk3')
                            templBranchDetail2 = templBranchDetail2.replace('{{dataItem.group}}','');	
                            
                            templBranchDetail2 = $(templBranchDetail2);
                            
                            if(b.type!=3 && b.parent==0 && (b.minqty!=0 || b.maxqty!=0))
                                templBranchDetail2.find('[ng-show="dataItem.type!=3 && dataItem.parent==0"]').removeClass('ng-hide')
                            else
                                templBranchDetail2.find('[ng-show="dataItem.type!=3 && dataItem.parent==0"]').addClass('ng-hide')
                            console.log('qqkk4')
                            //phan chuyen doi
                            if(b.main==1 && findchild(uid).length<2){
                                templBranchDetail2.find('[id="tabConvert"]').addClass('ng-hide')                            
                            }else loadConvert(templBranchDetail2,b)
                                
                            //else
                            //    templBranchDetail2.find('[id="tabConvert"]').removeClass('ng-hide')
                            if(!cfs.UseExpireTime || b.expire=='0000-00-00')
                                templBranchDetail2.find('[ng-show="cfs.UseExpireTime && dataItem.expire"]').addClass('ng-hide')
                            
                            //bo ngo 
                            //11/18/2020
                            $.ajax({
                                url: '/ajax.php?action=theKho&id='+uid,
                                dataType: 'JSON',
                                success: function(data){
                                    
                                    var hh = b.quantity - 0, curpa = 0, curpas = Math.ceil(data.length/10)
                                    var LoadPage = function(){
                                        hh = b.quantity - 0
                                        templBranchDetail2.find('[id="tblInvenroty"] .k-grid-content-ac tbody').html('')
                                        if(data.length) 
                                        for(var i in data){
                                            
                                            if(i<curpa*10 || i>=(curpa+1)*10){
                                                hh = hh - (i>0? data[i-1].quantity: 0)
                                                continue;
                                            }
                                            
                                            var templTheKho2 = $(templTheKho)
                                            if(i%2==0) templTheKho2.removeClass('k-alt')
                                            templTheKho2.find('.tdCode a').html(data[i].code)
                                            templTheKho2.find('.tdCode a').attr('data-code',data[i].code)
                                            templTheKho2.find('.tdDateTime').html(data[i].date)
                                            templTheKho2.find('[class="txtR tdTotal"]').html(formatQuantity(b.price2))
                                            templTheKho2.find('.tdSLB').html(data[i].quantity)
                                            templTheKho2.find('.tdMin').html(invoiceTypes[data[i].type]?invoiceTypes[data[i].type]:'')  
                                            templTheKho2.find('[class="tdTotal txtR"]').html((hh = hh - (i>0? data[i-1].quantity: 0),checknum(hh,3,0)))
                                            
                                            templBranchDetail2.find('[id="tblInvenroty"] .k-grid-content-ac tbody').
                                                append(templTheKho2)
                                        }
                                        templBranchDetail2.find('.paging-box .k-label').html('Hiển thị '+(curpa*10+1)+
                                            ' - '+Math.min(10*(curpa+1),data.length)+' trên tổng số '+data.length+' giao dịch')
                                        //console.log('curpas',curpas,uid)
                                        
                                        templBranchDetail2.find('.paging-box .k-pager-next').attr('data-page',curpa+2)
                                        templBranchDetail2.find('.paging-box .k-pager-last').attr('data-page',curpas)
                                        templBranchDetail2.find('.paging-box .k-pager-first').attr('data-page',1)
                                        templBranchDetail2.find('.paging-box .k-pager-prev').attr('data-page',curpa?curpa:1)
                                        
                                        if(curpas<=1){
                                            //templBranchDetail2.find('.paging-box .k-pager-next').addClass('k-state-disabled')
                                            //templBranchDetail2.find('.paging-box .k-pager-last').addClass('k-state-disabled')
                                            templBranchDetail2.find('.paging-box .k-pager-nav').addClass('k-state-disabled')
                                            
                                            
                                        }else{
                                            if(curpa<curpas-1){
                                                templBranchDetail2.find('.paging-box .k-pager-last,.paging-box .k-pager-next').
                                                    removeClass('k-state-disabled')
                                            }else{
                                                templBranchDetail2.find('.paging-box .k-pager-last,.paging-box .k-pager-next').
                                                    addClass('k-state-disabled')
                                            }
                                            
                                            if(curpa>0){
                                                templBranchDetail2.find('.paging-box .k-pager-prev,.paging-box .k-pager-first').
                                                    removeClass('k-state-disabled')
                                            }else{
                                                templBranchDetail2.find('.paging-box .k-pager-prev,.paging-box .k-pager-first').
                                                    addClass('k-state-disabled')
                                            }
                                        }
                                    
                                    }
                                    
                                    $('tr[data-uid="'+uid+'"]+tr.k-detail-row .paging-box .k-pager-nav').unbind('click')
                                    $('tr[data-uid="'+uid+'"]+tr.k-detail-row .paging-box .k-pager-nav').click(function(){
                                        if($(this).is('.k-state-disabled')) return
                                        curpa = $(this).attr('data-page')-1
                                        
                                        $(this).siblings('ul').find('>li >span').html(curpa+1)
                                        
                                        LoadPage()
                                    })
                                    
                                    LoadPage()
                                }
                            })
                                                                                      
                            //ins
                            
                            //ng-show="dataItem.status"
                            //ng-show="!dataItem.status"
                            console.log('qqkk5')
                             
                            if(b.status=='1'){
                                templBranchDetail2.find('[ng-show="!dataItem.status"]').addClass('ng-hide');
                            }else{
                                templBranchDetail2.find('[ng-show="dataItem.status"]').addClass('ng-hide');
                            }
                            
                            if(vkl['2.1.3']==undefined)
                                templBranchDetail2.find('[ng-show="_p.has(\'Product_Update\')"],[ng-show="dataItem.status"],[ng-show="!dataItem.status"]').addClass('ng-hide')
                            if(vkl['2.1.4']==undefined)
                                templBranchDetail2.find('[ng-show="_p.has(\'Product_Delete\')"]').addClass('ng-hide')     
                            //$(templBranchDetail2).insertAfter(n2);
                            //templBranchDetail2.insertAfter(n2);
                            console.log('qqkk6')
                            n2.after(templBranchDetail2);
                            console.log('qqkk7')
                            tabstrip();
                        }
                         
                        ////$(this).removeClass('k-plus');
                        ////$(this).addClass('k-minus');
                    }else{
                        
                        n.hide();
                        
                        ////$(this).addClass('k-plus');
                        ////$(this).removeClass('k-minus');
                    }
                }
                console.log('abc6')
                //02/28/2020
                $('#grdProducts .k-hierarchy-cell>.prettycheckbox').unbind('click')
                $('#grdProducts .k-hierarchy-cell>.prettycheckbox').click(function(){
                    var b = $(this).find('input')
                    var a = $(this).find('a')
                    var c = b.attr('ng-model')
                    
                    
                    var d = b.attr('value')
                    if(a.is('.checked')){
                        a.removeClass('checked')
                        b.removeAttr('checked')
                        if(c == 'choose'){
                            for(var i in selectedP){
                                if(selectedP[i]==d){
                                    selectedP.splice(i,1)
                                    saveP()
                                    break;
                                }
                            }
                        }else if(c == 'chooseAll'){                    
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox a').removeClass('checked')
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox input').removeAttr('checked')
                            
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox input').map(function(){
                                //return $(this).attr('value')
                                var e = $(this).attr('value')
                                if(selectedP.indexOf(e)>=0){
                                     for(var i in selectedP){
                                        if(selectedP[i]==e){
                                            selectedP.splice(i,1)
                                            saveP()
                                            break;
                                        }
                                    }
                                }
                                //saveP()
                            })
                            saveP()
                        }
                    }else{
                        a.addClass('checked')
                        b.attr('checked','checked')
                        if(c == 'choose'){
                            selectedP.push(d)
                            saveP()
                        }else if(c == 'chooseAll'){                    
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox a').addClass('checked')
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox input').attr('checked','checked')
                            
                            $('#grdProducts .k-grid-content .k-hierarchy-cell>.prettycheckbox input').map(function(){
                                //return $(this).attr('value')
                                var e = $(this).attr('value')
                                if(selectedP.indexOf(e)===-1){
                                     selectedP.push(e)
                                }
                                //saveP()
                            })
                            saveP()
                        }
                    }
                })
                console.log('abc7')
                if(selectedP && selectedP.length){
                    for(var i in selectedP){
                        $('#grdProducts [data-uid="'+selectedP[i]+'"] .k-hierarchy-cell>.prettycheckbox a').addClass('checked')
                        $('#grdProducts [data-uid="'+selectedP[i]+'"] .k-hierarchy-cell>.prettycheckbox input').attr('checked','checked')
                    }
                    $('.selectedP').removeClass('hide').addClass('dpib')
                }else{
                    $('.selectedP').removeClass('dpib').addClass('hide')
                }            
                console.log('abc8')
                $('#grdProducts>.k-grid-content>table>tbody>tr:not(.cssSummaryRow)>td:not(:first-child)').unbind('click')
                $('#grdProducts>.k-grid-content>table>tbody>tr:not(.cssSummaryRow)>td:not(:first-child)').click(/**function(){
                    $(this).parent().find('>.k-hierarchy-cell>.k-icon').trigger('click');
                }**/bb);
                /**$('#grdProducts>.k-grid-content>table>tbody>tr:not(.cssSummaryRow)>.k-hierarchy-cell>.k-icon').unbind('click')
                $('#grdProducts>.k-grid-content>table>tbody>tr:not(.cssSummaryRow)>.k-hierarchy-cell>.k-icon').click(bb);
                **/
                tpage = Math.ceil(countTableForGroup/record);
                
                $('#grdProducts > .paging-box .k-label').html("Hiển thị "+((cpage)*record+1)+" - "+
                    Math.min(countTableForGroup,(cpage+1)*record)+" trên tổng số "+
                    /*countTableForGroup*/(TotalProducts[getHashProducts()]?TotalProducts[getHashProducts()]:countTableForGroup)+" sản phẩm");
                
                $('#grdProducts > .paging-box a').removeClass('k-state-disabled');
                
                if(cpage==0){
                    $('#grdProducts > .paging-box a:nth(0)').addClass('k-state-disabled');
                    $('#grdProducts > .paging-box a:nth(1)').addClass('k-state-disabled');
                } 
                
                if(cpage==tpage-1){
                    $('#grdProducts > .paging-box a:nth(2)').addClass('k-state-disabled');
                    $('#grdProducts > .paging-box a:nth(3)').addClass('k-state-disabled');
                } 
                
                $('#grdProducts > .paging-box .k-state-selected, #grdProducts > .paging-box .k-current-page span').html(cpage+1);
                
                $('#grdProducts > .paging-box a:nth(0)').unbind('click')
                //first page click
                $('#grdProducts > .paging-box a:nth(0)').click(function(){
                    cpage = 0;
                    loadTables();
                });        
                
                $('#grdProducts > .paging-box a:nth(1)').unbind('click')
                $('#grdProducts > .paging-box a:nth(1)').click(function(){
                    if(cpage>0){
                        cpage -= 1;
                        loadTables();
                    }
                });        
                
                $('#grdProducts > .paging-box a:nth(2)').unbind('click')
                $('#grdProducts > .paging-box a:nth(2)').click(function(){
                    if(cpage<tpage-1){
                        cpage += 1;
                        loadTables();
                    }
                });       
                 
                $('#grdProducts > .paging-box a:nth(3)').unbind('click')
                if(_productsComplete())
                $('#grdProducts > .paging-box a:nth(3)').click(function(){
                    cpage = tpage-1;
                    loadTables();
                }).show();
                else $('#grdProducts > .paging-box a:nth(3)').hide()
                
                console.log('abc9')
                calcSum($('#grdProducts tbody:nth(0)'));
            } 
            
            //07/07/2020
            if(_checkP() && (getHashProducts()!="59ba016c696865893dc7f24ece8b1381")){ //cpage>0 ||
                $('.paging-box span.k-pager-info.k-label:nth(0)').html('Đang tải sản phẩm...')
                $.ajax({
                    url: "/ajax.php?action=products&branch="+cb+
                        "&pageSize=10&sell=2&currentItem="+(cpage*10)+
                        (ctg>0?('&categoryId='+catRecur(ctg)):'')+
                        (filter.keywordParam!=''?('&query='+filter.keywordParam):'')+
                        (filter.Expire>0?('&expire='+filter.Expire):'')+
                        (filter.ShowInActiveProduct>1?('&activeProduct='+filter.ShowInActiveProduct):'')+
                        (filter.onhandFilter>0?('&stock='+filter.onhandFilter):'')+
                        (filter.range!=''?('&range='+filter.range):'')+
                        (filter.user>0?('&user='+filter.user):'')+
                        ((filter.type+"")!="1,2,3"?('&type='+filter.type):''),
                    dataType: 'json',
                    success: function(data){
                        totalquantity = 0//TotalProducts[getHashProducts()]?TotalProducts[getHashProducts()]:data.total   
                        countTableForGroup = data.total 
                        var data1 = data.data
                        for(var i in data1){
                            $example[data1[i].id]=data1[i]
                            
                            tl(data1,i)
                        }
                        
                        zzz()
                    }        
                })
            }else{
             
                for(var i in products){
                    if(products[i]===null) continue;
                    if(filter.keywordParam!=''){
                        if(products[i].code.toLowerCase().indexOf(filter.keywordParam.toLowerCase())==-1 &&
                           products[i].name.toLowerCase().indexOf(filter.keywordParam.toLowerCase())==-1
                        ) continue;
                    }
                    
                    if(cfs.UseExpireTime && filter.Expire>0){
                        if(products[i].expire=='0000-00-00' ||
                           products[i].expire>gh
                        ) continue;
                    }
                    
                    if(filter.ShowInActiveProduct==2){
                        //if(products[i].sell==1) continue;
                        if(products[i].status==1) continue;
                    }else
                    if(filter.ShowInActiveProduct==3){
                        //if(products[i].sell==0) continue;
                        if(products[i].status==0) continue;
                    }
                    
                    if(filter.onhandFilter>0){
                        //duoi, vuot, con, het
                        switch(parseInt(filter.onhandFilter)){
                            case 1:
                                if(products[i].quantity>=products[i].minqty) continue    
                            break;
                            
                            case 2:
                                if(products[i].maxqty==0 || products[i].quantity<=products[i].maxqty) continue
                            break;
                            
                            case 3:
                                if(products[i].quantity<=0) continue    
                            break;
                            
                            case 4:
                                if(products[i].quantity>0) continue    
                            break;
                        }
                    }
                    
                    if(filter.type.indexOf(parseInt(products[i].type))==-1) continue;
                    
                    //03/13/2020 filter by range
                    if(cfs.BHS && filter.range){
                        var filterrange = filter.range.split('-')
                        var date2 = moment(new Date(products[i].created)).format('YYYY-MM-DD')
                        
                        filterrange[0] = moment(filterrange[0],'DD/MM/YYYY').format('YYYY-MM-DD')
                        filterrange[1] = moment(filterrange[1],'DD/MM/YYYY').format('YYYY-MM-DD')
                        
                        if(date2<filterrange[0] || date2>filterrange[1]) continue;
                        
                    }
                    
                    //03/19/2020 filter by user
                    if(cfs.BHS && filter.user>0){
                        if(filter.user != products[i].user) continue;
                    }
                    
                    //console.log(catRecur(ctg).indexOf(products[i].category),catRecur(ctg),products[i].category)
                    products[i].category = parseInt(products[i].category)
                    if(ctg>0){
                        //if(products[i].category==ctg) 
                        //if(catRecur(products[i].category).indexOf(ctg)>=0)
                        if(catRecur(ctg).indexOf(products[i].category)>=0)
                        countTableForGroup++;
                    }
                    else 
                    countTableForGroup++;
                    
                    $example[products[i].id]=products[i]
                    
                    if(countTableForGroup>cpage*record && countTableForGroup <= (cpage+1)*record){
                    
                        //if(ctg>0 &&  products[i].category!=ctg) continue;
                        //if(ctg>0 &&  catRecur(products[i].category).indexOf(ctg)==-1) continue;
                        if(ctg>0 &&  catRecur(ctg).indexOf(products[i].category)==-1) continue;
                        
                        //07/07/2020
                        tl(products,i)
                        
                        //console.log('abc1')
                    }
                    //console.log('abc2')
                }//endFor
                
                zzz()
            }
            
            
        }
        
        function calcSum(o){
             
            o2 = o.find('>tr>td.tdTotal:not(.ng-binding)>span');
            
            total = 0;
            for(var i =1;i<o2.length;i++){
                //console.log(o2[i])
                //console.log(o2.get(i).innerHTML)
                if(o2.get(i).innerHTML!='')
                    total += parseFloat(o2.get(i).innerHTML);
                //console.log(o2.get(i).className) 
            }
            o.find('>tr:nth(0)>td.tdTotal:not(.ng-binding)').html(total);
            
             
        }
          
        function saveCategory(){
            
             
            s = _serialize('[kendo-window="categoryWindow"]',[0]);
            
            console.log(s);
            
            if(s!=''){
                 
                $.ajax('ajax.php?action=productcategory',{
                    data: s  ,
                    method: "POST",
                    dataType: 'json',
                    success: function(d){
                        console.log(d);
                        if(d.status=='1'){
                             
                            loadJsonProductCategories(function(){
                                var s2 = parse_str(s)
                                if(s2.id == ""){
                                    //is add
                                    if($('kv-product-form').is(':visible')){
                                        _loadGroupPopup(d.id)
                                    }
                                }
                                loadPC()
                            });
                            cancelCategory();
                             
                        }else{
                             //alert(d.error);
                             toastr["error"](d.error);
                        } 
                    }
                });
                
            }else //alert('Điền tên nhóm');
                toastr["error"]('Điền tên nhóm');  
            
            
        }
        
        
        function cancelCategory(){
            $('[kendo-window="categoryWindow"]').dialog('close');
        }
        
        var editorInstance=null;
        
        var qq = function(){
            pretty('kv-product-form',function(d){
                if(cfs.RewardPoint && $(d).attr('ng-model')=='product.ispoint'){
                    if($(d).is('[checked]') && cfs.PointSetting && cfs.PointSetting.Type==1){ //fixed 09/21/2019
                        $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').removeClass('ng-hide')    
                    }else{
                        $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').addClass('ng-hide')
                    }
                }
            });
        }
        
        function UpdateProduct(pid){
            console.log('UpdateProduct',pid)
            
            doo = 'edit';
            
            pr = loadProduct(pid);
            
            type = pr.type;
            
            if(pr.parent>0){
                pr2 = pr;
                
                pr = loadProduct(pr.parent);
            }
            
            //reset empty form
            
            $('kv-product-form [ng-model]').val('');
             
            loadGroupPopup();
            
            console.log('UpdateProduct x1')    
            
            if(cfs.UseCod && pr.type!=3)
                $('[ng-show="cfs.UseCod && product.type!=3"]').removeClass('ng-hide')
            else
                $('[ng-show="cfs.UseCod && product.type!=3"]').addClass('ng-hide')
                
            if(pr.type==3){
                $('[ng-show="product.type==3"]').removeClass('ng-hide')
            }else{
                $('[ng-show="product.type==3"]').addClass('ng-hide')
            }
            
            if(pr.ispoint && cfs.RewardPoint && cfs.PointSetting && cfs.PointSetting.Type==1)
                $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').removeClass('ng-hide')
            else
                $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').addClass('ng-hide')
            
            if(cfs.RewardPoint){
                $('[ng-show="cfs.RewardPoint"]').removeClass('ng-hide')                
            }                
            else
                $('[ng-show="cfs.RewardPoint"]').addClass('ng-hide')
            
            console.log('UpdateProduct x2')    
            
            /*if($('[ng-model="product.description"]').css('display')!='none'){
                
            }*/
            
            $('kv-product-form [ng-model]').each(function(){
                 
                name = getname($(this).attr('ng-model'));
                if(pr[name]!=undefined)
                    $(this).val(pr[name]);
            })
            
            console.log('UpdateProduct x3')    
            
            if(editorInstance==null){
                $('[ng-model="product.description"]').attr('id','_id')
                console.log('UpdateProduct x4')    
                editorInstance = CKEDITOR.replace( '_id', cko() );   
                console.log('UpdateProduct x5')    
            }else{
                console.log('UpdateProduct x6')    
                editorInstance.setData(pr.description)
                console.log('UpdateProduct x7')    
            }
             
            console.log('UpdateProduct 1')    
             
            
            $('kv-product-form .img-pr+div img').attr('src',pr.image);
            
            if(pr.sell==1){
                $('.prettycheckbox>[name="sell"]+a').addClass('checked');
                $('.prettycheckbox>[name="sell"]').attr('checked','checked').val(1);
            }else{
                $('.prettycheckbox>[name="sell"]+a').removeClass('checked');
                $('.prettycheckbox>[name="sell"]').removeAttr('checked');
            }
            
            if(pr.time==1){
                $('.prettycheckbox>[name="time"]+a').addClass('checked');
                $('.prettycheckbox>[name="time"]').attr('checked','checked');
            }else{
                $('.prettycheckbox>[name="time"]+a').removeClass('checked');
                $('.prettycheckbox>[name="time"]').removeAttr('checked');
            }
            
            console.log('UpdateProduct 2')    
            
            if(pr.extra==1){
                $('.prettycheckbox>[name="extra"]+a').addClass('checked');
                $('.prettycheckbox>[name="extra"]').attr('checked','checked');
            }else{
                $('.prettycheckbox>[name="extra"]+a').removeClass('checked');
                $('.prettycheckbox>[name="extra"]').removeAttr('checked');
            }
            
            if(pr.ispoint==1){
                $('.prettycheckbox>[name="ispoint"]+a').addClass('checked');
                $('.prettycheckbox>[name="ispoint"]').attr('checked','checked');
            }else{
                $('.prettycheckbox>[name="ispoint"]+a').removeClass('checked');
                $('.prettycheckbox>[name="ispoint"]').removeAttr('checked');
            }
            
            qq();//pretty('kv-product-form');
            /**setTimeout(function(){
                pretty('kv-product-form');
            },2000);*/
            
            //added 04/02/2019
            $('kv-product-form [ng-model="product.price2"]').parents('li').hide();
            
            console.log('UpdateProduct 3')    
            
            //change k-input va select
            $('kv-product-form .k-dropdown select option[selected]').removeAttr('selected');
             
            $('kv-product-form .k-dropdown select option[value="'+pr.category+'"]').attr('selected','selected');
            $('kv-product-form .k-dropdown .k-dropdown-wrap .k-input').html(
                $('kv-product-form .k-dropdown select option[value="'+pr.category+'"]').html()
            );
             
            //tooltip
            $('kv-product-form [data-toggle="tooltip"]').tooltip()
             
            if(pr.type==2)
                $('kv-product-form [ng-show="product.type==2"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-show="product.type==2"]').addClass('ng-hide');
                
            if(pr.type!=1)
                $('kv-product-form [ng-hide="product.type==1"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-hide="product.type==1"]').addClass('ng-hide');    
            
            console.log('UpdateProduct 4')    
            
            if(pr.type==1)
                $('kv-product-form [ng-show="product.type==1"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-show="product.type==1"]').addClass('ng-hide');
            
            //image             
            $('#files2').unbind('change');  
            $('#files2').change(function(){  
                var formData = new FormData();
                formData.append('files', this.files[0]);
                 
                $.ajax({
                       url : cdn+'/ajax.php?action=uploadimage',
                       type : 'POST',
                       data : formData,
                       processData: false,   
                       contentType: false,   
                       dataType: 'json',
                       success : function(data) {
                           if(data.error==''){
                                // $('#result').append($('<img src="'+data.image+'" />'));
                                if(document.location.protocol=="http:"){
                                    data.image = data.image.replace('https:',"http:")
                                }
                                $('[ng-src="img/default-product.png"]').attr('src',data.image);
                                $('[ng-model="product.image"]').val(data.image);
                           }else toastr.error(data.error);
                       }
                }); 
                
                this.value = '';
            })
            $('[ng-src="img/default-product.png"]').unbind('click')  
            $('[ng-src="img/default-product.png"]').click(function(){
                //ajax delete image
                
                
                $('[ng-model="product.image"]').val('');
                $('[ng-src="img/default-product.png"]').attr('src','img/default-product.png');
                
                
            });
            
            $('[ng-model="product.topping"]').val(pr.topping)
            _addTopping(pr.topping)
            
            //thanh phan
            
            $('kv-product-form .tblProAdd .tr-even.bd-tr.ng-scope').remove();
            
            if(pr.formula.length>0){
                /*
                //hang hoa 2
                //$('kv-product-form .box-UseManufacturing')
                //combo 1
                //$('kv-product-form .fll .itemBox')
                if(pr.type==1)
                    //pp = $('kv-product-form .box-UseManufacturing');
                    pp = $('article.formPrice[ng-show="product.type==1"]')
                else
                    //pp = $('kv-product-form .fll .itemBox');
                    pp = $('article.formPrice[ng-show="product.type==2"]')*/
                
                pp = $('article.formPrice[ng-show="product.type=='+pr.type+'"]');
                
                for(var ii in pr.formula){
                    pr2 = pr.formula[ii];
                    /*
child
:
"1"
quantity
:
"1"                    
                    */
                    
                    pp.find('[ng-show="formulaSelectedProduct"]').attr('data-id', pr2.child);
                    pp.find('#qFormula').val(pr2.quantity);
                    
                    pp.find('[onclick="addFormula(this)"]').click();
                    
                    //ng-show="formulaSelectedProduct"
                }
            }  
            
            //don vi
            $('kv-product-form [ng-repeat="item in product.ProductUnits"]').remove();
            
            fc = findchild(pr.id);
            
            if(fc.length>1){
                for(var ii in fc){
                    fc2 = fc[ii];
                    if(fc2.parent!="0"){
                        addMoreUnit();
                        $('.tblProduct tbody tr:last-child td:nth(0) input').val(fc2.uname);
                        $('.tblProduct tbody tr:last-child td:nth(2) input').val(fc2.uvalue);
                        //$('.tblProduct tbody tr:last-child td:nth(2) input').blur();
                        $('.tblProduct tbody tr:last-child td:nth(4) input').val(fc2.price);
                        $('.tblProduct tbody tr:last-child td:nth(6) input').val(fc2.code);
                        $('.tblProduct tbody tr:last-child td:nth(6) input').attr('readonly','readonly');
                        if(cfs.RewardPoint){
                            $('.tblProduct tbody tr:last-child td:nth(8) input').val(fc2.point);
                        }
                    }
                }
            }
            
            //setTimeout(function(){   
                $('a.fll.icon.toggle').unbind('click')    
                //click
                $('a.fll.icon.toggle').click(function(){
                    if($(this).find('i').hasClass('fa-plus-square')){
                        $(this).siblings(':last-child').removeClass('ng-hide');
                        $(this).find('i').removeClass('fa-plus-square')
                        $(this).find('i').addClass('fa-minus-square')
                    }else{
                        $(this).siblings(':last-child').addClass('ng-hide');
                        $(this).find('i').addClass('fa-plus-square')
                        $(this).find('i').removeClass('fa-minus-square')
                    }
                });    $('a.fll.icon.toggle+h3').unbind('click')    
                $('a.fll.icon.toggle+h3').click(function(){   
                    $(this).prev().click();
                });  
            //},3000)
            
            $('kv-product-form').dialog({
                modal: true,
                width: Math.min($('body').width()-5, 770),
                title: 'Sửa hàng hóa', 
                close: function( event, ui ) {
                    $('.ui-dialog.ui-widget.ui-widget-content').remove(); //2017     
                },
                open: function( event, ui ) {
                    if(cfs.UseExpireTime==1){
                        $('kv-product-form [ng-model="product.expire"]').removeClass('hasDatepicker')
                        $('kv-product-form [ng-model="product.expire"]').datepicker()
                        $('kv-product-form [ng-model="product.expire"]+span').click(function(){
                            $(this).prev().focus()
                        })
                    }else{
                        $('kv-product-form [ng-hide="!cfs.UseExpireTime"]').addClass('ng-hide')
                    }
                },
                beforeClose: function( event, ui ) {
                    //return false
                    editorInstance.destroy()
                    editorInstance = null
                },
            });
        } 
        
        //03/12/2020
        function quickAdd(){
            var check = true;
            $('[onclick="quickAdd()"]').hide()
            $('.w-quick-left [k-ng-model],.w-quick-left [ng-model]:not([ng-model="quick.parent"])').each(function(){
                var m = $(this).attr('k-ng-model')?$(this).attr('k-ng-model'):$(this).attr('ng-model')
                m = m.slice(6)
                //validate number
                if(m!='name'&&m!='name_prefix'&&m!='uname'&&
                    m!='created'&&m!='start_name'&&m!='start_code'&&!$(this).val().match(/^\d+$/)){
                    toastr.warning('Giá trị phải là số')
                    $(this).focus()
                    check = false;
                    return false;
                }
                //validate require
                if((m=='name_prefix')&&$(this).val()==''){
                    toastr.warning('Bạn phải nhập giá trị')
                    $(this).focus()
                    check = false;
                    return false;
                }
                if((m=='start_name'||m=='start_code')&&$(this).val()!=''&&!$(this).val().match(/^\d+$/)){
                    toastr.warning('Giá trị phải là số')
                    $(this).focus()
                    check = false;
                    return false;
                }
                if((m=='category'||m=='category[0]')&&!($(this).val()>0)){
                    toastr.warning('Bạn phải chọn danh mục sản phẩm')     
                    check = false;                         
                    return false;
                }
                //validate regexp
                if(m=='created'&&!$(this).val().match(/^\d{2}\/\d{2}\/\d{4}$/)){
                    toastr.warning('Sai định dạng ngày tháng')
                    $(this).focus()
                    $(this).val(moment().format('DD/MM/YYYY'))
                    return false;
                }
            })
            if(check){
                toastr.info('Bắt đầu thêm, quý vị làm ơn để nguyên trình duyệt, có thể phải chờ lâu tùy vào số lượng sản phẩm')
                $.ajax({
                    url: 'ajax.php?action=quickAdd',
                    type: 'POST',
                    data: _serialize('.w-quick-left form')+'&branch='+cb,
                    dataType: 'JSON',
                    success: function(data){
                        if(data.error){
                            toastr.error(data.error)
                            $('[onclick="quickAdd()"]').show()
                        }else{
                            toastr.info(data.message)
                            $('.k-window-quick-add-product .k-i-close').click()
                            
                            if(products.length<20000){ //added 04/24/2020
                                toastr.info('Bắt đầu tải lại danh sách sản phẩm')
                                loadJsonProducts(function(){
                                    toastr.info('Đã tải lại danh sách sản phẩm')
                                    //console.log('q1')
                                    selectedP = data.ids.split(',')
                                    //console.log('q2')
                                    printQRcode()
                                    //console.log('q3')
                                    loadTables()
                                    //console.log('q4')
                                    saveP()
                                    //console.log('q5')
                                })
                            }else{
                                
                                //kiem tra xem xoa hay k
                                console.log('this.data',this.data)
                                if(this.data && this.data.indexOf('delete=1')>=0 && this.data.match(/parent=(\d+)/)){
                                    //find parent
                                    var n = this.data.match(/parent=(\d+)/)
                                    n = n[1]-0
                                    var m =loadProduct(n)
                                    m.quantity = 0
                                    
                                    db.Products.update(n, {quantity: 0}).
                                        then(function(){}).
                                        catch(Dexie.BulkError, function(e){}); 
                                }
                                
                                var old_rev = localStorage['revision_products_'+cfs.id+'_'+cb+''];
                                var old_total = localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                    old_rev+'_total']-0+data.products.length;
                                var old_pages = localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                    old_rev+'_pages'];  
                                TotalProducts[getHashProducts()] = old_total;   
                                var _l = Math.ceil(old_total/1000);
                                old_pages = old_pages.split(',')
                                if(old_pages.length<_l) {
                                    for(var j=old_pages.length; j<_l; j++){
                                        old_pages[j] = j;
                                    }
                                }
                                old_pages = old_pages.join(',')                             
                                
                                data.products = data.products.map(function(x){
                                    return $.extend({branch: cb},x,{id:x.id-0})
                                })   
                                
                                data.products.reverse()
                                products = data.products.concat(products)
                                db.Products.bulkAdd(data.products).
                                    then(function(){}).
                                    catch(Dexie.BulkError, function(e){});
                                    
                                if(data.revision>0){
                                    localStorage['revision_products_'+cfs.id+'_'+cb+''] = data.revision;
                                    localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                        data.revision+'_total'] = old_total;
                                    localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                        data.revision+'_pages'] = old_pages;
                                    
                                    selectedP = data.ids.split(',')                                    
                                    printQRcode()                                 
                                    loadTables()                                 
                                    saveP() 
                                }else
                                loadRevision(cb,function(d){
                                    localStorage['revision_products_'+cfs.id+'_'+cb+''] = d.revision.products;
                                    localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                        d.revision.products+'_total'] = old_total;
                                    localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                                        d.revision.products+'_pages'] = old_pages;
                                    
                                    selectedP = data.ids.split(',')                                    
                                    printQRcode()                                 
                                    loadTables()                                 
                                    saveP()    
                                })    
                                                                                                        
                            }
                            $('[onclick="quickAdd()"]').show() 
                            
                        }
                        
                    },
                    error: function(){
                        toastr.error('Có lỗi xảy ra')
                        $('[onclick="quickAdd()"]').show()
                    }
                })
            }else{
                $('[onclick="quickAdd()"]').show()
            }    
        }
        var _selectedP=0;
        function AddProduct(type){
            
            if(type == undefined || type == 0){
                
                if(type == undefined) _selectedP=0;
                
                $('.k-window-quick-add-product').show().css({
                    top: 0, 
                    left: ($(window).width()-$('.main>.k-window-quick-add-product').width())/2
                })
                $('.k-overlay').css({'z-index':10004}).show()
                $('.k-window-quick-add-product .k-i-close').unbind('click')
                $('.k-window-quick-add-product .k-i-close').click(function(e){
                    $('.k-window-quick-add-product').hide()
                    $('.k-overlay').hide()
                    return false
                })
                
                if($('[ng-model="quick.category"]').is(':visible')){
                    $('.w-quick-left form>div:nth(0)').removeClass('ng-hide')
                    $('[ng-model="quick.user"]').select3({
                        sources: users,//vkl.admin?users:[{id:create,name:loadUser(create).name}],
                        empty: false,
                        width: '100%',
                        emptyValue: '',
                        key: 'id',
                        val: 'name',
                        selected: create,//''
                        count:5,
                    })
                    
                    var kk = function(){
                        if(def_quick.number==1 && $('[ng-model="quick.category"]').length){
                            $('[ng-model="quick.category"]').select3({
                                sources: product_categories   
                                    .map(function(a){var b = $.extend({},a);b.name = "---".repeat(b.level-0)+b.name;return b;})
                                    ,
                                empty: '--Bắt buộc--',
                                width: '100%',
                                emptyValue: '0',
                                key: 'id',
                                val: 'name',
                                selected: '0',
                                count:8,//5
                            }) 
                            
                            $('[ng-model="quick.category"]').change(function(){
                                var v = $(this).val()
                                if(v>0){
                                    
                                }else{
                                    toastr.warning('Bạn phải chọn 1 danh mục sản phẩm')
                                }
                            })
                            return;                             
                        } 
                        $('.w-quick-left form #divCategory').html('')
                        for(var j=0;j<def_quick.number;j++){
                            $('.w-quick-left form #divCategory').append(_categoryTmpl(j))
                            $('[ng-model="quick.category['+j+']"]').select3({
                                sources: product_categories,
                                empty: j==0?'--Bắt buộc--':'--Không bắt buộc--',
                                width: '100%',
                                emptyValue: '0',
                                key: 'id',
                                val: 'name',
                                selected: '0',
                                count:5
                            }) 
                        }                        
                         
                    }
                    kk()
                    if(_selectedP){
                        $('[ng-model="quick.parent"]').select3({
                            sources: [{id:_selectedP,name:loadProduct(_selectedP).name}], //products
                            empty: false,//'--Không bắt buộc--'
                            width: '100%',
                            emptyValue: '0',
                            key: 'id',
                            val: 'name',
                            selected: _selectedP,
                            count:5
                        })
                        $('.w-quick-left form>div:nth(1),.w-quick-left form>div:nth(2)').removeClass('ng-hide')
                    }else{
                        
                        $('[ng-model="quick.parent"]').select3('destroy')
                        $('[ng-model="quick.parent"]').html('')
                        $('[ng-model="quick.parent"]').val('0')
                        
                        $('.w-quick-left form>div:nth(0)').addClass('ng-hide')
                        
                    } 
                     
                    $('[ng-model="quick.parent"]').change(function(){
                        var v = $(this).val()
                        if(v>0){
                            //hien
                            $('.w-quick-left form>div:nth(1),.w-quick-left form>div:nth(2)').removeClass('ng-hide')
                        }else{
                            //an
                            $('.w-quick-left form>div:nth(1),.w-quick-left form>div:nth(2)').addClass('ng-hide')
                        }
                    })
                    
                    $('.w-quick-left [k-ng-model],.w-quick-left [ng-model]:not([ng-model="quick.parent"])').change(function(){
                        var m = $(this).attr('k-ng-model')?$(this).attr('k-ng-model'):$(this).attr('ng-model')
                        m = m.slice(6)
                        //validate number
                        if(m!='name'&&m!='name_prefix'&&m!='uname'&&m!='created'&&
                            m!='start_name'&&m!='start_code'&&!$(this).val().match(/^\d+$/)){
                            toastr.warning('Giá trị phải là số')
                            $(this).focus()
                            $(this).val(def_quick[m]==undefined?1:def_quick[m])
                            return false;
                        }
                        //validate require
                        if((m=='name_prefix')&&$(this).val()==''){
                            toastr.warning('Bạn phải nhập giá trị')
                            $(this).focus()
                            $(this).val(def_quick[m]==undefined?'':def_quick[m])
                            return false;
                        }
                        if((m=='start_name'||m=='start_code')&&$(this).val()!=''&&!$(this).val().match(/^\d+$/)){
                            toastr.warning('Giá trị phải là số')
                            $(this).focus()
                            $(this).val('')
                            return false;
                        }
                        if((m=='category'||m=='category[0]')&&!($(this).val()>0)){
                            toastr.warning('Bạn phải chọn danh mục sản phẩm')                              
                            return false;
                        }
                        //validate regexp
                        if(m=='created'&&!$(this).val().match(/^\d{2}\/\d{2}\/\d{4}$/)){
                            toastr.warning('Sai định dạng ngày tháng')
                            $(this).focus()
                            $(this).val(moment().format('DD/MM/YYYY'))
                            return false;
                        }
                        if(m!='category'&&m!='parent'){
                            def_quick[m] = $(this).val()
                            localStorage.def_quick = JSON.stringify(def_quick)
                        }
                        if(m=='number'){
                            kk()
                        }
                    })
                    
                    $('[k-ng-model="quick.created"]').datepicker()
                    
                    if(!cfs.BHS){
                        $('[ng-show="cfs.BHS"]').remove()
                    }
                }else if(_selectedP){
                    $('.w-quick-left form>div:nth(0)').removeClass('ng-hide')
                    $('[ng-model="quick.parent"]').select3('destroy')
                    $('[ng-model="quick.parent"]').select3({
                        sources: [{id:_selectedP,name:loadProduct(_selectedP).name}], //products
                        empty: false,//false
                        width: '100%',
                        emptyValue: '0',
                        key: 'id',
                        val: 'name',
                        selected: _selectedP,
                        count:5
                    })  
                    $('.w-quick-left form>div:nth(1),.w-quick-left form>div:nth(2)').removeClass('ng-hide')
                    kk()
                }else{
                    
                    $('[ng-model="quick.parent"]').select3('destroy')
                    $('[ng-model="quick.parent"]').html('')
                    $('[ng-model="quick.parent"]').val('0')
                    $('.w-quick-left form>div:nth(0)').addClass('ng-hide')
                    $('.w-quick-left form>div:nth(1),.w-quick-left form>div:nth(2)').addClass('ng-hide')
                    kk()
                }
                for(var i in def_quick){
                    var n = $('[k-ng-model="quick.'+i+'"]');
                    if(n.length==0) continue;
                    if(n.attr('type')=='checkbox'){
                        if(def_quick[i]==1){
                            n.prop('checked',true)
                        }else{
                            n.prop('checked',false)
                        }
                    }else{
                        n.val(def_quick[i])    
                    }
                    
                }
                
                if(def_quick['created']==undefined){
                    $('[k-ng-model="quick.created"]').val(moment().format('DD/MM/YYYY'))
                }
                
                doShowInputQR() 
                $('.w-quick-left [ng-click="showInput = !showInput"]').unbind('click')
                $('.w-quick-left [ng-click="showInput = !showInput"]').click(function(e){
                    showInput = !showInput
                    doShowInputQR()   
                })
                
                return;
            }
            
            doo = 'add';
            
            //reset empty form
            
            $('kv-product-form [ng-model]').val('');
            $('kv-product-form [ng-model="product.type"]').val(type);
            
            loadGroupPopup();
            
            if(cfs.UseCod && type!=3)
                $('[ng-show="cfs.UseCod && product.type!=3"]').removeClass('ng-hide')
            else
                $('[ng-show="cfs.UseCod && product.type!=3"]').addClass('ng-hide')
                
            if(type!=3)
                $('[ng-show="product.type==3"]').addClass('ng-hide')
            else
                $('[ng-show="product.type==3"]').removeClass('ng-hide')    
                
            if(cfs.RewardPoint && cfs.PointSetting && cfs.PointSetting.Type==1)
                $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').removeClass('ng-hide')
            else
                $('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').addClass('ng-hide')
            
            if(cfs.RewardPoint){
                $('[ng-show="cfs.RewardPoint"]').removeClass('ng-hide')                
            }                
            else
                $('[ng-show="cfs.RewardPoint"]').addClass('ng-hide')    
            
            //load default
            $('kv-product-form .k-dropdown select option').removeAttr('selected');
            $('kv-product-form .k-dropdown .k-dropdown-wrap .k-input').html($('kv-product-form .k-dropdown select option:nth(0)').html());
            
            //tooltip
            $('kv-product-form [data-toggle="tooltip"]').tooltip()
            
            qq();//pretty('kv-product-form')
            
            //added 04/02/2019
            $('kv-product-form [ng-model="product.price2"]').parents('li').show();
            
            if(type==2)
                $('kv-product-form [ng-show="product.type==2"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-show="product.type==2"]').addClass('ng-hide');
                
            if(type!=1)
                $('kv-product-form [ng-hide="product.type==1"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-hide="product.type==1"]').addClass('ng-hide');    
            
            if(type==1)
                $('kv-product-form [ng-show="product.type==1"]').removeClass('ng-hide');
            else
                $('kv-product-form [ng-show="product.type==1"]').addClass('ng-hide');   
            
               
            //click
            ////setTimeout(function(){
                $('a.fll.icon.toggle').unbind('click')  
                $('a.fll.icon.toggle').click(function(){
                    if($(this).find('i').hasClass('fa-plus-square')){
                        $(this).siblings(':last-child').removeClass('ng-hide');
                        $(this).find('i').removeClass('fa-plus-square')
                        $(this).find('i').addClass('fa-minus-square')
                    }else{
                        $(this).siblings(':last-child').addClass('ng-hide');
                        $(this).find('i').addClass('fa-plus-square')
                        $(this).find('i').removeClass('fa-minus-square')
                    }
                });    $('a.fll.icon.toggle+h3').unbind('click')  
                $('a.fll.icon.toggle+h3').click(function(){   
                    $(this).prev().click();
                });
            ////},4000)
            //unit
            $('.tblProduct tbody>tr:not(:first-child)').remove();
            //thanh phan
            $('[ng-show="formulaSelectedProduct"]').addClass('ng-hide');
            $('[ng-show="formulaSelectedProduct"]').removeAttr('data-id');
            
            $('.tblProAdd tbody tr:last-child').removeClass('ng-hide');
            $('.tblProAdd tbody tr:not([ng-show="rights.viewCost"]):not(:first-child):not(:last-child)').remove();
            $('.tblProAdd tbody tr[ng-show="rights.viewCost"] .ng-binding:last-child').html('0');
            //$('[ng-model="product.uname"]').val('');
            
            if(editorInstance==null){
                $('[ng-model="product.description"]').attr('id','_id')
                editorInstance = CKEDITOR.replace( '_id', cko() );   
            }
            
            //image
            //$('[ng-model="product.image"]').val('');
            $('[ng-src="img/default-product.png"]').attr('src',"img/default-product.png");
            $('#files2').unbind('change');  
            $('#files2').change(function(){  
                var formData = new FormData();
                formData.append('files', this.files[0]);
                 
                $.ajax({
                       url : cdn+'/ajax.php?action=uploadimage',
                       type : 'POST',
                       data : formData,
                       processData: false,   
                       contentType: false,   
                       dataType: 'json',
                       success : function(data) {
                           if(data.error==''){
                                // $('#result').append($('<img src="'+data.image+'" />'));
                                if(document.location.protocol=="http:"){
                                    data.image = data.image.replace('https:',"http:")
                                }
                                $('[ng-src="img/default-product.png"]').attr('src',data.image);
                                $('[ng-model="product.image"]').val(data.image);
                           }else toastr.error(data.error);
                       }
                }); 
                
                this.value = '';
            })
            $('[ng-src="img/default-product.png"]').unbind('click')  
            $('[ng-src="img/default-product.png"]').click(function(){
                //ajax delete image
                
                
                $('[ng-model="product.image"]').val('');
                $('[ng-src="img/default-product.png"]').attr('src','img/default-product.png');
                
                
            });
             
            //$('kv-product-form .prettycheckbox input:checkbox').removeAttr('checked');
            //$('kv-product-form .prettycheckbox > a').removeClass('checked');
            
            ////$('kv-product-form .prettycheckbox input:checkbox').attr('checked','checked');
            ////$('kv-product-form .prettycheckbox > a').addClass('checked');
            $('.prettycheckbox>[name="time"]+a').removeClass('checked');
            $('.prettycheckbox>[name="time"]').removeAttr('checked');
            
            $('.prettycheckbox>[name="extra"]+a').removeClass('checked');
            $('.prettycheckbox>[name="extra"]').removeAttr('checked');
            
            $('.prettycheckbox>[name="sell"]+a').addClass('checked');
            $('.prettycheckbox>[name="sell"]').attr('checked','checked').val(1);
            
            if(cfs.RewardPoint){
                $('.prettycheckbox>[name="ispoint"]+a').addClass('checked');
                $('.prettycheckbox>[name="ispoint"]').attr('checked','checked').val(1);
            }else{
                $('.prettycheckbox>[name="ispoint"]+a').removeClass('checked');
                $('.prettycheckbox>[name="ispoint"]').removeAttr('checked');
            }
              
               
            $('kv-product-form').dialog({
                modal: true,
                width: Math.min($('body').width()-5, 770),
                title: 'Thêm '+product_types[type], 
                close: function( event, ui ) {
                    $('.ui-dialog.ui-widget.ui-widget-content').remove();
                },
                open: function( event, ui ) {
                    /*
                    pretty('kv-product-form');
                    setTimeout(function(){
                        pretty('kv-product-form');
                    },2000)
                    setTimeout(function(){
                        pretty('kv-product-form');
                    },2000)
                    setTimeout(function(){
                        pretty('kv-product-form');
                    },2000)*/
                    
                    if(cfs.UseExpireTime==1){
                        $('kv-product-form [ng-model="product.expire"]').removeClass('hasDatepicker')
                        $('kv-product-form [ng-model="product.expire"]').datepicker()
                        $('kv-product-form [ng-model="product.expire"]+span').click(function(){
                            $(this).prev().focus()
                        })
                    }else{
                        $('kv-product-form [ng-hide="!cfs.UseExpireTime"]').addClass('ng-hide')
                    }
                },
                beforeClose: function( event, ui ) {
                    //return false
                    editorInstance.destroy()
                    editorInstance = null
                },
            });
        }
        
        function removeUnitItem(pid,li){
            //pid,a
            $(li).parents('tr').remove();
            //if($('.tblProduct tbody>tr:not(:first-child)').length==0) 
            //    $('[ng-show="product.ProductUnits.length >0"]').addClass('ng-hide');
        }
        
        function EditTable(pid){
            doo = 'edit';
            
            //set value field
            branch = loadTable(pid);
            
            loadGroupPopup();
            
            $('kv-table-form [ng-model]').each(function(k,v){
                 $(this).val(branch[getname($(this).attr('ng-model'))]);
            });
            
            //change k-input va select
            $('kv-table-form .k-dropdown select option[selected]').removeAttr('selected');
             
            $('kv-table-form .k-dropdown select option[value="'+branch.group+'"]').attr('selected','selected');
            $('kv-table-form .k-dropdown .k-dropdown-wrap .k-input').html($('kv-table-form .k-dropdown select option[value="'+branch.group+'"]').html());
            
            
            $('kv-table-form').dialog({
                modal: true,
                width: 720,
                 
                close: function( event, ui ) {
                    $('.ui-dialog.ui-widget.ui-widget-content').remove();
                }
            });
        }
        
        function cancel(){
            $('kv-product-form').dialog('close');
        }
        
        function SaveProduct(){
            console.log('SaveProduct'); 
            console.log(doo);
            
            $('[ng-model="product.description"]').val(editorInstance.getData())
            
            //array_filter(parse_str(_serialize('[ng-show="showFomular"]')),function(x){return !x.match(/[A-Z]/)},1)
            //Object {child: Array[2], quantity: Array[2]}
            //.itemBox.tp
            //$('.boxForm.formPrice')
            //$('.boxForm.formPrice:not(.ng-hide)')
            //array_filter(parse_str(_serialize('.boxForm.formPrice:not(.ng-hide)')),function(x){return !x.match(/[A-Z]/)},1)
            //Object {child: "1", quantity: "1"}
            xunits = array_filter(parse_str(_serialize('.boxForm.formPrice:not(.ng-hide)')),function(x){return !x.match(/[A-Z]/)},1);
            if(xunits.child!=undefined){
                if(typeof xunits.child=='string'){
                    if(xunits.quantity==''){
                        toastr['error']('Nhập đầy đủ thông số thành phần');
                        return;
                    }
                }else{ 
                    for(var i in xunits.child){
                         
                        if(xunits.quantity[i]=='' ){
                            toastr['error']('Nhập đầy đủ thông số thành phần');
                            return;
                        }
                    }  
                }    
            }
            
            //.tblProduct
            //Object {name: Array[2], value: Array[2], price: Array[2], product_code: Array[2]}
            xunits = parse_str(_serialize($('.tblProduct')));
            if(xunits.name!=undefined){
                
                if($('kv-product-form [ng-model="product.uname"]').val()==''){
                    toastr['error']('Nhập đơn vị cơ bản');
                    return;
                }
                 
                if(typeof xunits.name=='string'){
                    //1 value
                    if(xunits.name=='' || xunits.value=='' || xunits.price=='' || xunits.price<0 ){
                        toastr['error']('Nhập đầy đủ thông số đơn vị');
                        return;
                    }
                }else{
                    for(var i in xunits.name){
                        //console.log(i)
                        if(xunits.name[i]=='' || xunits.value[i]=='' || xunits.price[i]=='' || xunits.price[i]<0  ){
                            toastr['error']('Nhập đầy đủ thông số đơn vị');
                            return;
                        }
                    }    
                }
            }
            
            //end validate
            xunits = array_filter(parse_str(_serialize('kv-product-form',[1])),function(x){return !x.match(/[A-Z]/)},1);
            if(xunits.name==undefined){
                toastr['error']('Nhập tên sản phẩm');
                return;
            }
            xunits.sell = $('kv-product-form [ng-model="product.sell"]').val()
            if(xunits.type==3)
            xunits.time = $('kv-product-form [ng-model="product.time"]').val()
            if(xunits.type==2)
            xunits.extra = $('kv-product-form [ng-model="product.extra"]').val()
            
            //console.log(xunits);return;
            /*
            if(doo!='add'){
                //console.log(xunits);
                
                 
                
                return;
            }*/
            
            //add 07/07/2019
            var xunits3 = $.extend({},xunits,{branch:cb})
            if(isArray(xunits3.name)){ //fixed 8/11/2019
                for(var _q in xunits3.name){
                    xunits3.name[_q] = decodeURIComponent(xunits3.name[_q])
                }
            }else
            xunits3.name = decodeURIComponent(xunits3.name)
            xunits3.uname = decodeURIComponent(xunits3.uname)
            xunits3.description = decodeURIComponent(xunits3.description)
            
            $.ajax('ajax.php?action=product',{
                data: xunits3,//decodeURIComponent(decodeURIComponent( http_build_query(xunits) ))+'&branch='+cb ,
                method: "POST",
                dataType: 'json',
                success: function(d){
                    console.log(d);
                    if(d.status=='1'){
                        
                        cancel();
                        loadJsonProducts(loadTables);
                         
                    }else{
                         //alert(d.error);
                         toastr["error"](d.error);
                    } 
                }
            });
        }
         
        function saveTable(){
            
            if(doo == 'add'){
            
                s = _serialize('kv-table-form',[0]);
                 
                if(s){
                    $.ajax('ajax.php?action=table',{
                        data: s+"&branch="+cb,
                        method: "POST",
                        dataType: 'json',
                        success: function(d){
                            console.log(d);
                            if(d.status=='1'){
                                
                                cancel();
                                loadJsonTables(loadTables);
                                
                             
                            }else{
                                 
                            } 
                        }
                    })
                }else{
                     
                    toastr["error"]("Điền tên Phòng/bàn")
                }  
            
            }else if(doo == "edit"){
                s = _serialize('kv-table-form',[0]);
                 
                if(s){
                    $.ajax('ajax.php?action=table',{
                        data: s+"&branch="+cb,
                        method: "POST",
                        dataType: 'json',
                        success: function(d){
                            console.log(d);
                            if(d.status=='1'){
                                
                                cancel();
                                loadJsonTables(loadTables);
                                
                             
                            }else{
                                 
                            } 
                        }
                    })
                }else{
                    toastr["error"]("Điền tên Phòng/bàn")
                     
                }  
            }
        }
        
        function deleteCategory(){
            
            //console.log($('[ng-model="category.id"]').value());
            
             
            if(confirm('Bạn có chắc chắn xóa nhóm này?')){ // Mọi sản phẩm của nhóm và nhóm con sẽ bị xóa.
                var ng = $('[ng-model="category.id"]').val()
                $.ajax('ajax.php?action=deleteproductcategory',{
                    data: 'id='+ng,
                    method: "POST",
                    dataType: 'json',
                    success: function(d){
                        console.log(d);
                        if(d.status=='1'){
                            
                            cancelCategory();
                            
                            if(ctg==ng) ctg=0
                            
                            var doSave=false
                            for(var i in products){
                                if(products[i].category==ng){
                                    products[i].category=0    
                                    doSave=true
                                }
                            }
                            if(doSave)
                                saveProducts()
                             
                            loadJsonProductCategories(loadTableLeft);
                             
                        }else{
                             
                        } 
                    }
                });
            }
             
        }
        
        function removeTopping(id,that){
            $(that).parent().parent().remove()
            
            var jj = $('[ng-model="product.topping"]').val()
            jj = jj.split(',')
            //alert(jj)
            if(jj.indexOf(id+'')>=0){
                for(var i in jj){
                    if(jj[i]==id){
                        jj.splice(i,1)
                        break;
                    }
                }
            }
            $('[ng-model="product.topping"]').val(jj.join(','))
        }
        
        function _addTopping(jj,jj2){
            if(jj!=''){
                jj = jj.split(',')
                if(jj2==undefined){
                    
                }else
                if(jj.indexOf(jj2+'')>=0){
                    
                }else{
                    jj.push(jj2)
                }
                //jj = jj.join(',')
            }else if(jj2==undefined){
                jj = []
            }
            
            else jj = [jj2]
            //alert(jj)
            //alert(jj.length)
            $('[ng-model="product.topping"]').val(jj.join(','))
            
            if(jj.length)
                $('.product-Topping').removeClass('ng-hide')
            else
                $('.product-Topping').addClass('ng-hide')
            
            $('.product-Topping table tbody tr:not(:first-child)').remove()
            for(var i in jj){
                var poo = loadProduct(jj[i]); //alert(jj[i]); alert(poo)
                var trTopping2 = trTopping;
                trTopping2 = trTopping2.replace(/\{\{index\}\}/g,jj[i])
                trTopping2 = trTopping2.replace(/\{\{name\}\}/g,poo.name)
                trTopping2 = trTopping2.replace(/\{\{price\}\}/g,poo.price)
                trTopping2 = trTopping2.replace(/\{\{code\}\}/g,poo.code)
                
                $('.product-Topping table tbody').append(trTopping2)
            }
        }
        
        function itemClicked(li){
            var ol = $(li).parent().parent().prev()
            if(ol.is('[id=productSearchInput]')){
                //console.log($(li).parents('[ng-controller="ProductFormulaAutoCompleteCtrl"]'));
                //ng-binding
                n = $(li).parents('[ng-controller="ProductFormulaAutoCompleteCtrl"]').next();
                n.removeClass('ng-hide');
                n.find('.ng-binding').html(
                    $(li).find('.ng-binding').html()
                );
                n.attr('data-id',$(li).attr('index'));                                
            }else{
                //alert($(li).attr('index'))
                $('.product-Topping').removeClass('ng-hide')
                
                var jj = $('[ng-model="product.topping"]').val(),
                    jj2 = $(li).attr('index');
                
                _addTopping(jj,jj2)
                
                ol.val('')
            } 
            
            $(li).parents('[ng-show="completing"]').addClass('ng-hide');
        }
        
        function addFormula(li){ var pr;
            //a
            m2 = $(li).parents('ul').find('#qFormula');
            
            console.log(m2.val());
            
            if(m2.val()=='') {
                //alert('Điền số lượng sản phẩm');
                toastr["error"]('Điền số lượng sản phẩm'); 
                return;
            }
            
            //m = m.val();
            //m = parseInt(m);
            m = checknum(m2.val());
            
            //if(isNaN(m) || (m==0)){
            if(m<=0){    
                //alert('Số lượng sản phẩm phải dương');
                toastr["error"]('Số lượng sản phẩm phải dương'); 
                return;
            }
            
            if(typeof m == "number"){
                m2.val(m);
            }
             
            n = $(li).parents('ul').find('[ng-show="formulaSelectedProduct"]');
            
            //console.log(n.attr('data-id'));
            
            if(n.attr('data-id')){
                //hide gia von
                $('kv-product-form [ng-model="product.price2"]').val('');
                $('kv-product-form [ng-model="product.price2"]').parents('li').hide();
                
                o = $(li).parents('[ng-show="showFomular"],.itemBox').find('tbody');
                //console.log(o);
                
                o3 = o.find('[onclick="removeFormulaItem('+n.attr('data-id')+',this)"]');
                
                //check double
                //$('[onclick^="removeFormulaItem"]')
                if(o3.length){
                    //console.log(o.find('[onclick^="removeFormulaItem('+n.attr('data-id')+',this)"]')); 
                    var iq = o3.parents('tr').find('[ng-model="item.quantity"]')
                    iq.val(
                        checknum(o3.parents('tr').find('[ng-model="item.quantity"]').val()+'+'+m)
                    );  
                    o3.parents('tr').find('[ng-show="rights.viewCost"]:nth(1)').html(
                        iq.val()*o3.parents('tr').find('[ng-show="rights.viewCost"]:nth(0)').html()
                    )  
                    ////calc(o);               
                }else{
                 
                    pr = loadProduct(n.attr('data-id'));
                    //console.log(pr);
                     
                    
                     
                    o.find('tr:last-child').addClass('ng-hide');
                    
                    templProductFormula2 = templProductFormula;
                    //templProductFormula2 = templProductFormula2.replace(/\{\{i\}\}/gi,o.find('tr').length-3);
                    templProductFormula2 = templProductFormula2.replace(/\{\{i\}\}/gi,pr.id);
                    templProductFormula2 = templProductFormula2.replace(/\{\{code\}\}/gi,pr.code);
                    templProductFormula2 = templProductFormula2.replace(/\{\{price2\}\}/gi,pr.price2==null?0:pr.price2);
                    templProductFormula2 = templProductFormula2.replace(/\{\{name\}\}/gi,pr.name);
                    templProductFormula2 = templProductFormula2.replace(/\{\{quantity\}\}/gi,m);
                    templProductFormula2 = templProductFormula2.replace(/\{\{total\}\}/gi,pr.price2==null?0:(pr.price2*m));
                    
                    o.find('tr:nth('+(o.find('tr').length-3)+')').after($(templProductFormula2));
                    
                    $('[ng-model="item.quantity"]').unbind('change')
                    //onchange
                    $('[ng-model="item.quantity"]').change(function(){
                        //console.log('[ng-model="item.quantity"] change');
                        /*
                        if(!$(this).val().match(/^[0-9]+$/)){
                            $(this).val('1'); 
                            $(this).change();
                            //alert('Bạn phải nhập số');
                            toastr["error"]('Bạn phải nhập số'); 
                            return;
                        }*/
                        if(checknum($(this).val())<=0){
                            toastr["error"]('Bạn phải nhập số dương'); 
                            return;
                        }
                        
                         //console.log($(this).parent().siblings(':first-child').find('[onclick^="removeFormulaItem"]')) 
                         //console.log(parseInt($(this).parent().siblings(':first-child').find('[onclick^="removeFormulaItem"]').attr('onclick').substr(18)));
                         mmm = $(this).parent().siblings(':first-child').find('[onclick^="removeFormulaItem"]');
                         //console.log(parseInt(mmm.attr('onclick').substr(18)));
                         
                         pid = parseInt(mmm.attr('onclick').substr(18));
                         pr = loadProduct(pid);
                         
                         mmm=checknum($(this).val()+'*'+pr.price2,0);
                         
                         $(this).parent().siblings(':last-child').html(
                            //parseInt($(this).val()) * pr.price2
                            mmm==''?'0':mmm
                         );
                         
                         calc($(this).parents('tbody'));
                    });
                
                }
                calc(o);
            }else //alert('Bạn phải chọn sản phẩm trước');
                toastr["error"]("Bạn phải chọn sản phẩm trước");
        }
        
        function calc(o){
            //console.log(o.find('[ng-show="rights.viewCost"]:last-child'));
            o2 = o.find('[ng-show="rights.viewCost"]:last-child');
            total = 0;
            for(var i =1;i<o2.length;i++){
                //console.log(o2[i])
                //console.log(o2.get(i).innerHTML)
                total += parseInt(o2.get(i).innerHTML);
                //console.log(o2.get(i).className) 
            }
            o.find('tr:nth('+(o.find('tr').length-2)+') td:last-child').html(total);
            $('kv-product-form [ng-model="product.price2"]').val(total)
        }
        
        function removeFormulaSelectedProduct(li){//a
            n = $(li).parent();
            n.addClass('ng-hide');
            n.removeAttr('data-id');
        }
        
        function removeFormulaItem(pid,li){
            //a
            $(li).parents('tr').remove();
            
            //unhide gia von
            if($('.boxForm.formPrice:not(.ng-hide) tr').length==3){
            
                
                $('kv-product-form [ng-model="product.price2"]').parents('li').show();
            
            }
            
            calc(o)
        }
        
        function addMoreUnit(){
            v = $('[ng-model="product.uname"]').val();
            if(v==''){
                toastr["error"]("Chưa nhập đơn vị cơ bản");
                return;
            }
            $('[ng-show="product.ProductUnits.length >0"]').removeClass('ng-hide');
            
            templProductUnit2 = templProductUnit;
            
            templProductUnit2 = templProductUnit2.replace(/\{\{i\}\}/,0);
            
            if(!(cfs.RewardPoint && cfs.PointSetting.Type==1 && $('[ng-model="product.ispoint"]').is('[checked]'))){
                templProductUnit2 = $(templProductUnit2)
                templProductUnit2.find('[ng-show="cfs.RewardPoint && cfs.PointSetting.Type==1 && product.ispoint"]').addClass('ng-hide')
            }
             
            $('[ng-show="product.ProductUnits.length >0"]').parent().append(templProductUnit2);
        }
        
        function checkunit(li){
            //input khong trung voi unit goc
            
            if( $(li).val()== $('kv-product-form [ng-model="product.uname"]').val()
            ){
                toastr["error"]("Không được trùng với đơn vị cơ bản");
                $(li).val('');
                return;  
            }
        }
        
        
        function checkCode(li,x){
            
            if(doo!='add') {
                 
                if(x==undefined) //cac unit
                {
                     
                    
                    if($(li).is('[readonly]'))
                    
                    return;
                    
                    else{
                        //check cac product da co
                        for(var i in products){
                            if(products[i].code.toLowerCase() == $(li).val().toLowerCase()){
                                toastr["error"]("Trùng mã hàng hóa");
                                $(li).val('');
                                return;  
                            }
                        }
                        //check voi product chinh
                        if( $(li).val()!='' && $(li).val().toLowerCase()== $('kv-product-form [ng-model="product.code"]').val().toLowerCase()
                        ){
                            toastr["error"]("Trùng mã hàng hóa");
                            $(li).val('');
                            return;  
                        }
                        //cac unit so sanh voi cac unit khac (tat nhien la o attr readonly)
                        $('kv-product-form [ng-model="item.product_code"]:not([readonly])').each(function(){
                            if($(this).val()!='' && this!=li && $(li).val().toLowerCase()==$(this).val().toLowerCase()){
                                toastr["error"]("Trùng mã hàng hóa");
                                $(li).val('');
                                return; 
                            }
                        })
                    }
                
                }else{ //sp chinh
                 
                    for(var i in products){
                        if(products[i].id != pr.id && products[i].code.toLowerCase() == $(li).val().toLowerCase()){
                            toastr["error"]("Trùng mã hàng hóa");
                            //$(li).val('');
                            $(li).val(pr.code);
                            return;  
                        }
                    } //ngoai ra can so sanh voi cac unit moi ( tuc k co attri readonly)
                    
                    //so sanh voi cac unit (tat nhien la o attr readonly)
                    $('kv-product-form [ng-model="item.product_code"]:not([readonly])').each(function(){
                        if($(this).val()!='' && $(li).val().toLowerCase()==$(this).val().toLowerCase()){
                            toastr["error"]("Trùng mã hàng hóa");
                            $(li).val(pr.code);
                            return; 
                        }
                    })
                }
                return true;
            }
            
            if(x==undefined) //cac unit
            //check voi product chinh
            if( $(li).val()!='' && $(li).val().toLowerCase()== $('kv-product-form [ng-model="product.code"]').val().toLowerCase()
            ){
                toastr["error"]("Trùng mã hàng hóa");
                $(li).val('');
                return;  
            }
            
            for(var i in products){
                if(products[i].code.toLowerCase() == $(li).val().toLowerCase()){
                    toastr["error"]("Trùng mã hàng hóa");
                    $(li).val('');
                    return;  
                }
            }
            
            if(x==undefined) //cac unit so sanh voi cac unit khac
            $('kv-product-form [ng-model="item.product_code"]').each(function(){
                if($(this).val()!='' && this!=li && $(li).val().toLowerCase()==$(this).val().toLowerCase()){
                    toastr["error"]("Trùng mã hàng hóa");
                    $(li).val('');
                    return; 
                }
            })
            else
            //so sanh voi cac unit , thuc ra hiem co truong hop nay, vi ma sp chinh thuong go dau tien
            $('kv-product-form [ng-model="item.product_code"]').each(function(){
                if($(this).val()!='' && $(li).val().toLowerCase()==$(this).val().toLowerCase()){
                    toastr["error"]("Trùng mã hàng hóa");
                    $(li).val('');
                    return; 
                }
            })
        }
        
        function checkPrice(li){
            if(!$(li).val().match(/^[0-9]*$/)){
                toastr["error"]("Sai định dạng số");
                $(li).val('');
                return; 
            }
        }
        
        function CalcChildUnitPrice(li){
            val = $(li).val();
            /*
            try{
                val2 = eval(val);
            }catch(e){
                val2 = 0;
            }*/
            
            val2 = checknum(val);
            
            if(val2<=0){
                toastr["error"]("Kết quả phải dương");
                $(li).val('');
                return;                
            }
            
            if(val2==1){
                toastr["error"]("Giá trị khác 1");
                $(li).val('');
                return;                
            }
            
            if(typeof val2=='number'){
                $(li).val(val2);
            }
            
            /*
            //input
            if(doo=='edit'){
                
            }*/
            
            //$('kv-product-form [ng-model="product.price"]')
            $(li).parent().next().next().find('input').val(
                checknum( $('kv-product-form [ng-model="product.price"]').val() + '*' + $(li).val() ,0 ).toFixed(0)
            );
            if(cfs.RewardPoint){
                $(li).parent().next().next().next().next().next().next().find('input').val(
                    checknum( $('kv-product-form [ng-model="product.point"]').val() + '*' + $(li).val() ,0 ).toFixed(0)
                );
            }
        }
        
        function checknumber(li){
            //input
            var val = $(li).val();
            //val2 = checknum(val);
            var val2 = val==''?0: checknum(val,1,0);
            
            if(typeof val2 =='number'){
                $(li).val(val2);
                return;
            }
            
            if(val2==''){
                $(li).val(0); //''
                toastr['error']('Lỗi số');
                console.log(li)
                return;
            }
            
            if(val2<0){
                $(li).val(0); //
                toastr['error']('Số dương');
                return;
            }
        }
        
        function checkPrettyCheckbox(){ console.log('checkPrettyCheckbox')
            old = $('kv-product-form [ng-model="product.sell"]').val();
            $('kv-product-form [ng-model="product.sell"]').parent('.prettycheckbox').click();
            if($('kv-product-form [ng-model="product.sell"]').val()==old){
                qq();//pretty('kv-product-form');
            }else{
                $('kv-product-form [ng-model="product.sell"]').parent('.prettycheckbox').click();
            }
        }
        var showInput = false
        function PrintProduct(pid){
            //toastr.warning('Chức năng đang phát triển')
            //k-window-barcode
            //var ty = loadProduct(pid)
              
            $('.k-window-barcode').show().css({
                top: 0,// ($(window).height()-$('.main>.k-window-barcode').height())/2 ,
                left: ($(window).width()-$('.main>.k-window-barcode').width())/2
            })
            $('.k-overlay').css({'z-index':10004}).show()
            $('.k-window-barcode .k-i-close').unbind('click')
            $('.k-window-barcode .k-i-close').click(function(e){
                $('.k-window-barcode').hide()
                $('.k-overlay').hide()
                return false
            })
            
            //load defaultSettings
            for(var i in z3){
                var mk = $('.w-barcode-left [k-ng-model="'+i+'"]')
                if(i == 'IncludeVND'){
                    mk.find('option').removeAttr('selected')
                    mk.find('option[value="'+z3[i]+'"]').attr('selected','selected')
                    $('.w-barcode-left .k-dropdown:nth(3) .k-dropdown-wrap .k-input').html(mk.find('option[value="'+z3[i]+'"]').html());    
                }else{
                    mk.val(z3[i])
                }
                
            }            
            
            loadIG()
            
            $('.k-window-barcode [ng-click="export()"]').unbind('click')
            $('.k-window-barcode [ng-click="export()"]').click(function(e){
                toastr.info('Chức năng đang phát triển')
            })
            $('.k-window-barcode [ng-click="PrintBarCode(\'Base\')"]').unbind('click')
            $('.k-window-barcode [ng-click="PrintBarCode(\'Base\')"]').click(function(e){
                $('.k-window-barcode .k-i-close').click()
                PrintBarCode(pid)
            })
            
            doShowInput() 
            $('.w-barcode-left [ng-click="showInput = !showInput"]').unbind('click')
            $('.w-barcode-left [ng-click="showInput = !showInput"]').click(function(e){
                showInput = !showInput
                doShowInput()   
            })
        }
        
        function doShowInput(){
            if(showInput){                 
                $('.w-barcode-left input[k-ng-model^="size"]').parent().parent().addClass('ng-show').removeClass('ng-hide')
                $('.w-barcode-left [ng-click="showInput = !showInput"]')[0].childNodes[0].nodeValue = 'Thu gọn '
                $('.w-barcode-left [ng-click="showInput = !showInput"]')[0].childNodes[1].className = "fa fa-caret-up"
            }else{
                 
                $('.w-barcode-left input[k-ng-model^="size"]').parent().parent().addClass('ng-hide').removeClass('ng-show')
                $('.w-barcode-left [ng-click="showInput = !showInput"]')[0].childNodes[0].nodeValue = 'Mở rộng '
                $('.w-barcode-left [ng-click="showInput = !showInput"]')[0].childNodes[1].className = "fa fa-caret-down"
            } 
        }
        
        function doShowInputQR(){
            if(showInput){                 
                $('.w-quick-left [ng-toogle="showInput"]').addClass('ng-show').removeClass('ng-hide')
                $('.w-quick-left [ng-click="showInput = !showInput"]')[0].childNodes[0].nodeValue = 'Thu gọn '
                $('.w-quick-left [ng-click="showInput = !showInput"]')[0].childNodes[1].className = "fa fa-caret-up"
            }else{
                 
                $('.w-quick-left [ng-toogle="showInput"]').addClass('ng-hide').removeClass('ng-show')
                $('.w-quick-left [ng-click="showInput = !showInput"]')[0].childNodes[0].nodeValue = 'Mở rộng '
                $('.w-quick-left [ng-click="showInput = !showInput"]')[0].childNodes[1].className = "fa fa-caret-down"
            } 
        }
        
        function PrintBarCode(pid){
            
            $('.k-window-barcodeProduct [ng-click="PrintBarCode()"]').unbind('click')
            $('.k-window-barcodeProduct [ng-click="PrintBarCode()"]').click(function(e){
                $('.k-window-barcodeProduct .k-i-close').click()
                $("#reportViewer2").printMe2({path:["/assets/bcp.css"]})
            })
            
            
            var z=_serialize('.w-barcode-left'); 
            //"row=1&col=1&SelectedPriceBookId=0&IncludeVND=2"
            
            var z2=parse_str(z); console.log(z2)
            localStorage.defaultSettings = JSON.stringify(z2); z3 = z2;
            
            if(z2.row>=1 && z2.col>=1){
                var ty = loadProduct(pid)
                console.log(ty)
                
                $('.k-window-barcodeProduct').show().css({
                    top: 0 , // ($(window).height()-$('.main>.k-window-barcodeProduct').height())/2 ,
                    left: ($(window).width()-$('.main>.k-window-barcodeProduct').width())/2,
                    position: 'absolute'
                })
                $('.k-overlay').css({'z-index':10004}).show()
                $('.k-window-barcodeProduct .k-i-close').unbind('click')
                $('.k-window-barcodeProduct .k-i-close').click(function(e){
                    $('.k-window-barcodeProduct').hide()
                    $('.k-overlay').hide()
                    return false
                })
                
                var w1=z2.size5,h1=z2.size4
                var tm = function(ii){
                    return '<div class="barcode-container"><div class="ten"></div><svg id="barcode-'+ii+'"></svg><div class="gia"></div></div>'
                }
                
                $('#reportViewer').width(w1*z2.col+(z2.col )*z2.size6)
                $('#reportViewer').height(h1*z2.row+(z2.row )*z2.size6)
                $('#reportViewer').html('')
                for(var i =0;i<z2.col*z2.row;i++){
                    $('#reportViewer').append(tm(i))
                    $("#barcode-"+i).prev().html(ty.name)
                    if(z2.IncludeVND==2)
                    $("#barcode-"+i).next().remove()
                    else
                    $("#barcode-"+i).next().html(formatCurrency(ty.price) + (z2.IncludeVND==0?' VNĐ':''))
                    $("#barcode-"+i).JsBarcode(
                    ty.code,
                    {
                      "format": 'CODE128',
                      "background": '#FFFFFF',
                      "lineColor": '#000000',
                      "fontSize": parseInt(z2.size3),
                      "height": parseInt(z2.size7),
                      "width": parseInt(z2.size8),
                      "margin": parseInt(z2.size9),
                      "textMargin": 0,
                      "displayValue": true,
                      "font": 'Serif',
                      //"fontOptions": $(".font-option.btn-primary").map(function(){return this.value;}).get().join(" "),
                      "textAlign": 'center',
                      "valid":
                        function(valid){
                           
                        }
                    });
                }
                //z2.size8
                $('.barcode-container').css({
                    width: z2.size5+'px',
                    height: z2.size4+'px',
                    'margin-right': z2.size6+'px'
                })   
                $('.ten').css({
                    "font-size": z2.size1+'px'
                })
                $('.gia').css({
                    "font-size": z2.size2+'px'
                })
                 
                 
            }else{
                toastr.warning('Số dòng và cột phải lớn hơn hoặc bằng 1')
            }
        }
        
        function loadIG(){
            console.log('loadIG');
             
            $('.w-barcode-left .k-dropdown:nth(3) .k-dropdown-wrap').unbind('click')
            $('.w-barcode-left .k-dropdown:nth(3) .k-dropdown-wrap').click(function(){
                $(this).next().show();
            });
            
            //set hover
            $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container').hover(
                function(){
                    //$('.w-barcode-left .k-dropdown:nth(3) .k-animation-container').show();
                },
                function(){
                    $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container').hide();
                }
            );
            
            $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container ul li').hover(
                function(){
                    $(this).toggleClass('k-state-hover');
                },function(){
                    $(this).toggleClass('k-state-hover');
                }
            );
            
            $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container ul li').unbind('click')
            //set click
            $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container ul li').click(
                function(){
                    
                    //console.log($(this).data('offset-index'));
                    
                    offset = parseInt($(this).data('offset-index'))+1;
                    
                    $('.w-barcode-left .k-dropdown:nth(3) select option').removeAttr('selected');                    
                    $('.w-barcode-left .k-dropdown:nth(3) select option:nth-child('+offset+')').attr('selected','selected');
                    
                    $('.w-barcode-left .k-dropdown:nth(3) .k-dropdown-wrap .k-input').html($(this).html());
                     
                    $('.w-barcode-left .k-dropdown:nth(3) .k-animation-container').hide();
                     
                    $(this).siblings().removeClass('k-state-selected k-state-focused')
                    $(this).addClass('k-state-selected k-state-focused')
                }
            );
        }
        
        function DeleteProduct(pid){
            var ty = loadProduct(pid)
            $('.k-window-alert:nth(2) .confirm-message strong').html(ty.code)
            $('.k-window-alert:nth(2)').show()
            $('.k-overlay').css({'z-index':10004}).show()
            $('.k-window-alert:nth(2) .k-i-close').unbind('click')
            $('.k-window-alert:nth(2) .k-i-close').click(function(e){
                $('.k-window-alert:nth(2)').hide()
                $('.k-overlay').hide()
                return false
            })
            $('.k-window-alert:nth(2) [ng-enter="onCancel()"]').unbind('click')
            $('.k-window-alert:nth(2) [ng-enter="onCancel()"]').click(function(e){
                $('.k-window-alert:nth(2) .k-i-close').click()
                return false
            })
            
            $('.k-window-alert:nth(2) [ng-enter="onConfirm()"]').unbind('click')
            $('.k-window-alert:nth(2) [ng-enter="onConfirm()"]').click(function(e){
                $.ajax('ajax.php?action=deleteproduct',{
                    data: 'id='+pid,
                    method: "POST",
                    dataType: 'json',
                    success: function(d){
                        console.log(d);
                        if(d.status=='1'){
                            
                            //03/16/2020: remove this product from selectedP if 
                            if(cfs.BHS && selectedP && selectedP.length && selectedP.indexOf(pid+'')>-1){                                 
                                selectedP.slice(selectedP.indexOf(pid+''),1) 
                                saveP()                                        
                            }
                             
                            $('.k-window-alert:nth(2) .k-i-close').click()
                            
                            loadJsonProducts(loadTables);
                             
                        }else{
                             
                        } 
                    }
                });
                return false;                
            })
        }
        
        function ActiveProduct(pid){
            pr = loadProduct(pid);
            var idh = '.k-window-alert.ui-dialog-content'  
            $('.k-window-alert:nth('+(pr.status=='1'?'1':'0')+')').dialog({
                modal: true,
                width: 550,
                title: 'Xác nhận',
                close: function( event, ui ) {
                    $('.ui-dialog.ui-widget.ui-widget-content').remove();
                },
                open: function(){
                    
                    $('.ui-dialog .btn-confirm').unbind('click')  
                    $('.ui-dialog .btn-confirm').click(function(){
                        $.ajax('ajax.php?action=activeproduct',{
                            data: 'id='+pid,
                            method: "POST",
                            dataType: 'json',
                            success: function(d){
                                console.log(d);
                                if(d.status=='1'){
                                    //loadJsonProducts(loadTables);
                                    if(pr.parent>0){
                                        //la con, can update cha
                                        pr2 = loadProduct(pr.parent);
                                        pr2.status = pr.status=='1'?'0':'1';
                                        
                                        //update cac siblings
                                        pr3 = getChildrenOfProduct(pr2.id);
                                        
                                        //console.log()
                                        
                                        for(var i in pr3){
                                             
                                            pr3[i].status = pr2.status;
                                        }
                                    }else{
                                        pr.status = pr.status=='1'?'0':'1';
                                        
                                        //neu co con, update cua con
                                        pr3 = getChildrenOfProduct(pid);
                                        if(pr3)
                                        for(var i in pr3){
                                             
                                            pr3[i].status = pr.status;
                                        }
                                        
                                        
                                    }
                                    
                                    saveProducts();
                                    
                                    //console.log('.k-window-alert:nth('+(pr.status=='1'?'0':'1')+')')
                                    
                                    //$('.k-window-alert:nth(1)').dialog('close');
                                    $('.k-window-alert:visible').dialog('close');
                                    
                                    loadTables();
                                }else{
                                     
                                } 
                            }
                        })
                    }); 
                    $('.ui-dialog .btn-cancel').unbind('click')  
                    $('.ui-dialog .btn-cancel').click(function(){
                        $(idh).dialog('close');
                    })
                }
            })
            
        }
        
        function deleteTable(pid){
            if(confirm('Bạn có chắc chắn xóa phòng/bàn này?')){
                $.ajax('ajax.php?action=deletetable',{
                    data: 'id='+pid,
                    method: "POST",
                    dataType: 'json',
                    success: function(d){
                        console.log(d);
                        if(d.status=='1'){
                            
                             
                            loadJsonTables(loadTables);
                            
                         
                        }else{
                             
                        } 
                    }
                })
            }
        }
        
        function convert1(that){
            var tabConvert = $('.k-detail-row:visible [id$="-7"]') 
            if($(that).val()>0){
                var i = parseInt(tabConvert.attr('id').slice(0,-2))
                //alert(i)
                var pr1 = loadProduct(i)
                var i2 = tabConvert.find('select').val()
                //alert(i2)
                var pr2 = loadProduct(i2)
                tabConvert.find('[ng-model="convert.after"]').val(
                    //pr1.uvalue/pr2.uvalue*$(that).val()
                    checknum("("+pr1.uvalue+")/("+pr2.uvalue+")*("+$(that).val()+")",-3)
                )
            }else{
                toastr.warning('Số lượng phải lớn hơn 0')
                $(that).val('1').focus()
            }
        }
        
        function doConvert(){
            var x = _serialize('.k-detail-row:visible [id$="-7"]',[0,2])
            //"quantity=0.6&product=9&after=1.000"
            //quantity=1&product=8&after=0.200&branch=1&id=9
            if(x==''){
                toastr.warning('Bạn chưa chọn số lượng')
                $('.k-detail-row:visible [id$="-7"] [ng-model="convert.quantity"]').focus()
            }else{
                var tabConvert = $('.k-detail-row:visible [id$="-7"]') 
                var i = parseInt(tabConvert.attr('id').slice(0,-2))
                //alert(x+'&branch='+cb+'&id='+i)
                //return false;
                $.ajax('ajax.php?action=productconvert',{
                    data: x+'&branch='+cb+'&id='+i ,
                    method: "POST",
                    dataType: 'json',
                    success: function(d){
                        console.log(d);
                        if(d.status=='1'){
                            
                            //11/18/2020
                            toastr.info('Chuyển đổi thành công')
                             
                            loadJsonProducts(loadTables);
                             
                        }else{
                             //alert(d.error);
                             toastr["error"](d.error);
                        } 
                    }
                });
            }
        }
        setTitle(loadBranch(cb).name+' - Hàng hóa');
        
        $('[ng-click="exportProduct()"]').click(function(){
            exportProduct()
        }) 
        
        $('[ng-click="importProduct()"]').click(function(){
            importProduct()
        }) 
        
        function importProduct(){
            $('.linksample').attr('href',cfs.UseCod==1?'/Template/MauFileSanPhamCOD.xlsx':'/Template/MauFileSanPham.xlsx') 
            $('.k-window-importProduct').show() 
            $('.k-overlay').css({'z-index':10004}).show()
            $('.k-window-importProduct .k-header .k-i-close').unbind('click')
            $('.k-window-importProduct .k-header .k-i-close').click(function(e){
                $('.k-window-importProduct').hide()
                $('.k-overlay').hide()
                return false
            })
            
            pretty('#importproductform',function(d){
                
            })
            
            $('#importproductform .k-progress').css({
                width: '0%',
                background: 'none'
            })
            
            $('.k-window-importProduct .k-delete').unbind('click')
            $('.k-window-importProduct .k-delete').click(function(e){
                $('#importproductform #files').val('')
                $('#importproductform .k-upload-files, button.k-button.k-upload-selected').addClass('ng-hide')
                return false
            })
            
            //width: 50%; background: #4bac4d;
            
            //_serialize('#importproductform')
            //"IsReplaceExisting=false&IsReplaceExistingByCode=false&IsCreateProductCategory=true"
            
            $('#importproductform #files').unbind('change')
            $('#importproductform #files').change(function(e){
                ChangeImage(this)
            })
        }
        
        function exportProduct(){
            var code = getCodeImpExp();
            addItemImpExp(code,2,'DSSP-'+code+'.xlsx','Đang xuất dữ liệu hàng hóa',0,'')
            
            exportProductsExcelJS(code)
            
            /*$.ajax({
                url: '/ajax.php?action=exportProduct',
                type: 'POST',
                data: $.extend({cb:cb,code:code,category:ctg},filter),//'cb='+cb+'&code='+code,
                dataType: 'JSON',
                success: function(data){
                    if(!data.error){
                        var d = $.extend(data.data,{code:data.code});
                         
                    }else{
                        var d = {
                            content: data.error,
                            status: -1,
                            code:data.code
                        }
                         
                    }
                    changeimpexp(d)
                },
                error: function( jqXHR, textStatus, errorThrown){
                    var d = {
                        content: errorThrown,
                        status: -1,
                        code:data.code
                    }
                    changeimpexp(d)
                }
            })*/
        }

function ChangeImage(that){
    //console.log(that.files[0])
    /*
lastModified: 1553276358180
lastModifiedDate: Sat Mar 23 2019 00:39:18 GMT+0700 (Indochina Time) {}
name: "sp.xlsx"
size: 10012
type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
webkitRelativePath: ""    
    */
    if(that.files.length){
        if(that.files[0].name.match(/\.xlsx$/i)){
            $('#importproductform .k-upload-files, button.k-button.k-upload-selected').removeClass('ng-hide')
            $('#importproductform .k-upload-files .k-filename').html(that.files[0].name).attr('title',that.files[0].name)
        }else{
            toastr.warning('Chỉ chấp nhận file XLSX')
            $(that).val('')
            $('#importproductform .k-upload-files, button.k-button.k-upload-selected').addClass('ng-hide')
        }
    }else{
        $('#importproductform .k-upload-files, button.k-button.k-upload-selected').addClass('ng-hide')
    }
}

(function addXhrProgressEvent($) {
    var originalXhr = $.ajaxSettings.xhr;
    $.ajaxSetup({
        progress: function() { console.log("standard progress callback"); },
        progressUpload: function() { console.log("standard upload progress callback"); },
        code: null,
        xhr: function() {
            var req = originalXhr(), that = this;
            if (req.upload) {
                if (typeof req.upload.addEventListener == "function") {
                    req.upload.addEventListener("progress", function(evt) {
                        that.progressUpload(evt);
                    },false);
                }
            }
            req.code = that.code;
            return req;
        }
    });
})(jQuery);
        
function doimportProduct(th){ //alert('a')
    th.onclick = null
    $(th).unbind('click')
    $(th).click(function(){
        toastr.warning("Đang tải file xlsx")
    })
    var that = $('#importproductform #files')[0]
    var formData = new FormData();
    var fname = that.files[0].name;
    formData.append('files', that.files[0]);
    formData.append('branch', cb);
    var code = getCodeImpExp();
    formData.append('code', code);
    
    var mk = parse_str(_serialize('#importproductform'))
    for(var i in mk){
        formData.append(i, mk[i]=='true'?1:0);
    }
     
    $.ajax({
           url : '/ajax.php?action=importProduct',
           code: code,
           global: true,
           type : 'POST',
           data : formData,
           processData: false,   
           contentType: false,   
           dataType: 'json',
           success : function(data) {
               // th.onclick = 'doimportProduct(this)'
               th.onclick = null
                $(th).unbind('click')
                $(th).click(function(){
                    doimportProduct(this)
                })
               if(data.error==''){   
                    var d= {
                        code: data.code,
                        status: 1,
                        content: 'Đã import xong! Vui lòng F5 để xem các hàng hóa mới'
                    }
                    changeimpexp(d)                   
               }else{
                    //alert(data.error);
                    var d = {
                        content: 'Import lỗi: '+ data.error,
                        status: -1,
                        code:data.code
                    }
                    changeimpexp(d) 
               } 
           },
           error: function(j,s,e){
                //th.onclick = 'doimportProduct(this)'
                th.onclick = null
                $(th).unbind('click')
                $(th).click(function(){
                    doimportProduct(this)
                })
                var d = {
                    content: 'Import lỗi: '+ e,
                    status: -1,
                    code:j.code
                }
                changeimpexp(d) 
           },
           progressUpload: function (e) {
                if (e.lengthComputable) {
                    $('#importproductform .k-progress').css({
                        width: (e.loaded / e.total * 100) + '%',
                        background: '#54A602'
                    })
                    console.log('Loaded '+ (e.loaded / e.total * 100) + '%');
                    if(e.loaded == e.total){
                        $('.k-window-importProduct .k-delete').click()
                        $('.k-window-importProduct .k-window-titlebar.k-header .k-i-close').click()
                        
                        //add job                        
                        addItemImpExp(code,1,fname,'Đang import dữ liệu hàng hóa',0,'#/Products/')
                        
                        //console.log(code,1,fname,'Đang import dữ liệu hàng hóa',0,'')
                    }
                } else {
                    console.log('Length not computable.');
                }
            }
             
    }); 
     
    that.value = '';
}
    
var jh = false
var vlx
    function camera(){
        if(document.location.protocol!='https:') {
            toastr.warning('Để sử dụng chức năng này bạn phải sử dụng giao thức https')
            return
        } 
        $('.k-window-camera').css({
            'left': ($(window).width()-460)/2 ,
            'display': 'block'
        })
        $('.k-overlay').css({
            'display': 'block',
            'z-index': 10006
        })
        $('.k-window-camera .k-i-close,.k-window-camera [ng-click="cancel()"]').unbind('click')
        $('.k-window-camera .k-i-close,.k-window-camera [ng-click="cancel()"]').click(function(e){
            $('.k-window-camera').hide()
            $('.k-overlay').css({
                 
                'z-index': -6 // 10004
            })
            Quagga.stop()
            
            return false
        })
         
        //if(!jh){
            $('[kendo-window="cameraWindow"] select').unbind('change')
            $('[kendo-window="cameraWindow"] select').change(function(e){
                Quagga.stop()
                vlx.locator.patchSize = $(this).val()
                //Quagga.start()
                ii()
            })
            
            var lastResult = null
        	//var streamLabel = Quagga.CameraAccess.getActiveStreamLabel();
        	var deviceId = null;
        	var cc = 0;
        
        var ii = function(){
        		Quagga.init( vlx
                    
                    , function(err) {
        			  if (err) {
        				  console.log(err);
        				  return
        			  }
        			  console.log("Initialization finished. Ready to start");
        			  Quagga.start();
        		  });
        	}
            
        var ii2 = function(){
            Quagga.CameraAccess.enumerateVideoDevices()
        	.then(function(devices) {		 
        		devices.forEach(function(device) {			
        			if( device.label.indexOf("back")>-1 ){
        				deviceId = device.deviceId || device.id;	
        				
        				ii()
        				
        			}		
        		});
        		if(deviceId==null){
        			devices.forEach(function(device) {			
        			if( cc++ == 0 /*|| streamLabel === device.label*/ ){
        				deviceId = device.deviceId || device.id;	
        				
        				ii()
        				
        			}		
        		});
        		}
        	});
        }    
        ii2()    
        if(!jh){    
            vlx = {
        			inputStream : {
        			  name : "Live",
        			  type : "LiveStream",
        			  //target: document.querySelector('#interactive')    ,
        			  constraints: {
        					width: {min: 640},
        					height: {min: 480},
        					aspectRatio: {min: 1, max: 100},
        					facingMode: "environment", // or user
        					deviceId: deviceId
        				}
        			},
        			decoder : {
        			  readers : ["code_128_reader", "ean_reader"]
        			},
        			locator: {
        				patchSize: "large", // x-small, small, medium, large, x-large
        				halfSample: true
        			},
        			numOfWorkers: 4,
        			frequency: 10,
        			 
        			locate: true
        		  }
        	/*var ii = function(){
        		Quagga.init( vlx
                    
                    , function(err) {
        			  if (err) {
        				  console.log(err);
        				  return
        			  }
        			  console.log("Initialization finished. Ready to start");
        			  Quagga.start();
        		  });
        	}
        	Quagga.CameraAccess.enumerateVideoDevices()
        	.then(function(devices) {		 
        		devices.forEach(function(device) {			
        			if( device.label.indexOf("back")>-1 ){
        				deviceId = device.deviceId || device.id;	
        				
        				ii()
        				
        			}		
        		});
        		if(deviceId==null){
        			devices.forEach(function(device) {			
        			if( cc++ == 0 / *|| streamLabel === device.label* / ){
        				deviceId = device.deviceId || device.id;	
        				
        				ii()
        				
        			}		
        		});
        		}
        	});*/
        	
            //App.init();
        	 
            Quagga.onProcessed(function(result) {
                var drawingCtx = Quagga.canvas.ctx.overlay,
                    drawingCanvas = Quagga.canvas.dom.overlay;
        
                if (result) {
                    if (result.boxes) {
                        drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
                        result.boxes.filter(function (box) {
                            return box !== result.box;
                        }).forEach(function (box) {
                            Quagga.ImageDebug.drawPath(box, {x: 0, y: 1}, drawingCtx, {color: "green", lineWidth: 2});
                        });
                    }
        
                    if (result.box) {
                        Quagga.ImageDebug.drawPath(result.box, {x: 0, y: 1}, drawingCtx, {color: "#00F", lineWidth: 2});
                    }
        
                    if (result.codeResult && result.codeResult.code) {
                        Quagga.ImageDebug.drawPath(result.line, {x: 'x', y: 'y'}, drawingCtx, {color: 'red', lineWidth: 3});
                    }
        			
        			if (result.codeResult) {
                        console.log(result.codeResult)
                    }
                }
            });

            Quagga.onDetected(function(result) {
                var code = result.codeResult.code;
        
                //if (lastResult !== code) {
                    lastResult = code;
                    /*var $node = null, canvas = Quagga.canvas.dom.image;
        
                    $node = $('<li><div class="thumbnail"><div class="imgWrapper"><img /></div><div class="caption"><h4 class="code"></h4></div></div></li>');
                    $node.find("img").attr("src", canvas.toDataURL());
                    $node.find("h4.code").html(code);
                    $("#result_strip ul.thumbnails").prepend($node);*/
                    //alert(code)
                    
                    $('[ng-model$="code"]:visible').val(code)
                    
                    $('.k-window-camera .k-i-close').click()
 
                    
                //}
            });
            jh=true
        }
    }    
function chooseP(that){
    toastr.info('Bạn đã chọn xem nhật ký điện tử của sản phẩm: '+$(that).html())
    $(that).parent().siblings().removeClass('active')
    $(that).parent().addClass('active')
    
    selectedPc = $(that).parent().attr('data-pid')-0;
    //savePc()
    
    $.ajax({
        url: 'ajax.php?action=loaddiarys&product='+selectedPc,
        dataType: 'JSON',
        success: function(data){
            $('#selecedPPD').parent().parent().removeClass('ng-hide')
            $('#selecedPPD').html('')
            for(var i in data){
                $('#selecedPPD').append('<li><a href="javascript:void(0)" onclick="chooseD(this)" data-d="'+data[i].id+'">'+moment(data[i].time).format('DD/MM/YYYY HH:mm')+'</a><span onclick="removeD(this)"></span></li>')
            }
        },
        error: function(){
            toastr.warning('Có lỗi xảy ra khi tải danh sách nhật ký điện tử của sản phẩm này')
        }
    })
}    
function removeD(that){
    var i = $(that).prev().attr('data-d')-0
    $(that).parent().hide()
    
    $.ajax({
        url: 'ajax.php?action=removeDiary',
        data: {id: i},
        type: 'post',
        dataType: 'json',
        success: function(data){
            if(data.status){
                _ff()
                toastr.info('Xóa thành công')
            }else{
                toastr.warning('Xóa lỗi')
                $(that).parent().show()
            }
        },
        error: function(){
            toastr.warning('Xóa lỗi')
            $(that).parent().show()
        }
    })
}
function chooseD(that){
    toastr.info('Bạn đã chọn nhật ký để sửa: '+$(that).html())
    selectedPcD = $(that).attr('data-d')-0
    
    $(that).parent().siblings().removeClass('active')
    $(that).parent().addClass('active')
    
    $.ajax({
        url: 'ajax.php?action=loaddiary&id='+selectedPcD,
        dataType: 'JSON',
        success: function(data){
            for(var i in data){
                $('#diaryform [ng-model="diary.'+i+'"]').val(data[i])
                if(i=='content'){
                    editorInstance2.setData(data[i])
                }
            }
            displayI()
        },
        error: function(){
            toastr.warning('Có lỗi xảy ra khi tải nhật ký điện tử này')
        }
    })
}
function base62(s,n){
    var q = bigInt(s).toString(62, "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")
    if(q.length<n){
        return "0".repeat(n-q.length) + q;
    }
    return q;
}
function genQRVN($prid,i){     
    var $n = maindomain;    
    switch($n){
        case 'quanlytot.com':
        case "quanlytot.localhost":
        $n = '0';
        break;
        
        case 'ehome247.com':
        $n = '1';
        break;
        
        default:
        return '';
    }   
    if(i==undefined) 
    return 'http://qrvn.cc/i/'+$n+ base62(cfs.id,2)+ base62($prid,4) ;
    else
    return 'http://qrvn.cc/'+$n+ base62(cfs.id,2)+ base62($prid,4) ;
}
var qrPage=1;
var ll = [],z2;
var tm = function(ii){
    return '<div class="barcode-container">'+
        '<div id="qrcode-'+ii+'"></div>'+
        '<div class="ten"></div>'+
        '<div class="gia"></div>'+
        '<div class="gia"></div>'+
        '<div class="gia"></div>'+
        '<div class="gia"></div>'+
        '</div>'
}
var qrPages ;
var loadPage = function(m){
    qrPage = m;
    console.log('loadPage:',qrPage)

    $('#qrViewer').html('')
    for(var i =0;i<z2.col*z2.row;i++){
         
        var ty = ll[qrPage*z2.col*z2.row+i]
        if(!ty) continue;
         
        ty = loadProduct(ty)
        if(!ty) continue;
         
        $('#qrViewer').append(tm(i))
        $("#qrcode-"+i).append(create_qrcode(genQRVN(ty.id,1)).replace(/"156"/g,'"'+z2.size6+'"')/*'<img src="'+genQRVN(ty.id)+'" width="'+z2.size6+'" />'*/).css({
            'float': 'left',
            width: z2.size6, 
            height: z2.size6,                 
            'padding-right': '10px',
            'margin-top': (z2.size3-z2.size6)/2+'px'
        })
        $("#qrcode-"+i).next().html(ty.name)
         
        $("#qrcode-"+i).next().next().html(ty.code)
        var n = loadUser(z2.user>0?z2.user:(ty.user>0?ty.user:0))
        $("#qrcode-"+i).next().next().next().html(n?n.name:'') ;
        n = z2.date?decodeURIComponent(z2.date):(ty.created=='0000-00-00 00:00:00'?'':moment(ty.created).format('DD/MM/YYYY'));
        $("#qrcode-"+i).next().next().next().next().html(n) ;
        n = loadObject(ty.category,product_categories)
        $("#qrcode-"+i).next().next().next().next().next().html(n?n.name:'') ;
    }
    
    console.log('loadPage 1:')
     
    $('.barcode-container').css({
        width: z2.size4+'px',
        height: z2.size3+'px',
        'margin-right': z2.size5+'px'
    })   
    $('.ten').css({
        "font-size": z2.size1+'px',
        'text-align': 'left',
        'font-weight': 'bold',
        'margin-top': (z2.size3-z2.size1-2-4*z2.size2-6)/2+'px'
    })
    $('.gia').css({
        "font-size": z2.size2+'px',
        'text-align': 'left',
        'font-weight': 'bold'
    })
    
    $('.ten,.gia').css({
        'word-break': 'break-all',
        'float': 'right',
        'overflow': 'auto',
        'white-space': 'normal',
        'width': (z2.size4-z2.size6-10)+'px',
    })
    
    console.log('loadPage 2:')
    
    //phan trang
    $('.k-window-qrcodeProduct .paging-box>div>a:first-child').unbind('click')
    if(qrPage==0) $('.k-window-qrcodeProduct .paging-box>div>a:first-child').addClass('k-state-disabled')
    else{
        $('.k-window-qrcodeProduct .paging-box>div>a:first-child').removeClass('k-state-disabled')
        $('.k-window-qrcodeProduct .paging-box>div>a:first-child').click(function(){
            qrPage=0
            loadPage(qrPage)
        })    
    } 
    
    $('.k-window-qrcodeProduct .paging-box>div>a:first-child').unbind('click')
    if(qrPage==0) $('.k-window-qrcodeProduct .paging-box>div>a:nth-child(2)').addClass('k-state-disabled')
    else{
        $('.k-window-qrcodeProduct .paging-box>div>a:nth-child(2)').removeClass('k-state-disabled')
        $('.k-window-qrcodeProduct .paging-box>div>a:nth-child(2)').click(function(){
            qrPage--
            loadPage(qrPage)
        })        
    }
    
    $('.k-window-qrcodeProduct .paging-box ul .k-state-selected,.k-window-qrcodeProduct .paging-box ul .k-link').html(qrPage-0+1)
    
    $('.k-window-qrcodeProduct .paging-box>div>a:nth(2)').unbind('click') 
    qrPages = Math.ceil(ll.length/z2.col/z2.row)
    
    $('.k-window-qrcodeProduct .paging-box .k-pager-info').html('/Tổng '+qrPages+' trang')
    
    if(qrPage<qrPages-1){
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(2)').removeClass('k-state-disabled')
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(2)').click(function(){
            qrPage=qrPage-0+1
            loadPage(qrPage)
        })  
    }else
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(2)').addClass('k-state-disabled')
    
    $('.k-window-qrcodeProduct .paging-box>div>a:nth(3)').unbind('click') 
    if(qrPage<qrPages-1){
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(3)').removeClass('k-state-disabled')
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(3)').click(function(){
            qrPage=prPages-1
            loadPage(qrPage)
        })  
    }else
        $('.k-window-qrcodeProduct .paging-box>div>a:nth(3)').addClass('k-state-disabled')
}

function recycleProduct(){
    $('.k-window-recycle').show().css({
        top: 0, 
        left: ($(window).width()-$('.main>.k-window-recycle').width())/2
    }) 
    $('.k-overlay').show().css({'z-index':10004}) 
    $('.k-window-recycle .k-header .k-i-close').unbind('click')
    $('.k-window-recycle .k-header .k-i-close').click(function(e){
        $('.k-window-recycle').hide()
        $('.k-overlay').hide()
         
        return false
    }) 
    
    //03/19/2020
    $('.w-recycle-left>div:first-child').html('Bạn đã chọn '+selectedP.length+' sản phẩm')
    $('[ng-model="recycle.user"]').select3({
        sources: users,
        empty: false,
        width: '100%',
        emptyValue: '',
        key: 'id',
        val: 'name',
        selected: create,
        count:5
    })    
    $('[k-ng-model="recycle.date"]').val(moment().format('DD/MM/YYYY HH:mm'));    
    if(!$('[k-ng-model="recycle.date"]').is('.has-datetimepicker'))
        $('[k-ng-model="recycle.date"]').addClass('has-datetimepicker').datetimepicker({format:'d/m/Y H:i'})
}

function doRecycle(){
    var zz = parse_str(_serialize('.k-window-recycle form'));
    //{note: "", join: "1"}
    zz.ids = selectedP;
    zz.branch = cb;
    zz.note = decodeURIComponent(zz.note);
    //03/21/2020
    if(zz.date)
        zz.date = decodeURIComponent(zz.date);
    
    $('[onclick="doRecycle()"]').hide() 
    $.ajax({
        url: 'ajax.php?action=doRecycle',
        type: 'POST',
        data: zz,
        dataType: 'JSON',
        success: function(data){
            if(data.error){
                toastr.error(data.error)
                $('[onclick="doRecycle()"]').show()
            }else{
                toastr.info(data.message)
                $('.k-window-recycle .k-i-close').click()
                
                if(products.length<20000){ //added 04/24/2020
                    toastr.info('Bắt đầu tải lại danh sách sản phẩm')
                    loadJsonProducts(function(){
                        toastr.info('Đã tải lại danh sách sản phẩm')
                        selectedP = []
                        loadTables()
                        saveP()                     
                    })
                }else{
                    for(var i in selectedP){
                        var p = loadProduct(selectedP[i])
                        p.quantity = 0;                        
                        //db.Products.update(selectedP[i], {quantity: 0})
                    }
                    //db.Products.where("id").anyOf(selectedP).then()
                    db.Products.where("id").anyOf(selectedP.map(function(b){return b-0})).modify({quantity: 0}).
                        then(function(){}).
                        catch(Dexie.BulkError, function(e){});
                    
                    var old_rev = localStorage['revision_products_'+cfs.id+'_'+cb+''];
                    var old_total = localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                        old_rev+'_total'];
                    var old_pages = localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                        old_rev+'_pages'];
                    
                    if(data.revision>0){
                        localStorage['revision_products_'+cfs.id+'_'+cb+''] = data.revision;
                        localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                            data.revision+'_total'] = old_total;
                        localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                            data.revision+'_pages'] = old_pages;
                            
                        selectedP = []
                        loadTables()
                        saveP()         
                    }else                        
                    loadRevision(cb,function(data){
                        localStorage['revision_products_'+cfs.id+'_'+cb+''] = data.revision.products;
                        localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                            data.revision.products+'_total'] = old_total;
                        localStorage['revision_products_'+cfs.id+'_'+cb+'_'+
                            data.revision.products+'_pages'] = old_pages;
                        
                        selectedP = []
                        loadTables()
                        saveP()         
                    })
                    
                }
                $('[onclick="doRecycle()"]').show()  
            }
            
        },
        error: function(){
            toastr.error('Có lỗi xảy ra')
            $('[onclick="doRecycle()"]').show()
        }
    })
}

function splitProduct(){
    _selectedP = selectedP[0]
    AddProduct(0)
}

function PrintQRCode(){
    for(var i=0;i<qrPages;i++){
        loadPage(i)
        //setTimeout(function(){
        $("#qrViewer2").printMe2({path:["/assets/bcp.css"],delay:300})//z2.row*z2.col*300
        //},1000)
    }
    
}
function PrintQR(){
    z2 = parse_str( _serialize('.w-qr-left form').replace(/(^|\&)q/g,'$1') );
    
    $('.k-window-qrcodeProduct').show().css({
        top: 0, 
        left: ($(window).width()-$('.main>.k-window-qrcodeProduct').width())/2
    }) 
    $('.k-overlay').css({'z-index':10013}) 
    $('.k-window-qrcodeProduct .k-header .k-i-close').unbind('click')
    $('.k-window-qrcodeProduct .k-header .k-i-close').click(function(e){
        $('.k-window-qrcodeProduct').hide()
        $('.k-overlay').css({'z-index':10004}) 
         
        return false
    }) 
    
    var w1=z2.size4,h1=z2.size3
     
    $('#qrViewer').width(w1*z2.col+(z2.col )*z2.size5)
    $('#qrViewer').height(h1*z2.row+(z2.row )*z2.size5)
    
    ll = []
    for(var n in z2){
        if(n.match(/product_/)){
            for(var j=0;j<z2[n];j++){
                ll.push(n.slice(8)-0)
            }
        }            
    }
     
    loadPage(0)
}
function printQRcode(f){
    //toastr.info('Chức năng này đang phát triển')
    
    if(f){
        
        return false;
    }
    
    $('.k-window-print-qr').show().css({
        top: 0, 
        left: ($(window).width()-$('.main>.k-window-print-qr').width())/2
    })
    $('.k-overlay').css({'z-index':10004}).show()
    $('.k-window-print-qr .k-i-close').unbind('click')
    $('.k-window-print-qr .k-i-close').click(function(e){
        $('.k-window-print-qr').hide()
        $('.k-overlay').hide()
        return false
    })
    
    if($('.k-window-print-qr select').is(':visible'))
    $('.k-window-print-qr select').select3({
        sources: vkl.admin?users:[{id:create,name:loadUser(create).name}],
        empty: '-Không bắt buộc-',
        width: '100%',
        emptyValue: '0',
        key: 'id',
        val: 'name',
        selected: '',
        count:5
    })
    
    $('.k-window-print-qr .k-detail-cell ul li').unbind('click')
    $('.k-window-print-qr .k-detail-cell ul li').click(function(){
        $(this).siblings().removeClass('k-tab-on-top k-state-active')
        $(this).addClass('k-tab-on-top k-state-active')
        
        var i = $(this).index()-0+1
        $('.k-window-print-qr form>div').addClass('ng-hide')
        $('.k-window-print-qr .tab'+i).removeClass('ng-hide')
    })
    
    for(var i in def_qr){
        
        //delete old product
        var n = i.match(/product_(\d+)/)
        if(n){
            if(selectedP.indexOf(n[1])==-1){
                delete def_qr[i]
                localStorage.def_qr = JSON.stringify(def_qr)
                continue
            }
        }
        
        //console.log('.w-qr-left [k-ng-model="q'+i+'"]')
        $('.w-qr-left [k-ng-model="q'+i+'"]').val(def_qr[i])
        
        
    }
    
    if(!$('.w-qr-left [k-ng-model="qdate"]').is('.hasDatepicker'))
        $('.w-qr-left [k-ng-model="qdate"]').datepicker()
     
    if(_tplx==undefined)
    _tplx = $('.k-window-print-qr .tab2>div:first-child')[0].outerHTML;
    
    $('.k-window-print-qr .tab2').html('')
    
    for(var i in selectedP){
        var prid = selectedP[i]
        var p = loadProduct(prid)
        if(p){
            var _tplx2 = $(_tplx)
            _tplx2.find('label').html(p.name)
            _tplx2.find('input').
                attr('id','q_product_'+prid).
                attr('k-ng-model','qproduct_'+prid).
                val(def_qr['product_'+prid]?def_qr['product_'+prid]:1)
            $('.k-window-print-qr .tab2').append(_tplx2)
        }
    }
    
    $('.w-qr-left [k-ng-model^="q"]').unbind('change')
    $('.w-qr-left [k-ng-model^="q"]').change(function(){
        var x = $(this).attr('k-ng-model').slice(1)
         
        var n = $(this).val()
        if(x!='date' && n<=0) {
            n = def_qr[x]?def_qr[x] : 1
            $(this).val(n)
            toastr.warning('Giá trị phải dương')
            $(this).focus()
        }
        def_qr[x] = n;
        localStorage.def_qr = JSON.stringify(def_qr)
    })
}
var editorInstance2=null, _tplx;   
function showDiary(){
    $('.k-window-diary').show().css({
        top: 0, 
        left: ($(window).width()-$('.main>.k-window-diary').width())/2
    })  
    $('.k-overlay').css({'z-index':10004}).show()
    $('.k-window-diary .k-header .k-i-close').unbind('click')
    $('.k-window-diary .k-header .k-i-close').click(function(e){
        $('.k-window-diary').hide()
        $('.k-overlay').hide()
        selectedPcD = null;
        selectedPc = null;
        return false
    }) 
    $('#selecedPP').html('')
    for(var i in selectedP){
        var j = loadProduct(selectedP[i])
        $('#selecedPP').append('<li data-pid="'+selectedP[i]+'"><a href="javascript:void(0)" onclick="chooseP(this)">'+j.name+(j.uname?(' ('+j.uname+')'):'')+'</a><span onclick="prevP(this)"></span></li>')
    }   
    var $s = $('<select id="selectedPDs" ng-model="diary.user"></select>')
    
    /*if(vkl.admin){
        for(var i in users){
            $s.append('<option value="'+users[i].id+'">'+users[i].name+'</option>')        
        }
    }else{
        $s.append('<option value="'+create+'">'+loadUser(create).name+'</option>')    
    }*/
    
    $('#selectedPD').html('').append($s)
    $('#selectedPDs').select3({
        sources: vkl.admin?users:[{id:create,name:loadUser(create).name}],
        empty: false,
        width: '100%',
        emptyValue: '',
        key: 'id',
        val: 'name',
        selected: '',
        count:5
    })  
    
    if(editorInstance2==null){
         
        editorInstance2 = CKEDITOR.replace( 'selectedPC', cko() );   
         
    } 
     
    if(!$('#selectedPDD').is('.has-datetimepicker'))
        $('#selectedPDD').addClass('has-datetimepicker').datetimepicker({format:'d/m/Y H:i'})
        
    //$('#selectedPDD').val(moment().format('DD/MM/YYYY HH:mm'))
    _ff()
    
    $('#selecedPPD').parent().parent().addClass('ng-hide')
     
}   

function getObjectURL(file) {
  var url = '';
  if (window.createObjectURL!=undefined) // basic
    url = window.createObjectURL(file);
  else if (window.URL!=undefined) // mozilla(firefox)
    url = window.URL.createObjectURL(file);
  else if (window.webkitURL!=undefined) // webkit or chrome
    url = window.webkitURL.createObjectURL(file);
  return url;
}

function displayI(image){
    var c= $('#selectedPII').val()
    
    $('#selectedPI>div:not(:first-child)').remove()
    
    if(c){
        c=c.split(',')
    }else c = []
    
    if(image){
        c.push(image)
        $('#selectedPII').val(c.join(','))
    }
    
    for(var i in c){
        $('#selectedPI').append('<div><img src="'+c[i]+'" width="50" height="50" /><span onclick="closeI(this)"></span></div>')
    }
}


function uploadF(that){
    if(that.files[0].size>5*1024*1024){
        toastr.error('File ảnh không được lớn hơn 5Mb')
        this.value = '';
        return false
    }
    
    var formData = new FormData();
    formData.append('files', that.files[0]);
    
    $('#selectedPI').append('<div><img src="/assets/images/loading.svg" width="50" /></div>')
     
    $.ajax({
           url : cdn+'/ajax.php?action=uploadimage',
           type : 'POST',
           data : formData,
           processData: false,   
           contentType: false,   
           dataType: 'json',
           success : function(data) {
               if(data.error==''){                                          
                    displayI(data.image)
                    toastr.info('Tải ảnh thành công')
               }else toastr.error(data.error);
           }
    }); 
    
    that.value = '';
}
function closeI(that){
    var j = $(that).prev().attr('src')
    
    var c= $('#selectedPII').val()
    if(c) c=c.split(',')
    else c=[]
     
    for(var i in c){
        if(c[i]==j){
            c.splice(i,1)
            $('#selectedPII').val(c.join(','))
            break;
        }
    }
    
    $(that).parent().remove()
    toastr.info('Xóa ảnh thành công')
}

function dodiary(that){
    //selectedP
    //_serialize('#diaryform')
    //"user=1&conten=&image=&time=01%2F03%2F2020%2019%3A09"
    
    //$('#diaryform [ng-model="diary.'+i+'"]')
    
    /*if(selectedPcD){
        
        return false;
    }*/
    
    $(that).hide();
    
    $('[ng-model="diary.content"]').val(editorInstance2.getData())
    
    var data = _serialize('#diaryform') + '&products='+selectedP.join(',')
    $.ajax({
        url: 'ajax.php?action=dodiary',
        data: data,
        type: 'POST',
        success: function(data){
            if(data == 'OK'){
                if(selectedPcD){
                    toastr.info('Sửa nhật ký thành công')
                }else{
                    toastr.info('Thêm nhật ký thành công, quý vị có thể thêm nhật ký mới ngay sau đây')
                    _ff()
                }
            }
            $(that).show();
        },
        error: function(){
            $(that).show();
        }
    })
    
    return false;
}

function _ff(){
    $('#diaryform [ng-model]:not([ng-model="diary.user"])').val('')
    editorInstance2.setData('')
    $('#selectedPDD').val(moment().format('DD/MM/YYYY HH:mm'))
    displayI()
}

function prevP(that){
    toastr.info('Bạn đã bỏ chọn xem danh sách nhật ký sản phẩm: '+$(that).prev().html())
    $(that).parent().removeClass('active')
    
    $('[ng-model="diary.id"]').val('')
    $('#selecedPPD').html('')
    selectedPcD = null
    selectedPc = null
    
    _ff()
}

var def_quick = {
    parent: '',
    number: 1,
    name: '',
    number_name: 5,
    start_name: 1,
    name_prefix: 'SP',
    number_code: 5,
    start_code: 1,
    inherit:1,
    quantity: 1,
    price: 0,
    price2: 0,
    category: 0,
    uname: '',
    sell: 1,
    'delete': 1
},def_qr ;

if(localStorage.def_quick != undefined){ console.log('localStorage.def_quick:',localStorage.def_quick+'');
    var _r = JSON.parse(localStorage.def_quick)
    if(_r)
        def_quick = _r 
    console.log('localStorage.def_quick 2:',def_quick);    
}

if(!cfs.BHS){
    $('ng-hide="!cfs.BHS"').remove()         
}else{
    //config for 3 pieces: 4.33x0.86 inches
    def_qr = {         
        row: 5, 
        col: 3,          
        size1: 12, 
        size2: 12, 
        size3: 119, 
        size4: 200, 
        size5: 4, 
        size6: 64 
    }
    if(localStorage.def_qr != undefined){
        def_qr = JSON.parse(localStorage.def_qr)
    }
}

function removeSelectedP(){
    
    $('#grdProducts tbody tr input:checkbox').each(function(){
        $(this).removeAttr('checked')
        $(this).next().removeClass('checked')
    })
    
    selectedP = []
    saveP()
    
}

var _categoryTmpl = function(i){return '<div class="mb15 category">'+
'<label style="width: 100px;">Nhóm SP '+(i-0+1)+':</label>'+
'<select ng-model="quick.category['+i+']">'+                
'</select>'+              
'</div> '}
</script>

<style>
.pl16{
    padding-left: 16px;
}
.tooltip{
    width: 250px;
}
.kv-window-footer, .kv-group-btn {
    padding: 0;
    text-align: right;
    clear: both;
}
</style>
 
<div class="k-widget k-window k-window-poup k-window-masstel k-window-alert kv-window kv-close-popup window-error" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 500px; display: none; top: 531px; left: 429px; touch-action: pan-y; z-index: 10005; opacity: 1; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Xóa hàng hóa</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div data-role="window" class="k-window-content k-content" tabindex="0">
    <div class="form-wrapper">
      <div class="form-group">
        <p class="confirm-message"><!--Bạn có chắc chắn muốn xóa hàng hóa <strong> SP000020</strong> khỏi danh sách không?-->Hệ thống sẽ xóa hoàn toàn hàng hóa <strong>SP000028</strong> nhưng vẫn giữ thông tin hàng hóa trong các giao dịch lịch sử nếu có. Bạn có chắc chắn muốn xóa?</p>
      </div>
    </div>
    <div class="kv-window-footer">
      <button class="btn-confirm kv2Btn" ng-enter="onConfirm()" ng-hide="noYes"><i class="fa fa-check"></i>Đồng ý</button>
      <button class="btn-cancel kv2Btn kv2BtnYellow" ng-enter="onCancel()"><i class="fa fa-ban"></i>Bỏ qua</button>
    </div>
  </div>
</div>

<div class="k-widget k-window k-window-poup kv-window k-window-barcode" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 400px; height: 520px; display: none; top: 0px; left: 350px; position: absolute; touch-action: pan-y; z-index: 10007; transform: scale(1); opacity: 1;">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Tùy chọn in Mã vạch</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="barcodeChoose" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="658" k-height="520" k-modal="true" k-close="onClose" data-role="window" class="k-window-content k-content" style="display: block;" tabindex="0">
    <div class="row row-padding-5 form-wrapper">
      <div class="w-barcode-left ">
        <form class="ng-valid ng-valid-parse ng-pristine">
          <div class="mb15">
            <label style="width: 100px;">Số dòng:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style=""><input type="text" id="_row" value="4" k-ng-model="row"></span></div>
          <div class="mb15">
            <label style="width: 100px;">Số cột:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style=""><input type="text" id="_col" value="2" k-ng-model="col"></span></div>
          <div class="mb15">
            <label style="width: 100px;">Bảng giá:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-valid ng-not-empty ng-valid-parse ng-touched" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" style="" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649"><span unselectable="on" class="k-dropdown-wrap k-state-default"><span unselectable="on" class="k-input ng-scope">Bảng giá chung</span>
            <span
            unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-arrow-s">select</span></span>
              </span>
              <select kendo-drop-down-list="" ng-model="SelectedPriceBookId" k-options="comboPriceBook" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist" style="display: none;">
                <option value="0" selected="selected">Bảng giá chung</option>
                <option value="-1">Không in giá</option>
              </select>
              </span>
          </div>
          <div class="mb15">
            <label style="width: 100px;">In giá:</label>
        <span title="" class="k-widget k-dropdown k-header" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" style=""
            aria-activedescendant="1a3c9993-bcb8-4e08-94a8-5ef3c7ad4cc3">
            <span unselectable="on" class="k-dropdown-wrap k-state-default"><span unselectable="on" class="k-input ng-scope">Giá kèm VNĐ</span><span unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-arrow-s">select</span></span>
            </span>
            
            <div class="k-animation-container" style="width: 270px; height: 60px; margin-left: 0px; padding-left: 0px; padding-right: 0px; padding-bottom: 0px; display: none; box-sizing: content-box; overflow: hidden; ">
            <div class="k-list-container k-popup k-group k-reset" data-role="popup" style="position: absolute; font-size: 12px; font-family: Arial, Helvetica, sans-serif; font-stretch: normal; font-style: normal; font-weight: normal; line-height: normal; width: 268px; height: 80px; ">
            <div class="k-group-header" style="display:none"></div>
            <div class="k-list-scroller" unselectable="on" style="height: 80px;">
            <ul unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
            <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope k-state-selected k-state-focused" data-offset-index="0" id="985764ee-2929-4ee1-a1d1-5bad7d035d9a">Giá kèm VNĐ</li>
            <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope " data-offset-index="1" id="985764ee-2929-4ee1-a1d1-5bad7d035d9a">Giá không kèm VNĐ</li>
            <li tabindex="-1" role="option" unselectable="on" class="k-item ng-scope " data-offset-index="2" id="985764ee-2929-4ee1-a1d1-5bad7d035d9a">Không in giá</li>
            </ul>
            </div>
            </div>
            </div>
            
            <select kendo-drop-down-list="" k-ng-model="IncludeVND" k-options="comboPrintVND" ng-show="SelectedPriceBookId != -1" data-role="dropdownlist" style="display: none;">
              <option value="0" selected="selected">Giá kèm VNĐ</option>
              <option value="1">Giá không kèm VNĐ</option>
              <option value="2">Không in giá</option>
            </select>
            </span>
          </div>
          
          <div class="mb15">
            <label style="width: 100px;">Size tên SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size1" value="10" k-ng-model="size1"></span></div>
          <div class="mb15">
            <label style="width: 100px;">Size giá:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size2" value="10" k-ng-model="size2"></span></div>
          <div class="mb15">
            <label style="width: 100px;">Size mã SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size3" value="14" k-ng-model="size3"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Cao phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size4" value="99" k-ng-model="size4"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Rộng phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size5" value="142" k-ng-model="size5"></span></div>
          <div class="mb15">
            <label style="width: 100px;">K.cách phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size6" value="5" k-ng-model="size6"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Cao vạch:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size7" value="35" k-ng-model="size7"></span></div>
          <div class="mb15">
            <label style="width: 100px;">Rộng vạch:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size8" value="1" k-ng-model="size8"></span></div>
          <div class="mb15">
            <label style="width: 100px;">K.cách vạch:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="_size9" value="1" k-ng-model="size9"></span></div>
          <a class="ng-binding" ng-hide="showOrderSearch" href="javascript:void(0)" ng-click="showInput = !showInput">Mở rộng <i class="fa fa-caret-down"></i></a>  
          <a ng-click="export()" class="kv2Btn ng-binding kv2Btn-barcode kv2BtnExport mb15"><i class="fa fa-file-text-o"></i> Xuất file Excel</a>
          <article class="clb txtL boxBtn ovh"><a ng-click="PrintBarCode('Base')" class="kv2Btn ng-binding" style="
    width: 100%;
"><i class="fa fa-barcode"></i> Xem bản in</a></article>
        </form>
        <p class="ly-ex">Lưu ý: File Exel xuất ra để sử dụng thiết kế mẫu in mã vạch trên các phần mềm chuyên nghiệp khác</p>
        <p class="ng-binding">Lưu ý: Trong trường hợp Mã vạch được in không đọc được, vui lòng sử dụng Mẫu giấy lớn hơn hoặc rút ngắn mã hàng.</p>
      </div>
    </div>
    <div class="clb ovh"></div>
  </div>
</div>

<div class="k-widget k-window k-window-poup k-window-barcodeProduct kv-window" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 500px; height: 200px; display: none; top: 148px; left: 429px; position: fixed; touch-action: pan-y; z-index: 10008; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">In mã vạch</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="barcodePreview" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="500" k-height="200" k-modal="true" k-open="onOpenBarCode" k-close="onClose" data-role="window" class="k-window-content k-content" tabindex="0"
  style="display: block;">
  <div id="reportViewer2" >
    <div id="reportViewer" class="k-widget ng-binding">
       </div> </div>
    <article class="clb txtL boxBtn ovh"><a ng-click="PrintBarCode()" class="kv2Btn ng-binding" style="width: 100%;"><i class="fa fa-barcode"></i> In</a></article>   
</div>
</div>

<style>
#interactive.viewport {
    position: relative;
}

#interactive.viewport > canvas, #interactive.viewport > video {
    max-width: 100%;
    width: 100%;
}

canvas.drawing, canvas.drawingBuffer {
    position: absolute;
    left: 0;
    top: 0;
}
</style>

<div class="k-widget k-window k-window-poup k-window-masstel k-window-camera kv-window" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 460px; display: none; top: 101px; left: 449px; position: fixed; touch-action: pan-y; z-index: 10009; opacity: 1; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Quét mã vạch</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="cameraWindow" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="460" k-modal="true" data-role="window" class="k-window-content k-content" tabindex="0" style="display: block;">
    <div class="form-wrapper form-labels-80">
      <div class="form-group">
        <div id="interactive" class="viewport"></div>
      </div>
      <div class="form-group">
        <label class="form-label control-label ng-binding">Kích cỡ:</label>
        <div class="form-wrap">
            <select name="patchSize" class="form-control">
                <option value="x-small">Hẹp hơn</option>
                <option value="small">Hẹp</option>
                <option selected="selected" value="medium">Trung bình</option>
                <option value="large">Rộng</option>
                <option value="x-large">Rộng hơn</option>
            </select>
        </div>  
      </div> 
    </div>
    <div class="kv-window-footer">  
        <a href="" class="kv2Btn kv2BtnYellow ng-binding" ng-click="cancel()" ng-enter="cancel()" ng-keydown="$event.keyCode == 27 &amp;&amp; cancel()"><i class="fa fa-ban"></i>Bỏ qua</a>
    </div>
  </div>
</div>

<div class="k-widget k-window k-window-poup k-window-poup2 k-window-masstel k-window-importProduct kv-window" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 550px; display: none; top: 0px; left: 404px; position: absolute; touch-action: pan-y; z-index: 10009; opacity: 1; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title" id="importproductform_wnd_title">Nhập hàng hóa từ File dữ liệu</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div id="importproductform" class="control-poup control-poup2 ng-scope k-window-content k-content" kendo-window="importWindow" k-title="_l.product_ImportTitle" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="550" k-modal="true"
    k-close="onCloseImport" data-role="window" tabindex="0" role="dialog" aria-labelledby="importproductform_wnd_title" style="">
    <div class="form-wrapper">
      <div class="bd-bt-poup bd-bt-poup ng-binding">Xử lý dữ liệu (Tải về File mẫu: <a class="linksample" title="Download" href="/Template/MauFileSanPhamCOD.xlsx">Excel File</a>):</div>
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p ng-bind-html="_l.import_IsUpdateStockTitle" class="ng-binding"><strong>Có cập nhật giá trị tồn kho không?</strong></p>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input type="radio" ng-model="IsReplaceExisting" ng-value="false" name="importStatus" kv-pretty-check="" kv-data-label="_l.product_IsReplaceExistingStock" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Không (chỉ  cập nhật thông tin hàng hóa)"
              style="display: none;" value="false" checked="checked"><a href="javascript:void(0)" tabindex="0" class="checked"></a>
            <label for="undefined" class="checked">Không (chỉ  cập nhật thông tin hàng hóa)</label></div>
        </aside><br>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input kv-disabled="!rights.editOnHand" type="radio" ng-model="IsReplaceExisting" name="importStatus" ng-value="true" kv-pretty-check="" kv-data-label="_l.product_UpdateAllInfoStock" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty"
              data-label="Có (cập nhật tất cả thông tin hàng hóa và tồn kho)" style="display: none;" value="true"><a href="javascript:void(0)" tabindex="0" class=""></a>
            <label for="undefined" class="">Có (cập nhật tất cả thông tin hàng hóa và tồn kho)</label></div>
        </aside>
      </div>
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p ng-bind-html="_l.import_IsReplaceProductSameCodeTitle" class="ng-binding"><strong>Xử lý <i>trùng</i> mã hàng, <i>khác</i> tên hàng hóa?</strong></p>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input type="radio" ng-model="IsReplaceExistingByCode" name="importReplaceProduct" ng-value="false" kv-pretty-check="" kv-data-label="_l.import_WarningProductCategory" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Báo lỗi và dừng import"
              style="display: none;" value="false" checked="checked"><a href="javascript:void(0)" tabindex="0" class="checked"></a>
            <label for="undefined" class="checked">Báo lỗi và dừng import</label></div>
        </aside><br>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input type="radio" ng-model="IsReplaceExistingByCode" name="importReplaceProduct" ng-value="true" kv-pretty-check="" kv-data-label="_l.import_InsertProductCategory" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Thay thế tên hàng cũ bằng tên hàng mới"
              style="display: none;" value="true"><a href="javascript:void(0)" tabindex="0" class=""></a>
            <label for="undefined" class="">Thay thế tên hàng cũ bằng tên hàng mới</label></div>
        </aside>
      </div>
      
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p ng-bind-html="_l.import_IsCreateProductCategoryTitle" class="ng-binding"><strong>Danh mục sản phẩm không tồn tại</strong></p>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input type="radio" ng-model="IsCreateProductCategory" name="importProductCategory" ng-value="false" kv-pretty-check="" kv-data-label="_l.import_WarningProductName" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Báo lỗi và dừng import"
              style="display: none;" value="false"><a href="javascript:void(0)" tabindex="0" class=""></a>
            <label for="undefined" class="">Báo lỗi và dừng import</label></div>
        </aside><br>
        <aside class="frRadioCheck frRadioCheckNormal has-pretty-child">
          <div class="clearfix prettyradio labelright  blue"><input type="radio" ng-model="IsCreateProductCategory" name="importProductCategory" ng-value="true" kv-pretty-check="" kv-data-label="_l.import_ReplaceProductName" class="ng-pristine ng-untouched ng-valid ng-isolate-scope ng-not-empty" data-label="Tạo danh mục sản phẩm mới"
              style="display: none;" value="true" checked="checked"><a href="javascript:void(0)" tabindex="0" class="checked"></a>
            <label for="undefined" class="checked">Tạo danh mục sản phẩm mới</label></div>
        </aside>
      </div>
      
      <div class="warning-content">
        <h5 class="title-alert"><i class="fa fa-warning"></i> Lưu ý</h5>
        <p>Hệ thống cho phép nhập tối đa 5.000 mặt hàng mỗi lần từ file .
          <!--{{_l.product_NoteImport}}-->
        </p>
        <p>Mã hàng chứa kí tự đặc biệt (@, #, $, *, /, -, _,...) và chữ có dấu sẽ gây khó khăn khi In và sử dụng mã vạch.</p>
        <p class="ng-binding">Với hình ảnh hàng hóa, hệ thống sẽ lưu trữ và hiển thị theo link hình ảnh được nhập trên file excel (không lưu trữ ảnh).</p>
      </div>
    </div>
    <div class="kv-window-footer">
      <div class="k-widget k-upload k-header k-upload-empty">
        <div class="k-dropzone">
          <div class="k-button k-upload-button"><input kendo-upload="" name="files" id="files" type="file" k-options="ImportFile" title="Chọn file dữ liệu" data-role="upload" autocomplete="off"><span>Chọn file dữ liệu</span></div><em>drop files here to upload</em>
        </div>
        <ul class="k-upload-files k-reset ng-hide">
            <li class="k-file" data-uid="c6166e3b-e9b9-454a-87c5-4237bd140028">
                <span class="k-progress"></span>
                <span class="k-icon k-i-xlsx"></span>
                <span class="k-filename" title="sp.xlsx">sp.xlsx</span>
                <strong class="k-upload-status">
                    <button type="button" class="k-button k-button-bare k-upload-action"><span class="k-icon k-i-close k-delete" title="Remove"></span></button>
                </strong>
            </li>
        </ul>
        <button type="button" class="k-button k-upload-selected ng-hide" onclick="doimportProduct(this)">Thực hiện</button>
      </div>
    </div>
    <div class="alert alert-danger ng-binding" ng-bind-html="ImportError"></div>
    <!-- ngIf: IsLoadingImportProduct -->
  </div>
</div>
<style>
.control-poup2 .k-button span:before {
    font-family: FontAwesome;
    position: absolute;
    left: 16px;
    content: "\f0c5";
    font-size: 16px;
    font-weight: 400;
}

button.k-button-bare .k-icon:before {
    font-family: FontAwesome;
    font-size: 12px!important;
    color: #fff;
    position: absolute;
    left: 3px!important;
    top: 8px!important;
}

.k-button:hover .k-i-close:before {
    color: #fff!important;
}

button.k-button-bare .k-icon.k-delete:before {
    content: "\f00d"!important;
}

#importproductform .k-upload .k-upload-selected{
    width: auto;
}



.k-hierarchy-cell .prettycheckbox {     
    margin-top: -3px;
}
.headerContent .selectedP {
    float: left; 
    position: relative;
}
.selectedP ul {
  position: absolute;
  top: 98%;
  left: 8px;
  z-index: 999;
  background: #5dba00;
  width: 202px;
  display: none;
  border-radius: 0 2px 2px 2px
}

.selectedP ul li a {
  color: #fff;
  display: block;
  padding: 0 10px 0 29px;
  margin: 0;
  line-height: 40px;
  white-space: nowrap
}

.selectedP ul li a .fa {
  margin-right: 3px
}

.selectedP ul li a:hover {
  background: #206511
}

.selectedP:hover ul {
  display: block
}
#selectedPI{height: 50px;}

#selectedPI>div{
    width:50px; height:50px;
    float: left;
    margin-right: 5px;
    background-color: gray;
    cursor: pointer;
}
#selectedPI>div:first-child:before{
    content: "\f067";
    font: normal normal normal 14px/1 FontAwesome;
    position: absolute;
    margin: 19px 20px;
    color: red;
}
#selectedPI>div span{
    margin-top: -50px;
    margin-left: 38px;
    width: 12px;
    height: 12px;
    display: block;
}
#selectedPI>div span:before {     
    content: '';
    width: 12px;
    height: 12px;
    background-color: red;
    -webkit-mask: url(/assets/images/close.svg) no-repeat 50% 50%;  
    mask: url(/assets/images/close.svg) no-repeat 50% 50%;
    -webkit-mask-size: cover;
    mask-size: cover;
    display: block;
}

#selecedPP li.active a, #selecedPPD li.active a{
    font-weight: bold;
    font-size: 1.3em;
}

#selecedPP li span, #selecedPPD li span{
    margin-top: -15px;
    margin-left: calc(100% - 15px);
    width: 12px;
    height: 12px;
    display: block;
    cursor: pointer;
}
#selecedPP li span{
    display: none;
}
#selecedPP li.active span{
    display: block;
}
#selecedPP li span:before {     
    content: "\f060";
    
    font: normal normal normal 14px/1 FontAwesome;
    color: red;
    
    width: 12px;
    height: 12px;
    /*background-color: red;
    -webkit-mask: url(/assets/images/close.svg) no-repeat 50% 50%;  
    mask: url(/assets/images/close.svg) no-repeat 50% 50%;
    -webkit-mask-size: cover;
    mask-size: cover;*/
    display: block;
}
#selecedPPD li span:before {     
    content: "";     
    width: 12px;
    height: 12px;
    background-color: red;
    -webkit-mask: url(/assets/images/close.svg) no-repeat 50% 50%;  
    mask: url(/assets/images/close.svg) no-repeat 50% 50%;
    -webkit-mask-size: cover;
    mask-size: cover;
    display: block;
}
.xdsoft_datetimepicker{
    z-index: 111111;
}

span.k-widget.k-dropdown.k-header{
    width: auto!important;
    max-width: 186px;
}

.k-window-print-qr .k-detail-cell >ul{
    border-bottom: solid 1px #9f9f9f;
}

/* fix 03/09/2020 */
@media (max-width: 380px){
    .mainRight .prettycheckbox, .mainRight .prettyradio {     
        padding-left: 0px; 
    }  
    .mainRight .prettycheckbox a, .mainRight .prettyradio a {
        position: unset;  
    }
}

</style>
 

<div class="k-widget k-window k-window-poup k-window-poup2 k-window-masstel k-window-diary kv-window" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 550px; display: none; top: 0px; left: 404px; position: absolute; touch-action: pan-y; z-index: 10009; opacity: 1; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title" id="importproductform_wnd_title">Nhật ký điện tử</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div id="diaryform" class="control-poup control-poup2 ng-scope k-window-content k-content" kendo-window="importWindow" k-title="_l.product_ImportTitle" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="550" k-modal="true"
    k-close="onCloseImport" data-role="window" tabindex="0" role="dialog" aria-labelledby="importproductform_wnd_title" style="">
    <div class="form-wrapper">
      <div class="bd-bt-poup bd-bt-poup ng-binding"><strong>Các sản phẩm đã chọn:</strong>
        <div class="k-list-scroller" unselectable="on" style="max-height: 100px;">
            <ul id="selecedPP" unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
                
            </ul>
        </div>
      </div>
      <div class="bd-bt-poup bd-bt-poup ng-binding ng-hide"><strong>Các nhật ký của sản phẩm đã chọn:</strong>
        <div class="k-list-scroller" unselectable="on" style="max-height: 100px;">
            <ul id="selecedPPD" unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">
                
            </ul>
        </div>
      </div>
      <div id="forDiary">
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p><strong>Người thực hiện:</strong></p>
        <div id="selectedPD"></div> 
      </div>
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p><strong>Nội dung:</strong></p>
        <div>
            <textarea id="selectedPC" ng-model="diary.content"></textarea>
            <input type="hidden" ng-model="diary.id" value="" />
        </div>  
      </div>
      
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p><strong>Hình ảnh</strong></p>
        <input type="hidden" id="selectedPII" ng-model="diary.image" />
        <div class="k-list-scroller" style="height: 50px;" id="selectedPI">
            <div><input accept="image/*" capture="user" onchange="uploadF(this)" id="selectedPF" type="file" style="width: 50px;height: 50px;opacity: 0;" /></div> 
            <!--div>
                <img src="https://via.placeholder.com/50" width="50" />
                <span onclick="closeI(this)"></span>
            </div-->  
            
        </div> 
      </div>
      <div class="bd-bt-poup bd-bt-poup ng-binding">
        <p><strong>Thời gian:</strong></p>
        <div>
            <input class="form-control" ng-model="diary.time" id="selectedPDD" placeholder="dd/mm/YYYY HH:MM" />
        </div>  
      </div>
      </div> 
    </div>
    <div class="kv-window-footer">
      <div class="k-widget k-upload k-header k-upload-empty">
         
        <button type="button" class="k-button k-upload-selected" onclick="dodiary(this)">Thực hiện</button>
      </div>
    </div>
    <div class="alert alert-danger ng-binding" ng-bind-html="ImportError"></div>
    <!-- ngIf: IsLoadingImportProduct -->
  </div>
</div>
<!--
Sản phẩm cha    : 
Số sản phẩm     : 1
Tên sản phẩm    : 
Số số sau tên SP: 5
Tên SP Bắt đầu  : 1
Đầu mã SP       : SP
Số số sau mã SP : 5
Mã SP Bắt đầu   : 1
Kế thừa nhật ký : 1
SL SP           : 1
Giá bán         : 0
Giá vốn         : 0
Nhóm SP         :
Tên đơn vị      :
Bán trực tiếp   : 1
 
-->
<div class="k-widget k-window k-window-poup kv-window k-window-quick-add-product" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 400px; height: 520px; display: none; top: 0px; left: 350px; position: absolute; touch-action: pan-y; z-index: 10012; transform: scale(1); opacity: 1;">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Thêm nhanh sản phẩm</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="quickChoose" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="658" k-height="520" k-modal="true" k-close="onClose" data-role="window" class="k-window-content k-content" style="display: block;" tabindex="0">
    <div class="row row-padding-5 form-wrapper">
      <div class="w-quick-left ">
        <form class="ng-valid ng-valid-parse ng-pristine">
            <div class="mb15" ng-show="cfs.BHS">
            <label style="width: 100px;">Sản phẩm gốc:</label>
              <select kendo-drop-down-list="" ng-model="quick.parent" k-options="comboPriceBook" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist">                
              </select>              
          </div>
          <div class="mb15 ng-hide" ng-show="cfs.BHS">
            <label style="width: 100px;">Kế thừa nhật ký:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="checkbox" value="1" k-ng-model="quick.inherit"></span></div>
          <div class="mb15 ng-hide" ng-show="cfs.BHS">
            <label style="width: 100px;">Xóa sản phẩm gốc:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="checkbox" value="1" k-ng-model="quick.delete"></span></div>   
          <div id="divCategory" style="max-height: 220px;overflow-y: scroll;margin-bottom: 15px;">
          <div class="mb15 category">
            <label style="width: 100px;">Nhóm SP:</label>
              <select kendo-drop-down-list="" ng-model="quick.category" k-options="comboPriceBook" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist">                
              </select>              
          </div>
          </div>  
          <div class="mb15" ng-show="cfs.BHS">
            <label style="width: 100px;">Nhân viên:</label>             
              <select kendo-drop-down-list="" ng-model="quick.user" k-options="comboPriceBook" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist">                 
              </select>               
          </div>   
          <div class="mb15">
            <label style="width: 100px;">Số SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.number"></span></div>
           
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Tên SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style=""
            ><input type="text" value="" k-ng-model="quick.name"></span></div>
           
          
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Số số sau tên SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.number_name"></span></div>
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Tên SP Bắt đầu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.start_name"></span></div>
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Đầu mã SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.name_prefix"></span></div>  
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Số số sau mã SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.number_code"></span></div>  
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Mã SP Bắt đầu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.start_code"></span></div>
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">SL SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.quantity"></span></div>  
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Giá bán:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.price"></span></div>
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Giá vốn:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.price2"></span></div>
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Tên đơn vị:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.uname"></span></div>
           
          <div class="mb15" ng-toogle="showInput">
            <label style="width: 100px;">Bán trực tiếp:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="checkbox" value="1" k-ng-model="quick.sell"></span></div> 
          <div class="mb15" ng-show="cfs.BHS">
            <label style="width: 100px;">Ngày tạo:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="quick.created"></span></div>   
          <div class="mb15">
          <a class="ng-binding" href="javascript:void(0)" ng-click="showInput = !showInput">Mở rộng <i class="fa fa-caret-down"></i></a>
          </div> 
          <article class="clb txtL boxBtn ovh"><a onclick="quickAdd()" class="kv2Btn ng-binding" style="width: 100%;"><i class="fa fa-plus"></i> Thêm</a></article>
        </form>
         
        <p class="ng-binding"></p>
      </div>
    </div>
    <div class="clb ovh"></div>
  </div>
</div>

<!--
Tùy chọn in QR: 
số dòng 4, 
số cột 2, 
nhân viên, 
ngày in. 
Size tên SP, 
size mã sp, 
cao phiếu, 
rộng phiếu, 
kc phiếu, 
cao qr, 
rộng qr
-->
<div class="k-widget k-window k-window-poup kv-window k-window-print-qr" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 400px; height: 520px; display: none; top: 0px; left: 350px; position: absolute; touch-action: pan-y; z-index: 10012; transform: scale(1); opacity: 1;">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Tùy chọn in QR</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="qrChoose" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="658" k-height="520" k-modal="true" k-close="onClose" data-role="window" class="k-window-content k-content" style="display: block;" tabindex="0">
    <div class="k-detail-cell">
        <ul class="k-tabstrip-items k-reset">
        <li class="ng-binding k-item k-state-default k-first k-tab-on-top k-state-active" role="tab" aria-controls="66-1" aria-selected="true"> <span class="k-loading k-complete"></span><span class="k-link">Cấu hình</span></li>         
        <li class="ng-binding k-item k-state-default k-last" role="tab" aria-controls="66-7"><span class="k-loading k-complete"></span><span class="k-link">Sản phẩm</span></li>
        </ul>
    </div>
    <div class="row row-padding-5 form-wrapper">
      <div class="w-qr-left ">
        <form class="ng-valid ng-valid-parse ng-pristine">
            <div class="tab1">
          <div class="mb15">
            <label style="width: 100px;">Số dòng:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_row" value="" k-ng-model="qrow"></span>
            </div>
          <div class="mb15">
            <label style="width: 100px;">Số cột:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
            aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_col" value="" k-ng-model="qcol"></span>
            </div>
          <div class="mb15">
            <label style="width: 100px;">Nhân viên:</label>             
              <select kendo-drop-down-list="" ng-model="quser" k-options="comboPriceBook" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist">                 
              </select>               
          </div>   
          <div class="mb15">
            <label style="width: 100px;">Ngày thực hiên:</label>             
            <span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_date" value="" k-ng-model="qdate"></span></div>              
                  
          <div class="mb15">
            <label style="width: 100px;">Size tên SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size1" value="" k-ng-model="qsize1"></span></div>           
          <div class="mb15">
            <label style="width: 100px;">Size mã SP:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size2" value="" k-ng-model="qsize2"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Cao phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size3" value="" k-ng-model="qsize3"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Rộng phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size4" value="" k-ng-model="qsize4"></span></div>
          <div class="mb15">
            <label style="width: 100px;">K.cách phiếu:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size5" value="" k-ng-model="qsize5"></span></div>  
          <div class="mb15">
            <label style="width: 100px;">Size QR:</label>
<span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" id="q_size6" value="" k-ng-model="qsize6"></span></div>
            </div>    
            <div class="tab2 ng-hide">
              <div class="mb15">
                <label style="width: 100px;">Sản phẩm:</label>
                <span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false"
                aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
                    <input type="text" id="product_" value="" k-ng-model="product_">
                </span>
                </div>           
            </div>       
          <article class="clb txtL boxBtn ovh"><a onclick="PrintQR()" class="kv2Btn ng-binding" style="width: 100%;"><i class="fa fa-qrcode"></i> Xem bản in</a></article>
        </form>
         
        <p class="ng-binding">Lưu ý: Trong trường hợp Mã QR được in không đọc được, vui lòng sử dụng Mẫu giấy lớn hơn hoặc tăng kích thước QR.</p>
      </div>
    </div>
    
    <div class="clb ovh"></div>
  </div>
</div>

<div class="k-widget k-window k-window-poup k-window-qrcodeProduct kv-window" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 900px; height: 200px; display: none; top: 0px; left: 429px; position: absolute; touch-action: pan-y; z-index: 10033; transform: scale(1);">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">In QRCODE</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="barcodePreview" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="500" k-height="200" k-modal="true" k-open="onOpenBarCode" k-close="onClose" data-role="window" class="k-window-content k-content" tabindex="0"
  style="display: block;">
  <div id="qrViewer2" >
    <div id="qrViewer" class="k-widget ng-binding">
       </div> 
  </div>
    <div class="paging-box">
        <div class="k-pager-wrap k-grid-pager k-widget k-floatwrap" data-role="pager">
        <a href="javascript:void(0);" title="Trang đầu" class="k-link k-pager-nav k-pager-first k-state-disabled" data-page="1" tabindex="-1">
        <span class="k-icon k-i-seek-w">Trang đầu</span></a>
        <a href="javascript:void(0);" title="Trang trước" class="k-link k-pager-nav k-state-disabled" data-page="1" tabindex="-1">
        <span class="k-icon k-i-arrow-w">Trang trước</span></a>
        <ul class="k-pager-numbers k-reset">
        <li class="k-current-page"><span class="k-link k-pager-nav">1</span></li>
        <li><span class="k-state-selected">1</span></li>
         
        </ul>
        <a href="javascript:void(0);" title="Trang sau" class="k-link k-pager-nav" data-page="2" tabindex="-1">
        <span class="k-icon k-i-arrow-e">Trang sau</span></a>
        <a href="javascript:void(0);" title="Trang cuối" class="k-link k-pager-nav k-pager-last" data-page="3" tabindex="-1">
        <span class="k-icon k-i-seek-e">Trang cuối</span>
        </a>
        <span class="k-pager-info k-label">/Tổng 0 trang</span>
        </div>
    </div>
    <article class="clb txtL boxBtn ovh"><a onclick="PrintQRCode(1)" class="kv2Btn ng-binding" style="width: 100%;"><i class="fa fa-qrcode"></i> In</a></article>   
</div>
</div>

<div class="k-widget k-window k-window-poup kv-window k-window-recycle" data-role="draggable" style="padding-top: 42px; min-width: 90px; min-height: 50px; width: 400px; height: 520px; display: none; top: 0px; left: 350px; position: absolute; touch-action: pan-y; z-index: 10012; transform: scale(1); opacity: 1;">
  <div class="k-window-titlebar k-header" style="margin-top: -42px;">&nbsp;<span class="k-window-title">Hủy sản phẩm</span>
    <div class="k-window-actions"><a role="button" href="#" class="k-window-action k-link"><span role="presentation" class="k-icon k-i-close">Close</span></a></div>
  </div>
  <div kendo-window="recycleChoose" k-visible="false" k-resizable="false" k-draggable="true" k-pinned="true" k-width="658" k-height="520" k-modal="true" k-close="onClose" data-role="window" class="k-window-content k-content" style="display: block;" tabindex="0">
    <div class="row row-padding-5 form-wrapper">
      <div class="w-recycle-left ">
        <div style="color:red;text-align: center;">Bạn đã chọn 0 sản phẩm.</div>
        <form class="ng-valid ng-valid-parse ng-pristine">
            <div class="mb15">
            <label style="width: 100px;"><strong>Lý do:</strong></label>
              <textarea ng-model="recycle.note" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched form-control"></textarea>              
          </div>
           <div class="mb15">
            <label style="width: 100px;">Gộp lại 1 phiếu:</label>
              <input type="checkbox" value="1" ng-model="recycle.join" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" />            
          </div>
          <div class="mb15">
            <label style="width: 100px;">Nhân viên:</label>             
              <select ng-model="recycle.user" class="ng-valid ng-not-empty ng-valid-parse ng-pristine ng-touched" data-role="dropdownlist">                 
              </select>               
          </div>   
          <div class="mb15">
            <label style="width: 100px;">Ngày thực hiên:</label>             
            <span title="" class="k-widget k-dropdown k-header ng-pristine ng-untouched ng-valid ng-not-empty ng-valid-parse" unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-readonly="false" aria-busy="false" aria-activedescendant="596f62bb-ea7e-4f8c-95f2-5795fb569649" style="">
            <input type="text" value="" k-ng-model="recycle.date"></span></div>      
          <article class="clb txtL boxBtn ovh"><a onclick="doRecycle()" class="kv2Btn ng-binding" style="width: 100%;"><i class="fa fa-recycle"></i> Xuất hủy</a></article>
        </form>
         
        <p class="ng-binding"></p>
      </div>
    </div>
    <div class="clb ovh"></div>
  </div>
</div>